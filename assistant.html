<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistente IA MakerAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #5f2eff, #8f6bff);
            --secondary-gradient: linear-gradient(135deg, #8f6bff, #9d7aff);
            --bg-primary: rgba(18, 18, 18, 0.98);
            --bg-secondary: rgba(15, 15, 15, 0.95);
            --bg-tertiary: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-color: #8f6bff;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: transparent;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }

        .assistant-panel {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: var(--bg-primary);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(20px);
            animation: panelIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            height: 100dvh;
            width: 100dvw;
        }

        @keyframes panelIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header melhorado */
        .chat-header {
            padding: 14px 18px;
            background: linear-gradient(135deg, 
                rgba(95, 46, 255, 0.25), 
                rgba(143, 107, 255, 0.15));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            box-shadow: 0 4px 12px rgba(95, 46, 255, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-text {
            flex: 1;
        }

        .header-text h3 {
            font-size: 17px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #d4c4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
        }

        .header-text .status {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--success-color);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .icon-btn[data-badge]::after {
            content: attr(data-badge);
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--accent-color);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 18px;
            text-align: center;
            border: 2px solid var(--bg-primary);
        }

        /* Container de mensagens melhorado */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 18px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(95, 46, 255, 0.02) 10%,
                transparent 90%
            );
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #5f2eff, #8f6bff);
            border-radius: var(--radius-full);
        }

        /* Mensagens aprimoradas */
        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: var(--radius-md);
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            font-size: 15px;
            box-shadow: var(--shadow-md);
            animation: messageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(10px);
        }

        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-message::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--primary-gradient);
            clip-path: polygon(100% 50%, 0 0, 0 100%);
        }

        .ai-message {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .ai-message::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--bg-tertiary);
            clip-path: polygon(0 50%, 100% 0, 100% 100%);
        }

        .message-time {
            display: block;
            font-size: 11px;
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
            font-weight: 500;
        }

        /* Indicador de digita√ß√£o melhorado */
        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            align-self: flex-start;
            border: 1px solid var(--border-color);
            animation: typingIn 0.3s ease;
            max-width: 120px;
        }

        @keyframes typingIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--accent-color);
            opacity: 0.4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { 
                opacity: 0.4; 
                transform: translateY(0px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-4px); 
            }
        }

        /* Container de op√ß√µes r√°pidas aprimorado */
        .quick-options-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            flex-shrink: 0;
            position: relative;
        }

        .quick-options-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .quick-options-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quick-options-title i {
            color: var(--accent-color);
        }

        .quick-options-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 12px;
            scrollbar-width: none;
        }

        .quick-options-carousel::-webkit-scrollbar {
            display: none;
        }

        .quick-option {
            flex: 0 0 auto;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
        }

        .quick-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 0;
        }

        .quick-option > * {
            position: relative;
            z-index: 1;
        }

        .quick-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-option:hover::before {
            opacity: 0.1;
        }

        .quick-option:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .quick-option i {
            color: var(--accent-color);
            font-size: 14px;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .carousel-indicator {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
            padding: 0;
        }

        .carousel-indicator.active {
            background: var(--accent-color);
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(143, 107, 255, 0.5);
        }

        /* Container de input aprimorado */
        .input-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background: var(--bg-secondary);
            align-items: center;
            position: relative;
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        #assistantInput {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
        }

        #assistantInput:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(143, 107, 255, 0.1);
        }

        #assistantInput::placeholder {
            color: var(--text-tertiary);
        }

        .send-btn {
            background: var(--primary-gradient);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(95, 46, 255, 0.4);
        }

        .send-btn:hover::before {
            opacity: 1;
        }

        .send-btn:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Bot√£o de voltar */
        .back-btn {
            display: none;
        }

        /* Sugest√µes em tempo real */
        .suggestions-container {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 18px;
            right: 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
        }

        .suggestion-item {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            color: var(--text-primary);
        }

        .suggestion-item:hover {
            background: var(--bg-tertiary);
        }

        /* Modal de confirma√ß√£o */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .modal-message {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            border: 1px solid var(--border-color);
        }

        .modal-btn.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Feedback visual */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--transition-normal);
            z-index: 10001;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* ============================================
           RESPONSIVIDADE COMPLETA
           ============================================ */

        /* MOBILE (at√© 767px) - Mobile First */
        @media (max-width: 767px) {
            .assistant-panel {
                border-radius: 0;
                height: 100dvh;
                width: 100dvw;
            }

            .back-btn {
                display: flex;
            }

            .chat-header {
                padding: 12px 16px;
            }

            .ai-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .header-text h3 {
                font-size: 16px;
            }

            .header-actions .icon-btn {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .messages-container {
                padding: 16px;
            }

            .message {
                max-width: 92%;
                padding: 14px 18px;
                font-size: 14px;
            }

            .quick-option {
                padding: 12px 16px;
                font-size: 12.5px;
                flex: 0 0 auto;
                width: calc(100vw - 100px);
            }

            .input-container,
            .quick-options-container {
                padding-left: 16px;
                padding-right: 16px;
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }

            #assistantInput {
                font-size: 16px;
                padding: 14px 18px;
            }

            .send-btn {
                width: 44px;
                height: 44px;
            }

            @supports (padding: max(0px)) {
                .input-container {
                    padding-bottom: max(16px, env(safe-area-inset-bottom));
                }
            }
        }

        /* TABLET (768px a 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .assistant-panel {
                max-width: 720px;
                margin: 24px auto;
                border-radius: 28px;
                height: calc(100dvh - 48px);
                width: calc(100vw - 48px);
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            }

            .chat-header {
                padding: 16px 24px;
                border-radius: 28px 28px 0 0;
            }

            .messages-container {
                padding: 24px;
            }

            .message {
                max-width: 80%;
            }

            .quick-option {
                flex: 0 0 calc(50% - 10px);
                min-width: 200px;
            }

            .input-container {
                padding: 20px 24px;
                border-radius: 0 0 28px 28px;
            }

            #assistantInput {
                padding: 16px 22px;
                font-size: 15px;
            }
        }

        /* DESKTOP (1024px e acima) */
        @media (min-width: 1024px) {
            .assistant-panel {
                max-width: 480px;
                margin: 24px auto;
                border-radius: 28px;
                height: calc(100dvh - 48px);
                width: calc(100vw - 48px);
                box-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
            }

            .chat-header {
                padding: 18px 24px;
                border-radius: 28px 28px 0 0;
            }

            .messages-container {
                padding: 28px 24px;
            }

            .message {
                max-width: 75%;
            }

            .quick-option {
                flex: 0 0 calc(25% - 12px);
                min-width: 150px;
            }

            .input-container {
                padding: 20px 24px;
                border-radius: 0 0 28px 28px;
            }

            #assistantInput {
                padding: 16px 24px;
                font-size: 15px;
            }

            .send-btn {
                width: 48px;
                height: 48px;
                font-size: 17px;
            }
        }

        /* DISPOSITIVOS GRANDES (1440px+) */
        @media (min-width: 1440px) {
            .assistant-panel {
                max-width: 520px;
            }

            .message {
                max-width: 70%;
            }
        }

        /* AJUSTES PARA TELAS MUITO ALTAS */
        @media (min-height: 900px) and (min-width: 1024px) {
            .assistant-panel {
                height: 85dvh;
                margin-top: 7.5dvh;
                margin-bottom: 7.5dvh;
            }
        }

        /* AJUSTES PARA TELAS MUITO BAIXAS */
        @media (max-height: 600px) {
            .assistant-panel {
                border-radius: 0;
            }

            .messages-container {
                padding-top: 12px;
                padding-bottom: 12px;
            }

            .message {
                padding: 12px 16px;
                font-size: 14px;
            }

            .quick-options-container {
                padding-top: 12px;
                padding-bottom: 12px;
            }

            .quick-option {
                padding: 10px 14px;
                font-size: 12px;
            }
        }

        /* ROTA√á√ÉO (LANDSCAPE) EM MOBILE */
        @media (max-width: 767px) and (orientation: landscape) {
            .assistant-panel {
                border-radius: 0;
            }

            .chat-header {
                padding: 10px 14px;
            }

            .ai-avatar {
                width: 30px;
                height: 30px;
            }

            .header-text h3 {
                font-size: 15px;
            }

            .messages-container {
                padding: 12px 14px;
                max-height: 50vh;
            }

            .message {
                max-width: 85%;
                padding: 12px 14px;
                font-size: 13px;
            }

            .quick-option {
                padding: 10px 14px;
                font-size: 12px;
                min-width: 180px;
            }
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: rgba(255, 255, 255, 0.98);
                --bg-secondary: rgba(250, 250, 250, 0.95);
                --bg-tertiary: rgba(0, 0, 0, 0.05);
                --text-primary: #1a1a1a;
                --text-secondary: rgba(0, 0, 0, 0.6);
                --text-tertiary: rgba(0, 0, 0, 0.4);
                --border-color: rgba(0, 0, 0, 0.1);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Anima√ß√µes de entrada */
        .message:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .message:nth-child(even) {
            animation-delay: 0.2s;
        }

        /* Performance: Desativa anima√ß√µes para hist√≥rico carregado */
        .messages-container:has(.message:nth-child(30)) .message {
            animation: none !important;
            opacity: 1 !important;
            transform: none !important;
        }
    </style>
</head>
<body>
    <div class="assistant-panel" id="assistantPanel">
        <!-- Header aprimorado -->
        <div class="chat-header">
            <div class="header-content">
                <div class="ai-avatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="header-text">
                    <h3>Assistente MakerAI</h3>
                    <div class="status">
                        <span class="status-dot"></span>
                        <span id="statusText">Online ‚Ä¢ IA Generativa</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="historyBtn" aria-label="Hist√≥rico" data-badge="0">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" id="clearBtn" aria-label="Limpar conversa">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="icon-btn" id="apiKeyBtn" aria-label="Configurar DeepSeek">
                    <i class="fas fa-key"></i>
                </button>
                <button class="icon-btn back-btn" id="backBtn" aria-label="Voltar">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="icon-btn" id="closeAssistant" aria-label="Fechar assistente">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Container de mensagens -->
        <div class="messages-container" id="messagesContainer">
            <!-- Mensagens ser√£o inseridas aqui dinamicamente -->
        </div>

        <!-- Sugest√µes em tempo real -->
        <div class="suggestions-container" id="suggestionsContainer"></div>

        <!-- Container de op√ß√µes r√°pidas -->
        <div class="quick-options-container" id="quickOptionsContainer">
            <div class="quick-options-title">
                <i class="fas fa-bolt"></i> Perguntas frequentes
            </div>
            <div class="quick-options-carousel" id="quickOptionsCarousel"></div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </div>

        <!-- Container de input -->
        <div class="input-container">
            <input 
                type="text" 
                id="assistantInput" 
                placeholder="Digite sua pergunta..." 
                aria-label="Mensagem para o assistente"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
            >
            <button class="send-btn" id="sendAssistantBtn" aria-label="Enviar mensagem">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Limpar conversa</h3>
                <p class="modal-message" id="modalMessage">Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modalCancel">Cancelar</button>
                <button class="modal-btn primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal para chave DeepSeek -->
    <div class="confirmation-modal" id="apiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üîë Configurar DeepSeek API</h3>
                <p class="modal-message">
                    Para respostas mais avan√ßadas, insira sua chave da DeepSeek API.<br>
                    <small style="color: var(--text-tertiary); font-size: 12px;">
                        A chave fica armazenada apenas no seu navegador.
                    </small>
                </p>
            </div>
            <div class="modal-actions">
                <input 
                    type="password" 
                    id="deepseekApiKeyInput" 
                    placeholder="sk-..." 
                    autocomplete="off"
                    style="width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); margin-bottom: 16px; font-size: 14px;"
                >
                <button class="modal-btn secondary" id="apiKeyCancel">Cancelar</button>
                <button class="modal-btn primary" id="apiKeySave">Salvar</button>
            </div>
            <div style="margin-top: 12px; text-align: center;">
                <small style="color: var(--text-tertiary); font-size: 11px;">
                    <a href="https://platform.deepseek.com/api_keys" target="_blank" style="color: var(--accent-color); text-decoration: none;">
                        Obter chave API ‚Üó
                    </a>
                </small>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>

    <script>
        // ============================================
        // ELEMENTOS E VARI√ÅVEIS GLOBAIS
        // ============================================
        const elements = {
            panel: document.getElementById('assistantPanel'),
            messagesContainer: document.getElementById('messagesContainer'),
            assistantInput: document.getElementById('assistantInput'),
            sendAssistantBtn: document.getElementById('sendAssistantBtn'),
            quickOptionsCarousel: document.getElementById('quickOptionsCarousel'),
            carouselIndicators: document.getElementById('carouselIndicators'),
            closeAssistant: document.getElementById('closeAssistant'),
            backBtn: document.getElementById('backBtn'),
            historyBtn: document.getElementById('historyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            apiKeyBtn: document.getElementById('apiKeyBtn'),
            statusText: document.getElementById('statusText'),
            suggestionsContainer: document.getElementById('suggestionsContainer'),
            confirmationModal: document.getElementById('confirmationModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalMessage: document.getElementById('modalMessage'),
            modalCancel: document.getElementById('modalCancel'),
            modalConfirm: document.getElementById('modalConfirm'),
            apiKeyModal: document.getElementById('apiKeyModal'),
            apiKeyInput: document.getElementById('deepseekApiKeyInput'),
            apiKeyCancel: document.getElementById('apiKeyCancel'),
            apiKeySave: document.getElementById('apiKeySave'),
            notification: document.getElementById('notification')
        };

        // Estado da aplica√ß√£o
        const state = {
            conversationHistory: [],
            isProcessing: false,
            carouselInterval: null,
            currentSlide: 0,
            messageCount: 0,
            typingTimeout: null,
            suggestions: [],
            isOnline: true,
            sessionId: generateSessionId(),
            lastMessages: [], // Para mem√≥ria contextual
            isLandscape: window.innerWidth > window.innerHeight,
            useDeepSeek: false
        };

        // Configura√ß√£o DeepSeek
        const DEEPSEEK_CONFIG = {
            API_URL: "https://api.deepseek.com/v1/chat/completions",
            MODEL: "deepseek-chat",
            MAX_TOKENS: 1000,
            TEMPERATURE: 0.7
        };

        // Carrega chave do localStorage
        let DEEPSEEK_API_KEY = localStorage.getItem('makerai_deepseek_key') || '';

        // ============================================
        // CONFIGURA√á√ïES RESPONSIVAS
        // ============================================
        const CONFIG = {
            TYPING_DELAY: 800,
            CAROUSEL_INTERVAL: 5000,
            SESSION_TIMEOUT: 30 * 60 * 1000,
            MAX_MESSAGES: 100,
            SUGGESTIONS_LIMIT: 3,
            ITEMS_PER_VIEW: calculateItemsPerView()
        };

        function calculateItemsPerView() {
            const width = window.innerWidth;
            if (width < 768) return 1; // Mobile: 1 item
            if (width < 1024) return 2; // Tablet: 2 items
            return 4; // Desktop: 4 items
        }

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function showNotification(message, type = 'info') {
            const notification = elements.notification;
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'success') {
                notification.style.borderLeft = '4px solid var(--success-color)';
            } else if (type === 'error') {
                notification.style.borderLeft = '4px solid var(--error-color)';
            } else if (type === 'warning') {
                notification.style.borderLeft = '4px solid var(--warning-color)';
            } else {
                notification.style.borderLeft = '4px solid var(--accent-color)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function sanitizeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // GERENCIAMENTO DE MENSAGENS
        // ============================================
        function addMessage(text, sender, timestamp = new Date()) {
            // Limita o n√∫mero de mensagens no DOM para performance
            if (state.messageCount > 50) {
                const messages = elements.messagesContainer.querySelectorAll('.message');
                if (messages.length > 50) {
                    messages[0].remove();
                }
            }

            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            div.dataset.messageId = messageId;
            
            const formattedTime = formatTime(timestamp);
            
            // Sanitiza e processa markdown b√°sico
            let processedText = sanitizeHTML(text)
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            div.innerHTML = processedText + `<span class="message-time">${formattedTime}</span>`;
            
            // Aplica anima√ß√£o apenas para novas mensagens
            if (state.messageCount < 30) {
                const delay = state.messageCount * 0.1;
                div.style.animationDelay = `${delay}s`;
            } else {
                div.style.animation = 'none';
                div.style.opacity = '1';
                div.style.transform = 'none';
            }
            
            elements.messagesContainer.appendChild(div);
            
            // Scroll suave com requestAnimationFrame
            requestAnimationFrame(() => {
                elements.messagesContainer.scrollTo({
                    top: elements.messagesContainer.scrollHeight,
                    behavior: 'smooth'
                });
            });
            
            state.messageCount++;
            state.lastMessages.push({ sender, content: text });
            
            // Mant√©m apenas as √∫ltimas 6 mensagens para contexto
            if (state.lastMessages.length > 6) {
                state.lastMessages.shift();
            }
            
            return messageId;
        }

        function showTyping() {
            if (document.getElementById('typingIndicator')) return;
            
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            elements.messagesContainer.appendChild(typing);
            
            requestAnimationFrame(() => {
                elements.messagesContainer.scrollTo({
                    top: elements.messagesContainer.scrollHeight,
                    behavior: 'smooth'
                });
            });
        }

        function hideTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // ============================================
        // GERENCIAMENTO DE HIST√ìRICO
        // ============================================
        function saveHistory() {
            const history = {
                sessionId: state.sessionId,
                messages: state.conversationHistory,
                lastUpdated: new Date().toISOString(),
                messageCount: state.messageCount,
                deepSeekKey: DEEPSEEK_API_KEY
            };
            try {
                localStorage.setItem('makerai_chat_history', JSON.stringify(history));
                updateHistoryBadge();
            } catch (e) {
                console.warn('N√£o foi poss√≠vel salvar hist√≥rico:', e);
            }
        }

        function loadHistory() {
            try {
                const saved = localStorage.getItem('makerai_chat_history');
                if (saved) {
                    const history = JSON.parse(saved);
                    
                    // Verifica se a sess√£o √© muito antiga
                    const lastUpdated = new Date(history.lastUpdated);
                    const now = new Date();
                    const diffHours = (now - lastUpdated) / (1000 * 60 * 60);
                    
                    if (diffHours < 24) { // Mant√©m hist√≥rico por 24 horas
                        state.conversationHistory = history.messages || [];
                        state.messageCount = history.messageCount || 0;
                        DEEPSEEK_API_KEY = history.deepSeekKey || '';
                        
                        // Renderiza hist√≥rico (sem anima√ß√µes para performance)
                        state.conversationHistory.forEach(msg => {
                            const timestamp = msg.timestamp ? new Date(msg.timestamp) : new Date();
                            addMessage(msg.content, msg.role, timestamp);
                        });
                        
                        updateStatus();
                        updateHistoryBadge();
                        return true;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
            return false;
        }

        function clearHistory() {
            state.conversationHistory = [];
            state.messageCount = 0;
            state.lastMessages = [];
            elements.messagesContainer.innerHTML = '';
            localStorage.removeItem('makerai_chat_history');
            updateHistoryBadge();
            showNotification('Hist√≥rico limpo com sucesso!', 'success');
            
            // Adiciona mensagem inicial
            setTimeout(() => {
                addMessage(getInitialGreeting(), 'ai');
            }, 500);
        }

        function updateHistoryBadge() {
            const badge = elements.historyBtn;
            const count = state.conversationHistory.length;
            badge.dataset.badge = count > 0 ? count : '';
        }

        function updateStatus() {
            if (DEEPSEEK_API_KEY) {
                elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Ativo';
                state.useDeepSeek = true;
            } else {
                elements.statusText.textContent = 'Online ‚Ä¢ IA Generativa';
                state.useDeepSeek = false;
            }
        }

        // ============================================
        // SISTEMA DE RESPOSTAS H√çBRIDO
        // ============================================
        function getInitialGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = "Bom dia";
            else if (hour < 18) greeting = "Boa tarde";
            else greeting = "Boa noite";
            
            const greetings = [
                `${greeting}! üëã Sou o assistente da MakerAI. Como posso te ajudar hoje?`,
                `${greeting}! üòä Aqui √© o assistente da MakerAI. Pronto para criar algo incr√≠vel juntos?`,
                `${greeting}! üöÄ Eu sou o assistente da MakerAI. Vamos transformar sua ideia em realidade?`
            ];
            
            return greetings[Math.floor(Math.random() * greetings.length)];
        }

        function analyzeMessage(message) {
            const lowerMsg = message.toLowerCase().trim();
            const words = lowerMsg.split(/\s+/);
            
            // An√°lise de inten√ß√£o com pesos
            const intents = {
                greeting: /^(oi|ol√°|ola|e a√≠|bom dia|boa tarde|boa noite|hello|hi|hey)/i.test(lowerMsg) ? 1.0 : 0,
                services: /servi[√ßc]os|desenvolvimento|site|app|sistema|programa[√ßc]|software/i.test(lowerMsg) ? 0.9 : 0,
                pricing: /pre[√ßc]o|valor|custo|or[√ßc]amento|quanto custa|investimento/i.test(lowerMsg) ? 0.8 : 0,
                portfolio: /portf[√≥o]lio|cases|projetos|trabalhos|exemplos|j[a√°] fez/i.test(lowerMsg) ? 0.7 : 0,
                contact: /contato|whatsapp|email|telefone|falar|conversar|agendar|reuni[a√£]o/i.test(lowerMsg) ? 0.6 : 0,
                help: /ajuda|como funciona|duvida|d[u√∫]vida|informa[√ßc][√£a]o/i.test(lowerMsg) ? 0.5 : 0,
                urgent: /urgente|r[a√°]pido|imediat[ao]|hoje|agora|j[a√°]/i.test(lowerMsg) ? 1.0 : 0,
                technical: /tecn[√≠i]|c[√≥o]digo|programa[√ßc]|api|integracao|banco de dados|frontend|backend/i.test(lowerMsg) ? 0.9 : 0
            };
            
            // Verifica contexto anterior
            const lastUserMessage = state.lastMessages.filter(m => m.sender === 'user').pop();
            if (lastUserMessage) {
                const lastLower = lastUserMessage.content.toLowerCase();
                if (lastLower.includes('pre√ßo') || lastLower.includes('valor')) {
                    intents.pricing += 0.2;
                }
                if (lastLower.includes('servi√ßo') || lastLower.includes('desenvolvimento')) {
                    intents.services += 0.2;
                }
                if (lastLower.includes('tecnico') || lastLower.includes('codigo')) {
                    intents.technical += 0.2;
                }
            }
            
            // An√°lise de sentimento
            let sentiment = 'neutral';
            const positiveWords = ['√≥timo', 'excelente', 'perfeito', 'bom', 'legal', 'incr√≠vel', 'maravilhoso'];
            const negativeWords = ['ruim', 'p√©ssimo', 'horr√≠vel', 'problema', 'erro', 'bug', 'n√£o funciona'];
            
            if (positiveWords.some(word => lowerMsg.includes(word))) sentiment = 'positive';
            if (negativeWords.some(word => lowerMsg.includes(word))) sentiment = 'negative';
            
            // Encontra inten√ß√£o principal
            let mainIntent = 'generic';
            let highestScore = 0;
            
            for (const [intent, score] of Object.entries(intents)) {
                if (score > highestScore) {
                    highestScore = score;
                    mainIntent = intent;
                }
            }
            
            return {
                intents,
                mainIntent,
                sentiment,
                words: words.length,
                hasQuestion: /\?$/.test(message),
                isUrgent: intents.urgent > 0,
                score: highestScore,
                isTechnical: intents.technical > 0.5
            };
        }

        async function callDeepSeekAPI(message) {
            try {
                if (!DEEPSEEK_API_KEY) throw new Error('No API key');
                
                const response = await fetch(DEEPSEEK_CONFIG.API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: DEEPSEEK_CONFIG.MODEL,
                        messages: [
                            { 
                                role: "system", 
                                content: "Voc√™ √© um assistente especialista da MakerAI Studio, uma empresa brasileira de desenvolvimento web, mobile, sistemas e intelig√™ncia artificial. Seja profissional, amig√°vel e detalhista. Use emojis quando apropriado. Responda sempre em portugu√™s brasileiro."
                            },
                            ...state.conversationHistory.slice(-8).map(m => ({
                                role: m.role === 'user' ? 'user' : 'assistant',
                                content: m.content
                            })),
                            { role: "user", content: message }
                        ],
                        temperature: DEEPSEEK_CONFIG.TEMPERATURE,
                        max_tokens: DEEPSEEK_CONFIG.MAX_TOKENS,
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0]?.message?.content?.trim() || null;
                
            } catch (error) {
                console.error('Erro DeepSeek:', error);
                return null;
            }
        }

        function getLocalResponse(analysis) {
            // Respostas para sauda√ß√µes
            if (analysis.mainIntent === 'greeting') {
                const hour = new Date().getHours();
                let timeGreeting;
                
                if (hour < 12) timeGreeting = "Bom dia";
                else if (hour < 18) timeGreeting = "Boa tarde";
                else timeGreeting = "Boa noite";
                
                return `${timeGreeting}! üòä\n\nSou o assistente da MakerAI Studio, especializado em transformar ideias em solu√ß√µes digitais incr√≠veis.\n\nNo que posso te ajudar hoje? Pode me contar sobre seu projeto, tirar d√∫vidas sobre or√ßamentos ou conhecer nossos cases de sucesso!`;
            }
            
            // Mapeamento de inten√ß√µes para respostas locais
            const intentResponses = {
                services: `üöÄ **Solu√ß√µes Completas em Tecnologia**\n\n**üíª Desenvolvimento Web & Mobile**\n‚Ä¢ Sites institucionais e corporativos\n‚Ä¢ PWAs (Progressive Web Apps)\n‚Ä¢ E-commerce e marketplaces\n‚Ä¢ Aplicativos nativos (React Native/Flutter)\n‚Ä¢ Sistemas web complexos\n\n**ü§ñ Intelig√™ncia Artificial**\n‚Ä¢ Assistentes virtuais e chatbots\n‚Ä¢ An√°lise preditiva de dados\n‚Ä¢ Processamento de linguagem natural\n‚Ä¢ Vis√£o computacional\n‚Ä¢ Automa√ß√£o com IA\n\n**üé® Design & Experi√™ncia**\n‚Ä¢ UI/UX Design premium\n‚Ä¢ Identidade visual\n‚Ä¢ Prototipagem interativa\n‚Ä¢ Design System\n‚Ä¢ Microintera√ß√µes\n\n**‚ö° Otimiza√ß√£o & Performance**\n‚Ä¢ SEO t√©cnico\n‚Ä¢ Performance web\n‚Ä¢ Seguran√ßa digital\n‚Ä¢ DevOps & CI/CD\n‚Ä¢ Monitoramento\n\n*Qual √°rea voc√™ gostaria de explorar?* üòä`,
                pricing: `üí∞ **Transpar√™ncia Total nos Valores**\n\n**üìä Modelos de Pre√ßo**\n1. **Projeto Fixo** - Escopo definido, prazo fechado\n   ‚Ä¢ Sites: R$ 8.000 - R$ 25.000\n   ‚Ä¢ Apps: R$ 30.000 - R$ 80.000\n   ‚Ä¢ Sistemas: R$ 40.000 - R$ 150.000\n\n2. **Horas Avulsas** - R$ 120/hora\n   ‚Ä¢ Para ajustes e melhorias\n   ‚Ä¢ Manuten√ß√£o cont√≠nua\n   ‚Ä¢ Consultorias t√©cnicas\n\n3. **Assinatura Mensal** - A partir de R$ 1.500/m√™s\n   ‚Ä¢ Suporte priorit√°rio\n   ‚Ä¢ Atualiza√ß√µes constantes\n   ‚Ä¢ Monitoramento 24/7\n\n**üéØ Fatores que Influenciam:**\n‚Ä¢ Complexidade do projeto\n‚Ä¢ Prazo de entrega\n‚Ä¢ Integra√ß√µes necess√°rias\n‚Ä¢ N√≠vel de design\n‚Ä¢ Recursos de IA inclu√≠dos\n\n*Posso te passar uma estimativa mais precisa se voc√™ me contar sobre seu projeto!* ‚ú®`,
                portfolio: `üé® **Cases de Sucesso**\n\n**üè• Sa√∫de & Bem-estar**\n‚Ä¢ App de telemedicina com IA\n‚Ä¢ Sistema de gest√£o para cl√≠nicas\n‚Ä¢ Plataforma de wellness corporativo\n\n**üè¢ Empresarial**\n‚Ä¢ Dashboard de BI em tempo real\n‚Ä¢ Sistema de automa√ß√£o de processos\n‚Ä¢ CRM personalizado com IA\n\n**üõí E-commerce**\n‚Ä¢ Marketplace com recomenda√ß√£o IA\n‚Ä¢ E-commerce com realidade aumentada\n‚Ä¢ Sistema de log√≠stica integrado\n\n**üéì Educa√ß√£o**\n‚Ä¢ Plataforma E-learning gamificada\n‚Ä¢ App de cursos com tutoria IA\n‚Ä¢ Sistema de gest√£o escolar\n\n**üîó Tecnologia**\n‚Ä¢ API Gateway para fintech\n‚Ä¢ Sistema de monitoramento IoT\n‚Ä¢ Plataforma de an√°lise de dados\n\n*Tem algum setor espec√≠fico que te interessa? Posso detalhar cases similares!* üìä`,
                contact: `üìû **Vamos Conversar!**\n\n**üì± Canais Diretos**\n‚Ä¢ WhatsApp: (11) 99999-9999\n‚Ä¢ Email: contato@makerai.com.br\n‚Ä¢ LinkedIn: /makerai-studio\n\n**üìç Endere√ßo**\n‚Ä¢ S√£o Paulo - SP\n‚Ä¢ Atendimento remoto em todo Brasil\n\n**‚è∞ Hor√°rio de Atendimento**\n‚Ä¢ Segunda a Sexta: 9h √†s 18h\n‚Ä¢ S√°bado: 9h √†s 12h\n‚Ä¢ Plant√£o t√©cnico: 24/7\n\n**üéØ Pr√≥ximos Passos:**\n1. Agendamos uma call explorat√≥ria\n2. Analisamos suas necessidades\n3. Criamos uma proposta personalizada\n4. Iniciamos o projeto!\n\n*Prefere que eu te direcione para o formul√°rio ou j√° quer marcar uma call?* üöÄ`,
                help: `ü§ù **Como Posso Ajudar?**\n\nPosso te auxiliar com:\n\n‚Ä¢ Informa√ß√µes sobre nossos servi√ßos\n‚Ä¢ Estimativas de or√ßamento\n‚Ä¢ Exemplos de projetos realizados\n‚Ä¢ Processo de trabalho\n‚Ä¢ Agendamento de reuni√µes\n\n**Dica:** Use os bot√µes r√°pidos abaixo para navegar pelos t√≥picos principais! üöÄ`,
                urgent: `‚ö° **Entendi que √© urgente!**\n\nVamos acelerar o processo:\n\n1. Me conte rapidamente sobre o projeto\n2. Posso conectar voc√™ diretamente com nossa equipe\n3. Priorizamos atendimento imediato\n\n*Qual √© a situa√ß√£o?* üö®`,
                technical: `üîß **Suporte T√©cnico Especializado**\n\nPosso te ajudar com:\n\n‚Ä¢ Arquitetura de sistemas\n‚Ä¢ Escolha de tecnologias\n‚Ä¢ Melhores pr√°ticas de desenvolvimento\n‚Ä¢ Otimiza√ß√£o de performance\n‚Ä¢ Integra√ß√µes de API\n‚Ä¢ Problemas de c√≥digo\n\n*Qual aspecto t√©cnico voc√™ gostaria de discutir?* üíª`
            };
            
            if (intentResponses[analysis.mainIntent]) {
                return intentResponses[analysis.mainIntent];
            }
            
            // Resposta baseada no sentimento
            if (analysis.sentiment === 'negative') {
                return `Entendi que voc√™ pode estar com alguma dificuldade. üòî\n\nPosso te ajudar a resolver isso! Me conte mais detalhes sobre o que est√° acontecendo ou que tipo de solu√ß√£o voc√™ est√° procurando.\n\nJuntos vamos encontrar a melhor op√ß√£o! ü§ù`;
            }
            
            if (analysis.hasQuestion) {
                return `√ìtima pergunta! ü§î\n\nPara te dar uma resposta precisa, me conta um pouco mais sobre:\n\n‚Ä¢ O contexto do projeto\n‚Ä¢ Prazo que voc√™ tem em mente\n‚Ä¢ Or√ßamento dispon√≠vel\n‚Ä¢ Funcionalidades principais\n\nAssim posso te orientar da melhor forma poss√≠vel! üìã`;
            }
            
            // Resposta generica com varia√ß√£o
            const genericResponses = [
                `Interessante! üßê\n\nNo que mais posso te ajudar sobre isso? Se for sobre desenvolvimento, IA, design ou qualquer outra √°rea da tecnologia, estou aqui para esclarecer!`,
                `Show! ‚ú®\n\nVamos explorar isso juntos! Me conta qual o objetivo principal do seu projeto ou que problema voc√™ quer resolver com a tecnologia.`,
                `Perfeito! üéØ\n\nPara te dar as melhores op√ß√µes, voc√™ poderia me falar:\n\n1. Qual √© o seu setor/niche?\n2. Tem algum prazo espec√≠fico?\n3. J√° tem alguma ideia de funcionalidades?\n\nAssim posso te ajudar de forma personalizada!`,
                `Entendi! ü§ù\n\nPara me ajudar a entender melhor, voc√™ est√° pensando em algo mais t√©cnico ou mais focado na experi√™ncia do usu√°rio?`,
                `Certo! üìù\n\nVamos por partes: me conta primeiro qual √© o principal objetivo do seu projeto, depois detalhamos as funcionalidades.`
            ];
            
            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        async function generateResponse(message) {
            try {
                const analysis = analyzeMessage(message);
                
                // Atualiza status no header
                elements.statusText.textContent = DEEPSEEK_API_KEY ? 'Consultando DeepSeek...' : 'Analisando sua pergunta...';
                
                // Decide se usa DeepSeek ou resposta local
                const useDeepSeek = DEEPSEEK_API_KEY && (
                    analysis.isTechnical || 
                    analysis.score < 0.7 || // Perguntas fora do escopo padr√£o
                    analysis.words > 15 || // Perguntas longas/complexas
                    state.conversationHistory.length > 3 // Conversa j√° estabelecida
                );
                
                if (useDeepSeek) {
                    const deepSeekResponse = await callDeepSeekAPI(message);
                    if (deepSeekResponse) {
                        return deepSeekResponse;
                    }
                    // Se falhar, usa resposta local
                    showNotification('Usando respostas locais', 'info');
                }
                
                // Usa resposta local
                return getLocalResponse(analysis);
                
            } catch (error) {
                console.error('Erro ao gerar resposta:', error);
                return `Desculpe, tive um pequeno atraso no processamento. üòÖ\n\nPode repetir sua pergunta ou reformular de outra forma? Estou aqui para ajudar!`;
            }
        }

        // ============================================
        // SUGEST√ïES EM TEMPO REAL
        // ============================================
        const updateSuggestions = debounce(function() {
            const query = elements.assistantInput.value.trim().toLowerCase();
            if (!query || query.length < 2) {
                elements.suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Conhecimento base para sugest√µes
            const knowledge = [
                { text: 'Servi√ßos', tags: ['servi√ßo', 'desenvolvimento', 'site', 'app', 'sistema', 'web', 'mobile'] },
                { text: 'Or√ßamento', tags: ['pre√ßo', 'valor', 'custo', 'or√ßamento', 'quanto custa', 'investimento'] },
                { text: 'Portf√≥lio', tags: ['portfolio', 'cases', 'projetos', 'trabalhos', 'exemplos'] },
                { text: 'Contato', tags: ['contato', 'whatsapp', 'email', 'telefone', 'agendar', 'reuni√£o'] },
                { text: 'Suporte T√©cnico', tags: ['tecnico', 'codigo', 'programa√ß√£o', 'api', 'bug', 'erro'] },
                { text: 'IA & Machine Learning', tags: ['intelig√™ncia artificial', 'machine learning', 'deep learning', 'chatbot'] }
            ];
            
            // Filtra sugest√µes baseadas na query
            const allSuggestions = knowledge.flatMap(item => 
                item.tags.filter(tag => tag.includes(query)).map(() => ({
                    text: `${item.text}`,
                    action: () => {
                        elements.assistantInput.value = item.text;
                        sendMessage();
                    }
                }))
            );
            
            // Remove duplicatas
            const uniqueSuggestions = Array.from(
                new Map(allSuggestions.map(s => [s.text, s])).values()
            ).slice(0, CONFIG.SUGGESTIONS_LIMIT);
            
            if (uniqueSuggestions.length === 0) {
                elements.suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Atualiza UI
            elements.suggestionsContainer.innerHTML = '';
            uniqueSuggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = suggestion.text;
                item.onclick = suggestion.action;
                elements.suggestionsContainer.appendChild(item);
            });
            
            elements.suggestionsContainer.style.display = 'block';
        }, 300);

        // ============================================
        // CARROSSEL DE OP√á√ïES (RESPONSIVO)
        // ============================================
        function initQuickOptions() {
            elements.quickOptionsCarousel.innerHTML = '';
            
            const options = [
                { icon: 'fas fa-cogs', title: 'Servi√ßos' },
                { icon: 'fas fa-money-bill-wave', title: 'Or√ßamento' },
                { icon: 'fas fa-images', title: 'Portf√≥lio' },
                { icon: 'fas fa-envelope', title: 'Contato' }
            ];
            
            options.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'quick-option';
                btn.innerHTML = `<i class="${item.icon}"></i> ${item.title}`;
                btn.onclick = () => {
                    elements.assistantInput.value = item.title;
                    sendMessage();
                };
                elements.quickOptionsCarousel.appendChild(btn);
            });
            
            updateIndicators();
            startCarousel();
        }

        function updateIndicators() {
            CONFIG.ITEMS_PER_VIEW = calculateItemsPerView();
            const total = Math.ceil(4 / CONFIG.ITEMS_PER_VIEW);
            elements.carouselIndicators.innerHTML = '';
            
            for (let i = 0; i < total; i++) {
                const dot = document.createElement('button');
                dot.className = `carousel-indicator ${i === state.currentSlide ? 'active' : ''}`;
                dot.onclick = () => goToSlide(i);
                elements.carouselIndicators.appendChild(dot);
            }
        }

        function goToSlide(index) {
            const totalSlides = Math.ceil(4 / CONFIG.ITEMS_PER_VIEW);
            
            if (index < 0) index = totalSlides - 1;
            if (index >= totalSlides) index = 0;
            
            state.currentSlide = index;
            const options = elements.quickOptionsCarousel.children;
            if (options.length > 0) {
                const optionWidth = options[0].offsetWidth + 10;
                const offset = index * CONFIG.ITEMS_PER_VIEW * optionWidth;
                elements.quickOptionsCarousel.scrollTo({ left: offset, behavior: 'smooth' });
            }
            updateIndicators();
            
            clearInterval(state.carouselInterval);
            startCarousel();
        }

        function startCarousel() {
            state.carouselInterval = setInterval(() => {
                goToSlide(state.currentSlide + 1);
            }, CONFIG.CAROUSEL_INTERVAL);
        }

        // ============================================
        // PROCESSAMENTO DE MENSAGENS
        // ============================================
        async function sendMessage() {
            const message = elements.assistantInput.value.trim();
            if (!message || state.isProcessing) return;
            
            // Esconde sugest√µes
            elements.suggestionsContainer.style.display = 'none';
            
            // Atualiza estado
            state.isProcessing = true;
            elements.assistantInput.value = '';
            elements.assistantInput.disabled = true;
            elements.sendAssistantBtn.disabled = true;
            
            // Adiciona mensagem do usu√°rio
            const timestamp = new Date();
            addMessage(message, 'user', timestamp);
            
            // Salva no hist√≥rico
            state.conversationHistory.push({
                role: 'user',
                content: message,
                timestamp: timestamp.toISOString()
            });
            saveHistory();
            
            // Mostra indicador de digita√ß√£o
            showTyping();
            
            // Timeout de seguran√ßa
            const safetyTimeout = setTimeout(() => {
                hideTyping();
                updateStatus();
                state.isProcessing = false;
                elements.assistantInput.disabled = false;
                elements.sendAssistantBtn.disabled = false;
                elements.assistantInput.focus();
                showNotification('Tempo esgotado. Por favor, tente novamente.', 'error');
            }, 15000);
            
            try {
                // Gera resposta
                const response = await generateResponse(message);
                
                clearTimeout(safetyTimeout);
                hideTyping();
                
                const responseTimestamp = new Date();
                addMessage(response, 'ai', responseTimestamp);
                
                // Atualiza hist√≥rico
                state.conversationHistory.push({
                    role: 'assistant',
                    content: response,
                    timestamp: responseTimestamp.toISOString()
                });
                saveHistory();
                
                // Restaura status
                updateStatus();
                
                // Habilita input novamente
                state.isProcessing = false;
                elements.assistantInput.disabled = false;
                elements.sendAssistantBtn.disabled = false;
                elements.assistantInput.focus();
                
                // Notifica√ß√£o para urg√™ncia
                const analysis = analyzeMessage(message);
                if (analysis.isUrgent) {
                    showNotification('‚ö° Atendimento priorit√°rio ativado', 'warning');
                }
                
            } catch (error) {
                clearTimeout(safetyTimeout);
                console.error('Erro no processamento:', error);
                hideTyping();
                addMessage('Desculpe, ocorreu um erro no processamento. Pode tentar novamente?', 'ai');
                updateStatus();
                state.isProcessing = false;
                elements.assistantInput.disabled = false;
                elements.sendAssistantBtn.disabled = false;
                elements.assistantInput.focus();
            }
        }

        // ============================================
        // MODAL DE CONFIRMA√á√ÉO
        // ============================================
        function showConfirmation(type, message, onConfirm) {
            const modal = elements.confirmationModal;
            
            switch(type) {
                case 'clear':
                    elements.modalTitle.textContent = 'Limpar Conversa';
                    elements.modalMessage.textContent = message;
                    break;
                case 'close':
                    elements.modalTitle.textContent = 'Fechar Assistente';
                    elements.modalMessage.textContent = message;
                    break;
            }
            
            elements.modalConfirm.onclick = () => {
                onConfirm();
                modal.style.display = 'none';
            };
            
            elements.modalCancel.onclick = () => {
                modal.style.display = 'none';
            };
            
            modal.style.display = 'flex';
        }

        function showApiKeyModal() {
            elements.apiKeyInput.value = DEEPSEEK_API_KEY || '';
            elements.apiKeyModal.style.display = 'flex';
        }

        function saveApiKey() {
            const key = elements.apiKeyInput.value.trim();
            
            if (key === '') {
                DEEPSEEK_API_KEY = '';
                localStorage.removeItem('makerai_deepseek_key');
                showNotification('DeepSeek desativado. Usando respostas locais.', 'info');
            } else if (key.startsWith('sk-')) {
                DEEPSEEK_API_KEY = key;
                localStorage.setItem('makerai_deepseek_key', key);
                showNotification('Chave DeepSeek salva com sucesso! ‚úÖ', 'success');
            } else {
                showNotification('Chave inv√°lida. Deve come√ßar com "sk-"', 'error');
                return;
            }
            
            updateStatus();
            elements.apiKeyModal.style.display = 'none';
            saveHistory();
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Input principal
            elements.assistantInput.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            elements.assistantInput.addEventListener('input', updateSuggestions);
            
            // Bot√£o enviar
            elements.sendAssistantBtn.addEventListener('click', sendMessage);
            
            // Bot√£o fechar
            elements.closeAssistant.addEventListener('click', () => {
                if (state.conversationHistory.length > 0) {
                    showConfirmation(
                        'close',
                        'Tem certeza que deseja fechar o assistente? Seu progresso ser√° salvo automaticamente.',
                        () => window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*')
                    );
                } else {
                    window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                }
            });
            
            // Bot√£o voltar
            elements.backBtn.addEventListener('click', () => {
                window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
            });
            
            // Bot√£o hist√≥rico
            elements.historyBtn.addEventListener('click', () => {
                showNotification(`Voc√™ tem ${state.conversationHistory.length} mensagens nesta conversa.`, 'info');
            });
            
            // Bot√£o limpar
            elements.clearBtn.addEventListener('click', () => {
                showConfirmation(
                    'clear',
                    'Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.',
                    clearHistory
                );
            });
            
            // Bot√£o API Key
            elements.apiKeyBtn.addEventListener('click', showApiKeyModal);
            
            // Bot√µes do modal API Key
            elements.apiKeySave.addEventListener('click', saveApiKey);
            elements.apiKeyCancel.addEventListener('click', () => {
                elements.apiKeyModal.style.display = 'none';
            });
            
            // Fechar modal com ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (elements.confirmationModal.style.display === 'flex') {
                        elements.confirmationModal.style.display = 'none';
                    }
                    if (elements.apiKeyModal.style.display === 'flex') {
                        elements.apiKeyModal.style.display = 'none';
                    }
                }
            });
            
            // Fechar sugest√µes ao clicar fora
            document.addEventListener('click', (e) => {
                if (!elements.suggestionsContainer.contains(e.target) && 
                    !elements.assistantInput.contains(e.target)) {
                    elements.suggestionsContainer.style.display = 'none';
                }
            });
            
            // Comunica√ß√£o com o iframe pai
            window.addEventListener('message', (e) => {
                if (e.data?.type === 'OPEN_ASSISTANT') {
                    elements.panel.style.display = 'flex';
                    setTimeout(() => elements.assistantInput.focus(), 500);
                }
                
                if (e.data?.type === 'SET_INITIAL_MESSAGE') {
                    const msg = e.data.message || getInitialGreeting();
                    addMessage(msg, 'ai');
                    state.conversationHistory.push({
                        role: 'assistant',
                        content: msg,
                        timestamp: new Date().toISOString()
                    });
                    saveHistory();
                }
                
                if (e.data?.type === 'GET_HISTORY') {
                    window.parent.postMessage({
                        type: 'HISTORY_DATA',
                        data: state.conversationHistory
                    }, '*');
                }
                
                if (e.data?.type === 'SET_API_KEY') {
                    DEEPSEEK_API_KEY = e.data.key || '';
                    if (DEEPSEEK_API_KEY) {
                        localStorage.setItem('makerai_deepseek_key', DEEPSEEK_API_KEY);
                    } else {
                        localStorage.removeItem('makerai_deepseek_key');
                    }
                    updateStatus();
                }
            });
            
            // Redimensionamento responsivo
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    state.isLandscape = window.innerWidth > window.innerHeight;
                    CONFIG.ITEMS_PER_VIEW = calculateItemsPerView();
                    updateIndicators();
                    goToSlide(state.currentSlide);
                }, 250);
            });
            
            // Pausa carrossel durante intera√ß√µes
            elements.quickOptionsCarousel.addEventListener('mouseenter', () => {
                clearInterval(state.carouselInterval);
            });
            
            elements.quickOptionsCarousel.addEventListener('mouseleave', startCarousel);
            
            elements.quickOptionsCarousel.addEventListener('touchstart', () => {
                clearInterval(state.carouselInterval);
            });
            
            elements.quickOptionsCarousel.addEventListener('touchend', () => {
                setTimeout(startCarousel, 3000);
            });
            
            // Verifica√ß√£o de conex√£o
            window.addEventListener('online', () => {
                state.isOnline = true;
                updateStatus();
                showNotification('Conex√£o restabelecida!', 'success');
            });
            
            window.addEventListener('offline', () => {
                state.isOnline = false;
                elements.statusText.textContent = 'Offline ‚Ä¢ Modo Limitado';
                showNotification('Conex√£o perdida - usando respostas locais', 'warning');
            });
            
            // Touch optimization para mobile
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Previne zoom no iOS
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Detecta dispositivo inicial
            CONFIG.ITEMS_PER_VIEW = calculateItemsPerView();
            state.isLandscape = window.innerWidth > window.innerHeight;
            
            // Inicializa componentes
            initQuickOptions();
            setupEventListeners();
            updateStatus();
            
            // Carrega hist√≥rico ou inicia nova conversa
            const hasHistory = loadHistory();
            if (!hasHistory) {
                setTimeout(() => {
                    addMessage(getInitialGreeting(), 'ai');
                }, 800);
            }
            
            // Foco autom√°tico com delay
            setTimeout(() => {
                elements.assistantInput.focus();
            }, 1200);
            
            // Notifica que est√° pronto
            setTimeout(() => {
                window.parent.postMessage({ type: 'ASSISTANT_READY' }, '*');
            }, 1000);
        });

        // Limpeza
        window.addEventListener('beforeunload', () => {
            clearInterval(state.carouselInterval);
            saveHistory();
        });
    </script>
</body>
</html>