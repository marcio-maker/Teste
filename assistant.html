<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistente IA MakerAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           VARI√ÅVEIS CSS RESPONSIVAS
           ============================================ */
        :root {
            /* Cores & Gradientes */
            --primary-gradient: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
            --secondary-gradient: linear-gradient(135deg, #5f2eff 0%, #8f6bff 100%);
            --accent-gradient: linear-gradient(135deg, #06b6d4 0%, #22d3ee 100%);
            
            /* Tema Escuro (Padr√£o) */
            --bg-primary: rgba(3, 7, 18, 0.98);
            --bg-secondary: rgba(15, 23, 42, 0.95);
            --bg-tertiary: rgba(30, 41, 59, 0.8);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
            --border-color: rgba(148, 163, 184, 0.2);
            
            /* Cores de Status */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            
            /* Sombras */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.35);
            --shadow-accent: 0 8px 32px rgba(124, 58, 237, 0.25);
            
            /* Bordas */
            --radius-xs: 6px;
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-full: 9999px;
            
            /* Transi√ß√µes */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Dimens√µes Responsivas (VALORES INICIAIS - MOBILE FIRST) */
            --header-height: 56px;
            --input-height: 48px;
            --quick-option-height: 48px;
        }

        /* Tema Claro */
        [data-theme="light"] {
            --bg-primary: rgba(248, 250, 252, 0.98);
            --bg-secondary: rgba(241, 245, 249, 0.95);
            --bg-tertiary: rgba(226, 232, 240, 0.8);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --border-color: rgba(100, 116, 139, 0.15);
        }

        /* ============================================
           RESET & BASE
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        body {
            background: transparent;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
        }

        /* ============================================
           CONTAINER PRINCIPAL
           ============================================ */
        .assistant-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            animation: containerIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            width: 100%;
            height: 100%;
        }

        @keyframes containerIn {
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* ============================================
           HEADER OTIMIZADO
           ============================================ */
        .assistant-header {
            padding: 0 16px;
            background: linear-gradient(135deg, 
                rgba(124, 58, 237, 0.2), 
                rgba(139, 92, 246, 0.1));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
            height: var(--header-height);
            min-height: var(--header-height);
        }

        .assistant-header::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-gradient);
            opacity: 0.5;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            flex-shrink: 0;
            box-shadow: var(--shadow-accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .assistant-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-indicator {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
            white-space: nowrap;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--success);
            animation: blink 2s infinite;
            flex-shrink: 0;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
            position: relative;
            flex-shrink: 0;
        }

        .icon-btn:hover {
            background: rgba(124, 58, 237, 0.15);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .icon-btn[data-badge]::after {
            content: attr(data-badge);
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--error);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 18px;
            text-align: center;
            border: 2px solid var(--bg-primary);
        }

        /* ============================================
           √ÅREA DE MENSAGENS
           ============================================ */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(124, 58, 237, 0.02) 10%,
                transparent 90%
            );
            position: relative;
            min-height: 0; /* Importante para flex */
        }

        .messages-area::-webkit-scrollbar {
            width: 6px;
        }

        .messages-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
        }

        .messages-area::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
        }

        /* Mensagens */
        .message {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: var(--radius-md);
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            font-size: 15px;
            box-shadow: var(--shadow-sm);
            animation: messageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(10px);
            word-break: break-word;
            overflow-wrap: break-word;
        }

        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-user {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-xs);
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-ai {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-xs);
            border: 1px solid var(--border-color);
        }

        .message-time {
            display: block;
            font-size: 11px;
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
            font-weight: 500;
        }

        /* Indicador de digita√ß√£o */
        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            align-self: flex-start;
            border: 1px solid var(--border-color);
            animation: typingIn 0.3s ease;
            max-width: 120px;
        }

        @keyframes typingIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--accent-gradient);
            opacity: 0.4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { 
                opacity: 0.4; 
                transform: translateY(0px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-4px); 
            }
        }

        /* ============================================
           CARROSSEL DE SUGEST√ïES
           ============================================ */
        .suggestions-section {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            flex-shrink: 0;
            position: relative;
        }

        .suggestions-section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--primary-gradient);
            opacity: 0.3;
        }

        .suggestions-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .suggestions-title i {
            color: #7c3aed;
        }

        .suggestions-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 12px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
        }

        .suggestions-carousel::-webkit-scrollbar {
            display: none;
        }

        .suggestion-option {
            flex: 0 0 auto;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
            height: var(--quick-option-height);
            min-width: 180px;
        }

        .suggestion-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 0;
        }

        .suggestion-option > * {
            position: relative;
            z-index: 1;
        }

        .suggestion-option:hover {
            border-color: #7c3aed;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .suggestion-option:hover::before {
            opacity: 0.1;
        }

        .suggestion-option:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .suggestion-option i {
            color: #7c3aed;
            font-size: 14px;
        }

        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .carousel-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: rgba(148, 163, 184, 0.2);
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
            padding: 0;
            flex-shrink: 0;
        }

        .carousel-dot.active {
            background: var(--primary-gradient);
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(124, 58, 237, 0.5);
        }

        /* ============================================
           √ÅREA DE INPUT
           ============================================ */
        .input-section {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background: var(--bg-secondary);
            align-items: center;
            flex-shrink: 0;
            position: relative;
        }

        .input-section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--primary-gradient);
            opacity: 0.3;
        }

        #userInput {
            flex: 1;
            padding: 14px 18px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
            height: var(--input-height);
            min-height: var(--input-height);
        }

        #userInput:focus {
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.05);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        #userInput::placeholder {
            color: var(--text-tertiary);
        }

        .send-button {
            background: var(--primary-gradient);
            border: none;
            width: var(--input-height);
            height: var(--input-height);
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 16px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-accent);
        }

        .send-button:hover::before {
            opacity: 1;
        }

        .send-button:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* ============================================
           MODAIS
           ============================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .modal-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* ============================================
           RESPONSIVIDADE COMPLETA E MELHORADA
           ============================================ */

        /* Mobile (480px e abaixo) - Mobile First */
        @media (max-width: 480px) {
            :root {
                --header-height: 56px;
                --input-height: 48px;
                --quick-option-height: 48px;
            }
            
            .assistant-header {
                padding: 0 12px;
            }
            
            .ai-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .assistant-title {
                font-size: 15px;
            }
            
            .icon-btn {
                width: 32px;
                height: 32px;
            }
            
            .messages-area {
                padding: 12px;
                gap: 12px;
            }
            
            .message {
                max-width: 92%;
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .suggestion-option {
                padding: 10px 14px;
                font-size: 12.5px;
                min-width: calc(100vw - 100px);
            }
            
            #userInput {
                padding: 12px 16px;
                font-size: 16px;
            }
            
            .send-button {
                width: 44px;
                height: 44px;
            }
            
            /* Safe area para dispositivos m√≥veis */
            .input-section,
            .suggestions-section {
                padding-left: max(12px, env(safe-area-inset-left));
                padding-right: max(12px, env(safe-area-inset-right));
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }
            
            .messages-area {
                padding-left: max(12px, env(safe-area-inset-left));
                padding-right: max(12px, env(safe-area-inset-right));
            }
        }

        /* Mobile M√©dio (481px a 767px) */
        @media (min-width: 481px) and (max-width: 767px) {
            :root {
                --header-height: 60px;
                --input-height: 52px;
                --quick-option-height: 52px;
            }
            
            .assistant-header {
                padding: 0 16px;
            }
            
            .ai-avatar {
                width: 34px;
                height: 34px;
                font-size: 15px;
            }
            
            .assistant-title {
                font-size: 16px;
            }
            
            .messages-area {
                padding: 16px;
            }
            
            .message {
                max-width: 90%;
                font-size: 14.5px;
            }
            
            .suggestion-option {
                min-width: 200px;
            }
        }

        /* Tablet (768px a 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            :root {
                --header-height: 64px;
                --input-height: 56px;
                --quick-option-height: 56px;
            }
            
            .assistant-container {
                max-width: 600px;
                max-height: 85vh;
                margin: auto;
                border-radius: var(--radius-lg);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.98);
                animation: containerIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            }
            
            @keyframes containerIn {
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
            
            .assistant-header {
                padding: 0 24px;
            }
            
            .ai-avatar {
                width: 38px;
                height: 38px;
                font-size: 17px;
            }
            
            .assistant-title {
                font-size: 17px;
            }
            
            .messages-area {
                padding: 24px;
                gap: 20px;
            }
            
            .message {
                max-width: 80%;
                font-size: 16px;
                padding: 16px 20px;
            }
            
            .suggestion-option {
                padding: 14px 20px;
                font-size: 14px;
                min-width: 180px;
                flex: 0 0 calc(50% - 10px);
            }
            
            #userInput {
                padding: 16px 20px;
                font-size: 16px;
            }
            
            .send-button {
                width: 56px;
                height: 56px;
            }
        }

        /* Desktop (1024px a 1439px) */
        @media (min-width: 1024px) and (max-width: 1439px) {
            :root {
                --header-height: 68px;
                --input-height: 56px;
                --quick-option-height: 56px;
            }
            
            .assistant-container {
                max-width: 480px;
                max-height: 85vh;
                margin: auto;
                border-radius: var(--radius-lg);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.98);
                animation: containerIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            }
            
            @keyframes containerIn {
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
            
            .assistant-header {
                padding: 0 24px;
            }
            
            .ai-avatar {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .assistant-title {
                font-size: 17px;
            }
            
            .messages-area {
                padding: 24px;
            }
            
            .message {
                max-width: 75%;
            }
            
            .suggestion-option {
                flex: 0 0 calc(33.333% - 12px);
                min-width: 150px;
            }
            
            #userInput {
                font-size: 15px;
            }
        }

        /* Desktop Grande (1440px e acima) */
        @media (min-width: 1440px) {
            :root {
                --header-height: 72px;
                --input-height: 60px;
                --quick-option-height: 60px;
            }
            
            .assistant-container {
                max-width: 520px;
                max-height: 85vh;
                margin: auto;
                border-radius: var(--radius-lg);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(0.98);
                animation: containerIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            }
            
            @keyframes containerIn {
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }
            
            .assistant-header {
                padding: 0 28px;
            }
            
            .ai-avatar {
                width: 44px;
                height: 44px;
                font-size: 20px;
            }
            
            .assistant-title {
                font-size: 18px;
            }
            
            .messages-area {
                padding: 28px;
            }
            
            .message {
                max-width: 70%;
            }
            
            .suggestion-option {
                flex: 0 0 calc(25% - 12px);
                min-width: 140px;
                padding: 16px 20px;
                font-size: 14.5px;
            }
            
            #userInput {
                padding: 18px 22px;
                font-size: 16px;
            }
        }

        /* Modo paisagem em mobile */
        @media (max-width: 767px) and (orientation: landscape) {
            :root {
                --header-height: 48px;
                --input-height: 44px;
                --quick-option-height: 44px;
            }
            
            .assistant-header {
                padding: 0 10px;
            }
            
            .ai-avatar {
                width: 30px;
                height: 30px;
                font-size: 13px;
            }
            
            .assistant-title {
                font-size: 14px;
            }
            
            .messages-area {
                padding: 10px;
                max-height: 50vh;
            }
            
            .message {
                max-width: 85%;
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .suggestion-option {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 160px;
            }
            
            #userInput {
                padding: 10px 14px;
            }
        }

        /* Altura limitada */
        @media (max-height: 600px) {
            .assistant-container {
                border-radius: 0;
            }
            
            .messages-area {
                padding-top: 8px;
                padding-bottom: 8px;
            }
            
            .message {
                padding: 10px 14px;
                font-size: 13.5px;
            }
            
            .suggestions-section,
            .input-section {
                padding-top: 12px;
                padding-bottom: 12px;
            }
            
            .suggestion-option {
                padding: 8px 12px;
                height: 44px;
            }
            
            #userInput {
                padding: 10px 14px;
                height: 44px;
            }
            
            .send-button {
                width: 44px;
                height: 44px;
            }
        }

        /* Ajustes para redu√ß√£o de movimento */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
            
            .assistant-container {
                opacity: 1;
                transform: none;
                animation: none;
            }
            
            .message {
                opacity: 1;
                transform: none;
                animation: none;
            }
            
            .typing-indicator span {
                animation: none;
            }
        }

        /* Otimiza√ß√£o para telas de alta densidade */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .assistant-container {
                -webkit-backdrop-filter: blur(40px) saturate(200%);
                backdrop-filter: blur(40px) saturate(200%);
            }
        }

        /* Suporte para navegadores antigos */
        @supports not (backdrop-filter: blur(10px)) {
            .assistant-container {
                background: rgba(3, 7, 18, 0.98);
            }
            
            .messages-area {
                background: transparent;
            }
        }
    </style>
</head>
<body>
    <!-- Container Principal -->
    <div class="assistant-container" id="assistantContainer">
        <!-- Header -->
        <div class="assistant-header">
            <div class="header-left">
                <div class="ai-avatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="header-info">
                    <div class="assistant-title">Assistente MakerAI</div>
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span id="statusText">Online ‚Ä¢ IA Generativa</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="historyBtn" aria-label="Hist√≥rico" data-badge="0">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" id="clearBtn" aria-label="Limpar conversa">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="icon-btn" id="settingsBtn" aria-label="Configura√ß√µes">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="icon-btn" id="closeBtn" aria-label="Fechar assistente">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- √Årea de Mensagens -->
        <div class="messages-area" id="messagesArea">
            <!-- Mensagens ser√£o inseridas aqui -->
        </div>

        <!-- Sugest√µes em Carrossel -->
        <div class="suggestions-section" id="suggestionsSection">
            <div class="suggestions-title">
                <i class="fas fa-bolt"></i> Perguntas r√°pidas
            </div>
            <div class="suggestions-carousel" id="suggestionsCarousel">
                <!-- Op√ß√µes ser√£o geradas dinamicamente -->
            </div>
            <div class="carousel-dots" id="carouselDots">
                <!-- Pontos ser√£o gerados dinamicamente -->
            </div>
        </div>

        <!-- √Årea de Input -->
        <div class="input-section">
            <input 
                type="text" 
                id="userInput" 
                placeholder="Digite sua mensagem..." 
                aria-label="Mensagem para o assistente"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                maxlength="500"
            >
            <button class="send-button" id="sendButton" aria-label="Enviar mensagem">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Limpar conversa</h3>
                <p class="modal-description" id="modalDescription">
                    Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.
                </p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="modalCancel">Cancelar</button>
                <button class="modal-btn primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√£o da API -->
    <div class="modal-overlay" id="apiConfigModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üîë Configurar DeepSeek API</h3>
                <p class="modal-description">
                    Para respostas mais avan√ßadas, insira sua chave da DeepSeek API.
                    <br><br>
                    <small style="color: var(--text-tertiary);">
                        A chave fica armazenada apenas no seu navegador.
                    </small>
                </p>
            </div>
            <div style="margin: 20px 0;">
                <input 
                    type="password" 
                    id="apiKeyInput" 
                    placeholder="Cole sua chave API (sk-...)" 
                    autocomplete="off"
                    style="
                        width: 100%;
                        padding: 12px 16px;
                        border-radius: var(--radius-md);
                        border: 1px solid var(--border-color);
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        font-size: 14px;
                        outline: none;
                    "
                >
                <small style="display: block; margin-top: 8px; color: var(--text-tertiary); font-size: 12px;">
                    Obtenha sua chave em: 
                    <a href="https://platform.deepseek.com/api_keys" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       style="color: #7c3aed; text-decoration: none;">
                        platform.deepseek.com/api_keys
                    </a>
                </small>
            </div>
            <div class="modal-actions">
                <button class="modal-btn" id="apiConfigCancel">Cancelar</button>
                <button class="modal-btn primary" id="apiConfigSave">Salvar Chave</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ïES E CONSTANTES
        // ============================================
        const CONFIG = {
            // API Configuration
            DEEPSEEK_API_URL: "https://api.deepseek.com/v1/chat/completions",
            DEEPSEEK_MODEL: "deepseek-chat",
            MAX_TOKENS: 1000,
            TEMPERATURE: 0.7,
            
            // UI Configuration
            CAROUSEL_INTERVAL: 5000, // 5 seconds
            TYPING_DELAY: 800, // milliseconds
            SESSION_TIMEOUT: 30 * 60 * 1000, // 30 minutes
            MAX_MESSAGES: 100,
            SUGGESTIONS_LIMIT: 8,
            
            // Storage Keys
            STORAGE_KEYS: {
                HISTORY: 'makerai_assistant_history',
                API_KEY: 'makerai_deepseek_api_key',
                SETTINGS: 'makerai_assistant_settings'
            }
        };

        // ============================================
        // DADOS DA AG√äNCIA (Conte√∫do Local)
        // ============================================
        const AGENCY_KNOWLEDGE = {
            services: {
                web: {
                    title: "Desenvolvimento Web",
                    items: [
                        "Sites institucionais e corporativos",
                        "Progressive Web Apps (PWAs)",
                        "Landing pages otimizadas",
                        "Sistemas web complexos"
                    ],
                    pricing: {
                        basic: "R$ 8.000 - R$ 25.000",
                        advanced: "R$ 40.000 - R$ 150.000"
                    }
                },
                mobile: {
                    title: "Aplicativos Mobile",
                    items: [
                        "Apps nativos (iOS/Android)",
                        "React Native & Flutter",
                        "Apps h√≠bridos",
                        "Integra√ß√£o com APIs"
                    ],
                    pricing: {
                        basic: "R$ 30.000 - R$ 80.000",
                        enterprise: "R$ 80.000+"
                    }
                },
                ai: {
                    title: "Intelig√™ncia Artificial",
                    items: [
                        "Chatbots inteligentes",
                        "An√°lise preditiva",
                        "Processamento de linguagem",
                        "Vis√£o computacional"
                    ],
                    pricing: {
                        basic: "R$ 15.000 - R$ 50.000",
                        advanced: "R$ 50.000+"
                    }
                },
                design: {
                    title: "Design & UX",
                    items: [
                        "UI/UX Design premium",
                        "Design Systems",
                        "Prototipagem interativa",
                        "Identidade visual"
                    ],
                    pricing: {
                        basic: "R$ 5.000 - R$ 20.000",
                        complete: "R$ 20.000+"
                    }
                }
            },
            
            portfolio: [
                {
                    category: "Sa√∫de",
                    projects: [
                        "App de telemedicina com IA",
                        "Sistema de gest√£o para cl√≠nicas",
                        "Plataforma de wellness corporativo"
                    ]
                },
                {
                    category: "E-commerce",
                    projects: [
                        "Marketplace com recomenda√ß√£o IA",
                        "E-commerce com realidade aumentada",
                        "Sistema de log√≠stica integrado"
                    ]
                },
                {
                    category: "Educa√ß√£o",
                    projects: [
                        "Plataforma E-learning gamificada",
                        "App de cursos com tutoria IA",
                        "Sistema de gest√£o escolar"
                    ]
                }
            ],
            
            process: [
                { step: 1, title: "Descoberta", desc: "An√°lise de requisitos" },
                { step: 2, title: "Prot√≥tipo", desc: "Wireframes e valida√ß√£o" },
                { step: 3, title: "Desenvolvimento", desc: "Implementa√ß√£o com sprints" },
                { step: 4, title: "Testes", desc: "QA e otimiza√ß√£o" },
                { step: 5, title: "Lan√ßamento", desc: "Deploy e treinamento" },
                { step: 6, title: "Manuten√ß√£o", desc: "Suporte cont√≠nuo" }
            ],
            
            contact: {
                email: "contato@makerai.com.br",
                phone: "(11) 99999-9999",
                location: "S√£o Paulo - SP",
                hours: "Segunda a Sexta: 9h √†s 18h"
            }
        };

        // ============================================
        // ELEMENTOS DOM
        // ============================================
        const elements = {
            // Container
            container: document.getElementById('assistantContainer'),
            
            // Header
            statusText: document.getElementById('statusText'),
            historyBtn: document.getElementById('historyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            closeBtn: document.getElementById('closeBtn'),
            
            // Messages
            messagesArea: document.getElementById('messagesArea'),
            
            // Input
            userInput: document.getElementById('userInput'),
            sendButton: document.getElementById('sendButton'),
            
            // Carousel
            suggestionsCarousel: document.getElementById('suggestionsCarousel'),
            carouselDots: document.getElementById('carouselDots'),
            
            // Modals
            confirmationModal: document.getElementById('confirmationModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalDescription: document.getElementById('modalDescription'),
            modalCancel: document.getElementById('modalCancel'),
            modalConfirm: document.getElementById('modalConfirm'),
            
            apiConfigModal: document.getElementById('apiConfigModal'),
            apiKeyInput: document.getElementById('apiKeyInput'),
            apiConfigCancel: document.getElementById('apiConfigCancel'),
            apiConfigSave: document.getElementById('apiConfigSave')
        };

        // ============================================
        // ESTADO DA APLICA√á√ÉO
        // ============================================
        const state = {
            // Conversa√ß√£o
            conversation: [],
            isProcessing: false,
            messageCount: 0,
            
            // Carrossel
            carouselInterval: null,
            currentSlide: 0,
            slidesCount: 0,
            
            // API
            deepseekApiKey: localStorage.getItem(CONFIG.STORAGE_KEYS.API_KEY) || '',
            useDeepSeek: false,
            
            // Performance
            typingTimeout: null,
            isOnline: navigator.onLine,
            sessionId: generateSessionId(),
            
            // Responsividade
            isMobile: window.innerWidth <= 767,
            isTablet: window.innerWidth >= 768 && window.innerWidth <= 1023,
            isDesktop: window.innerWidth >= 1024,
            itemsPerView: calculateItemsPerView(),
            
            // UI State
            isModalOpen: false
        };

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function sanitizeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        function calculateItemsPerView() {
            const width = window.innerWidth;
            if (width < 480) return 1;     // Mobile pequeno: 1 item
            if (width < 768) return 1.5;   // Mobile m√©dio: 1.5 items (scroll parcial)
            if (width < 1024) return 2;    // Tablet: 2 items
            if (width < 1440) return 3;    // Desktop m√©dio: 3 items
            return 4;                      // Desktop grande: 4 items
        }

        // ============================================
        // SISTEMA DE MENSAGENS
        // ============================================
        function addMessage(text, sender, timestamp = new Date()) {
            // Limita mensagens para performance
            if (state.messageCount > CONFIG.MAX_MESSAGES) {
                const messages = elements.messagesArea.querySelectorAll('.message');
                if (messages.length > CONFIG.MAX_MESSAGES) {
                    messages[0].remove();
                }
            }

            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            messageDiv.dataset.messageId = messageId;
            
            const formattedTime = formatTime(timestamp);
            
            // Processa markdown b√°sico
            let processedText = sanitizeHTML(text)
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/# (.*?)(\n|$)/g, '<h4>$1</h4>')
                .replace(/- (.*?)(\n|$)/g, '<li>$1</li>')
                .replace(/\n/g, '<br>');
            
            messageDiv.innerHTML = `
                ${processedText}
                <span class="message-time">${formattedTime}</span>
            `;
            
            // Anima√ß√£o otimizada para performance
            if (state.messageCount < 30) {
                const delay = state.messageCount * 0.05;
                messageDiv.style.animationDelay = `${delay}s`;
            } else {
                messageDiv.style.animation = 'none';
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'none';
            }
            
            elements.messagesArea.appendChild(messageDiv);
            
            // Scroll suave com debounce
            clearTimeout(state.typingTimeout);
            state.typingTimeout = setTimeout(() => {
                messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 100);
            
            // Atualiza estado
            state.messageCount++;
            state.conversation.push({
                id: messageId,
                sender,
                content: text,
                timestamp: timestamp.toISOString()
            });
            
            // Salva hist√≥rico
            saveConversation();
            
            return messageId;
        }

        function showTypingIndicator() {
            if (document.querySelector('.typing-indicator')) return;
            
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            elements.messagesArea.appendChild(typing);
            
            // Scroll para o indicador
            requestAnimationFrame(() => {
                typing.scrollIntoView({ behavior: 'smooth', block: 'end' });
            });
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // ============================================
        // GERENCIAMENTO DE HIST√ìRICO
        // ============================================
        function saveConversation() {
            try {
                const history = {
                    sessionId: state.sessionId,
                    conversation: state.conversation,
                    messageCount: state.messageCount,
                    lastUpdated: new Date().toISOString(),
                    settings: {
                        useDeepSeek: state.useDeepSeek,
                        deepseekApiKey: state.deepseekApiKey ? '***' : ''
                    }
                };
                
                localStorage.setItem(CONFIG.STORAGE_KEYS.HISTORY, JSON.stringify(history));
                updateHistoryBadge();
            } catch (error) {
                console.warn('N√£o foi poss√≠vel salvar hist√≥rico:', error);
            }
        }

        function loadConversation() {
            try {
                const saved = localStorage.getItem(CONFIG.STORAGE_KEYS.HISTORY);
                if (!saved) return false;
                
                const history = JSON.parse(saved);
                
                // Verifica se a sess√£o √© muito antiga (24 horas)
                const lastUpdated = new Date(history.lastUpdated);
                const now = new Date();
                const diffHours = (now - lastUpdated) / (1000 * 60 * 60);
                
                if (diffHours < 24) {
                    state.conversation = history.conversation || [];
                    state.messageCount = history.messageCount || 0;
                    
                    // Renderiza hist√≥rico sem anima√ß√µes para performance
                    elements.messagesArea.innerHTML = '';
                    state.conversation.forEach(msg => {
                        const timestamp = msg.timestamp ? new Date(msg.timestamp) : new Date();
                        addMessage(msg.content, msg.sender, timestamp);
                    });
                    
                    updateHistoryBadge();
                    return true;
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
            
            return false;
        }

        function clearConversation() {
            // Confirma√ß√£o j√° foi feita no modal
            state.conversation = [];
            state.messageCount = 0;
            elements.messagesArea.innerHTML = '';
            
            // Remove do localStorage
            localStorage.removeItem(CONFIG.STORAGE_KEYS.HISTORY);
            
            // Atualiza badge
            updateHistoryBadge();
            
            // Adiciona mensagem de boas-vindas
            setTimeout(() => {
                addMessage(getWelcomeMessage(), 'ai');
            }, 300);
        }

        function updateHistoryBadge() {
            const badge = elements.historyBtn;
            const userMessages = state.conversation.filter(m => m.sender === 'user').length;
            badge.dataset.badge = userMessages > 0 ? userMessages : '';
        }

        // ============================================
        // CARROSSEL DE SUGEST√ïES
        // ============================================
        function initCarousel() {
            // Op√ß√µes do carrossel
            const quickOptions = [
                { icon: 'fas fa-cogs', text: 'Servi√ßos', query: 'Quais servi√ßos voc√™s oferecem?' },
                { icon: 'fas fa-money-bill-wave', text: 'Or√ßamento', query: 'Quanto custa um site?' },
                { icon: 'fas fa-images', text: 'Portf√≥lio', query: 'Podem mostrar alguns projetos?' },
                { icon: 'fas fa-users', text: 'Equipe', query: 'Quem faz parte da equipe?' },
                { icon: 'fas fa-clock', text: 'Prazos', query: 'Quanto tempo leva um projeto?' },
                { icon: 'fas fa-envelope', text: 'Contato', query: 'Como posso entrar em contato?' },
                { icon: 'fas fa-robot', text: 'IA', query: 'Voc√™s trabalham com intelig√™ncia artificial?' },
                { icon: 'fas fa-shopping-cart', text: 'E-commerce', query: 'Fazem lojas virtuais?' }
            ];
            
            // Limpa o carrossel
            elements.suggestionsCarousel.innerHTML = '';
            
            // Adiciona op√ß√µes
            quickOptions.forEach((option, index) => {
                const optionElement = document.createElement('button');
                optionElement.className = 'suggestion-option';
                optionElement.innerHTML = `
                    <i class="${option.icon}"></i>
                    <span>${option.text}</span>
                `;
                optionElement.onclick = () => {
                    elements.userInput.value = option.query;
                    sendMessage();
                };
                elements.suggestionsCarousel.appendChild(optionElement);
            });
            
            // Calcula slides
            state.itemsPerView = calculateItemsPerView();
            state.slidesCount = Math.ceil(quickOptions.length / Math.floor(state.itemsPerView));
            
            // Atualiza dots
            updateCarouselDots();
            
            // Inicia carrossel autom√°tico
            startCarousel();
        }

        function updateCarouselDots() {
            elements.carouselDots.innerHTML = '';
            
            for (let i = 0; i < state.slidesCount; i++) {
                const dot = document.createElement('button');
                dot.className = `carousel-dot ${i === state.currentSlide ? 'active' : ''}`;
                dot.setAttribute('aria-label', `Slide ${i + 1}`);
                dot.onclick = () => goToSlide(i);
                elements.carouselDots.appendChild(dot);
            }
        }

        function goToSlide(slideIndex) {
            if (slideIndex < 0) slideIndex = state.slidesCount - 1;
            if (slideIndex >= state.slidesCount) slideIndex = 0;
            
            state.currentSlide = slideIndex;
            
            // Calcula scroll
            const carousel = elements.suggestionsCarousel;
            const items = carousel.children;
            if (items.length > 0) {
                const itemWidth = items[0].offsetWidth + 10; // width + gap
                const scrollAmount = slideIndex * Math.floor(state.itemsPerView) * itemWidth;
                carousel.scrollTo({ left: scrollAmount, behavior: 'smooth' });
            }
            
            // Atualiza dots
            updateCarouselDots();
            
            // Reinicia carrossel autom√°tico
            restartCarousel();
        }

        function startCarousel() {
            if (state.carouselInterval) clearInterval(state.carouselInterval);
            
            state.carouselInterval = setInterval(() => {
                goToSlide(state.currentSlide + 1);
            }, CONFIG.CAROUSEL_INTERVAL);
        }

        function restartCarousel() {
            clearInterval(state.carouselInterval);
            startCarousel();
        }

        // Pausa carrossel durante intera√ß√£o
        function pauseCarousel() {
            clearInterval(state.carouselInterval);
        }

        // ============================================
        // RESPOSTAS INTELIGENTES
        // ============================================
        function getWelcomeMessage() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = "Bom dia";
            else if (hour < 18) greeting = "Boa tarde";
            else greeting = "Boa noite";
            
            const messages = [
                `${greeting}! üëã Sou o assistente da MakerAI Studio. Como posso te ajudar hoje?`,
                `${greeting}! üòä Aqui √© o assistente da MakerAI. Pronto para criar algo incr√≠vel juntos?`,
                `${greeting}! üöÄ Eu sou o assistente da MakerAI. Vamos transformar sua ideia em realidade?`
            ];
            
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function analyzeIntent(message) {
            const lowerMsg = message.toLowerCase();
            
            // Palavras-chave e seus pesos
            const intents = {
                greeting: ['oi', 'ol√°', 'ola', 'bom dia', 'boa tarde', 'boa noite', 'hello', 'hi'],
                services: ['servi√ßo', 'desenvolvimento', 'site', 'app', 'sistema', 'web', 'mobile', 'programa√ß√£o'],
                pricing: ['pre√ßo', 'valor', 'custo', 'or√ßamento', 'quanto custa', 'investimento'],
                portfolio: ['portf√≥lio', 'cases', 'projetos', 'trabalhos', 'exemplos'],
                team: ['equipe', 'time', 'profissionais', 'quem s√£o', 'desenvolvedores'],
                contact: ['contato', 'whatsapp', 'email', 'telefone', 'falar', 'conversar'],
                timeline: ['prazo', 'tempo', 'quanto tempo', 'quando fica pronto', 'data'],
                technical: ['tecnologia', 'tecnico', 'codigo', 'api', 'banco de dados', 'frontend', 'backend'],
                ai: ['ia', 'intelig√™ncia artificial', 'machine learning', 'chatbot', 'deep learning'],
                ecommerce: ['e-commerce', 'loja virtual', 'shop', 'carrinho', 'pagamento']
            };
            
            // Encontra inten√ß√£o principal
            let mainIntent = 'generic';
            let maxMatches = 0;
            
            for (const [intent, keywords] of Object.entries(intents)) {
                const matches = keywords.filter(keyword => lowerMsg.includes(keyword)).length;
                if (matches > maxMatches) {
                    maxMatches = matches;
                    mainIntent = intent;
                }
            }
            
            return {
                mainIntent,
                confidence: maxMatches / Math.max(...Object.values(intents).map(arr => arr.length)),
                hasQuestion: /\?$/.test(message),
                wordCount: lowerMsg.split(/\s+/).length
            };
        }

        function getLocalResponse(intent, message) {
            switch (intent.mainIntent) {
                case 'greeting':
                    const hour = new Date().getHours();
                    let timeGreeting = hour < 12 ? 'Bom dia' : hour < 18 ? 'Boa tarde' : 'Boa noite';
                    return `${timeGreeting}! üòä\n\nSou o assistente da MakerAI Studio, especializado em transformar ideias em solu√ß√µes digitais incr√≠veis.\n\nNo que posso te ajudar hoje? Pode me contar sobre seu projeto, tirar d√∫vidas sobre or√ßamentos ou conhecer nossos cases de sucesso!`;
                
                case 'services':
                    return `üöÄ **Nossos Servi√ßos Principais**\n\n` +
                           `**üíª Desenvolvimento Web & Mobile**\n` +
                           `‚Ä¢ Sites institucionais e corporativos\n` +
                           `‚Ä¢ Progressive Web Apps (PWAs)\n` +
                           `‚Ä¢ E-commerce e marketplaces\n` +
                           `‚Ä¢ Aplicativos nativos (React Native/Flutter)\n` +
                           `‚Ä¢ Sistemas web complexos\n\n` +
                           `**ü§ñ Intelig√™ncia Artificial**\n` +
                           `‚Ä¢ Assistentes virtuais e chatbots\n` +
                           `‚Ä¢ An√°lise preditiva de dados\n` +
                           `‚Ä¢ Processamento de linguagem natural\n` +
                           `‚Ä¢ Vis√£o computacional\n` +
                           `‚Ä¢ Automa√ß√£o com IA\n\n` +
                           `**üé® Design & Experi√™ncia**\n` +
                           `‚Ä¢ UI/UX Design premium\n` +
                           `‚Ä¢ Identidade visual\n` +
                           `‚Ä¢ Prototipagem interativa\n` +
                           `‚Ä¢ Design System\n` +
                           `‚Ä¢ Microintera√ß√µes\n\n` +
                           `*Qual √°rea voc√™ gostaria de explorar?* üòä`;
                
                case 'pricing':
                    return `üí∞ **Transpar√™ncia Total nos Valores**\n\n` +
                           `**üìä Modelos de Pre√ßo**\n` +
                           `1. **Projeto Fixo** - Escopo definido, prazo fechado\n` +
                           `   ‚Ä¢ Sites: R$ 8.000 - R$ 25.000\n` +
                           `   ‚Ä¢ Apps: R$ 30.000 - R$ 80.000\n` +
                           `   ‚Ä¢ Sistemas: R$ 40.000 - R$ 150.000\n\n` +
                           `2. **Horas Avulsas** - R$ 120/hora\n` +
                           `   ‚Ä¢ Para ajustes e melhorias\n` +
                           `   ‚Ä¢ Manuten√ß√£o cont√≠nua\n` +
                           `   ‚Ä¢ Consultorias t√©cnicas\n\n` +
                           `3. **Assinatura Mensal** - A partir de R$ 1.500/m√™s\n` +
                           `   ‚Ä¢ Suporte priorit√°rio\n` +
                           `   ‚Ä¢ Atualiza√ß√µes constantes\n` +
                           `   ‚Ä¢ Monitoramento 24/7\n\n` +
                           `**üéØ Fatores que Influenciam:**\n` +
                           `‚Ä¢ Complexidade do projeto\n` +
                           `‚Ä¢ Prazo de entrega\n` +
                           `‚Ä¢ Integra√ß√µes necess√°rias\n` +
                           `‚Ä¢ N√≠vel de design\n` +
                           `‚Ä¢ Recursos de IA inclu√≠dos\n\n` +
                           `*Posso te passar uma estimativa mais precisa se voc√™ me contar sobre seu projeto!* ‚ú®`;
                
                case 'portfolio':
                    return `üé® **Cases de Sucesso**\n\n` +
                           `**üè• Sa√∫de & Bem-estar**\n` +
                           `‚Ä¢ App de telemedicina com IA\n` +
                           `‚Ä¢ Sistema de gest√£o para cl√≠nicas\n` +
                           `‚Ä¢ Plataforma de wellness corporativo\n\n` +
                           `**üè¢ Empresarial**\n` +
                           `‚Ä¢ Dashboard de BI em tempo real\n` +
                           `‚Ä¢ Sistema de automa√ß√£o de processos\n` +
                           `‚Ä¢ CRM personalizado com IA\n\n` +
                           `**üõí E-commerce**\n` +
                           `‚Ä¢ Marketplace com recomenda√ß√£o IA\n` +
                           `‚Ä¢ E-commerce com realidade aumentada\n` +
                           `‚Ä¢ Sistema de log√≠stica integrado\n\n` +
                           `**üéì Educa√ß√£o**\n` +
                           `‚Ä¢ Plataforma E-learning gamificada\n` +
                           `‚Ä¢ App de cursos com tutoria IA\n` +
                           `‚Ä¢ Sistema de gest√£o escolar\n\n` +
                           `*Tem algum setor espec√≠fico que te interessa? Posso detalhar cases similares!* üìä`;
                
                case 'contact':
                    return `üìû **Vamos Conversar!**\n\n` +
                           `**üì± Canais Diretos**\n` +
                           `‚Ä¢ WhatsApp: ${AGENCY_KNOWLEDGE.contact.phone}\n` +
                           `‚Ä¢ Email: ${AGENCY_KNOWLEDGE.contact.email}\n` +
                           `‚Ä¢ LinkedIn: /makerai-studio\n\n` +
                           `**üìç Endere√ßo**\n` +
                           `‚Ä¢ ${AGENCY_KNOWLEDGE.contact.location}\n` +
                           `‚Ä¢ Atendimento remoto em todo Brasil\n\n` +
                           `**‚è∞ Hor√°rio de Atendimento**\n` +
                           `‚Ä¢ ${AGENCY_KNOWLEDGE.contact.hours}\n` +
                           `‚Ä¢ Plant√£o t√©cnico: 24/7\n\n` +
                           `**üéØ Pr√≥ximos Passos:**\n` +
                           `1. Agendamos uma call explorat√≥ria\n` +
                           `2. Analisamos suas necessidades\n` +
                           `3. Criamos uma proposta personalizada\n` +
                           `4. Iniciamos o projeto!\n\n` +
                           `*Prefere que eu te direcione para o formul√°rio ou j√° quer marcar uma call?* üöÄ`;
                
                case 'timeline':
                    return `‚è∞ **Prazos de Entrega**\n\n` +
                           `‚Ä¢ **Landing Page**: 1-2 semanas\n` +
                           `‚Ä¢ **Site Institucional**: 3-6 semanas\n` +
                           `‚Ä¢ **E-commerce B√°sico**: 4-8 semanas\n` +
                           `‚Ä¢ **PWA Completo**: 6-12 semanas\n` +
                           `‚Ä¢ **Sistema com IA**: 8-16 semanas\n\n` +
                           `**üìã Nosso Processo:**\n` +
                           `1. Descoberta (1-2 semanas)\n` +
                           `2. Prot√≥tipo (1-2 semanas)\n` +
                           `3. Desenvolvimento (varia por projeto)\n` +
                           `4. Testes (1-2 semanas)\n` +
                           `5. Lan√ßamento (1 semana)\n\n` +
                           `*Estes s√£o prazos estimados. Podemos fornecer um cronograma mais preciso ap√≥s entender suas necessidades espec√≠ficas.*`;
                
                default:
                    const genericResponses = [
                        `Interessante! üßê\n\nNo que mais posso te ajudar sobre isso? Se for sobre desenvolvimento, IA, design ou qualquer outra √°rea da tecnologia, estou aqui para esclarecer!`,
                        `Show! ‚ú®\n\nVamos explorar isso juntos! Me conta qual o objetivo principal do seu projeto ou que problema voc√™ quer resolver com a tecnologia.`,
                        `Perfeito! üéØ\n\nPara te dar as melhores op√ß√µes, voc√™ poderia me falar:\n\n1. Qual √© o seu setor/niche?\n2. Tem algum prazo espec√≠fico?\n3. J√° tem alguma ideia de funcionalidades?\n\nAssim posso te ajudar de forma personalizada!`
                    ];
                    return genericResponses[Math.floor(Math.random() * genericResponses.length)];
            }
        }

        async function getDeepSeekResponse(message) {
            try {
                if (!state.deepseekApiKey) {
                    throw new Error('API key not configured');
                }
                
                const response = await fetch(CONFIG.DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${state.deepseekApiKey}`
                    },
                    body: JSON.stringify({
                        model: CONFIG.DEEPSEEK_MODEL,
                        messages: [
                            {
                                role: 'system',
                                content: `Voc√™ √© um assistente especialista da MakerAI Studio, uma empresa brasileira de desenvolvimento web, mobile, sistemas e intelig√™ncia artificial.
                                
                                Informa√ß√µes sobre a empresa:
                                ‚Ä¢ Servi√ßos: ${JSON.stringify(AGENCY_KNOWLEDGE.services)}
                                ‚Ä¢ Portf√≥lio: ${JSON.stringify(AGENCY_KNOWLEDGE.portfolio)}
                                ‚Ä¢ Processo: ${JSON.stringify(AGENCY_KNOWLEDGE.process)}
                                ‚Ä¢ Contato: ${JSON.stringify(AGENCY_KNOWLEDGE.contact)}
                                
                                Seja profissional, amig√°vel e detalhista. Use emojis quando apropriado. 
                                Responda sempre em portugu√™s brasileiro. Para or√ßamentos, forne√ßa informa√ß√µes realistas baseadas nos dados da empresa.`
                            },
                            ...state.conversation.slice(-6).map(msg => ({
                                role: msg.sender === 'user' ? 'user' : 'assistant',
                                content: msg.content
                            })),
                            { role: 'user', content: message }
                        ],
                        temperature: CONFIG.TEMPERATURE,
                        max_tokens: CONFIG.MAX_TOKENS,
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                return data.choices[0]?.message?.content?.trim() || null;
                
            } catch (error) {
                console.error('DeepSeek API Error:', error);
                return null;
            }
        }

        async function generateResponse(message) {
            const intent = analyzeIntent(message);
            
            // Atualiza status
            updateStatus('processando');
            
            // Decide qual fonte usar
            const shouldUseDeepSeek = state.deepseekApiKey && (state.isOnline) && (
                intent.confidence < 0.3 ||          // Baixa confian√ßa no match local
                intent.wordCount > 20 ||            // Perguntas longas/complexas
                state.conversation.length > 5 ||    // Conversa j√° estabelecida
                intent.mainIntent === 'technical'   // Perguntas t√©cnicas
            );
            
            let response;
            
            if (shouldUseDeepSeek) {
                response = await getDeepSeekResponse(message);
            }
            
            // Fallback para resposta local se DeepSeek falhar ou n√£o for apropriado
            if (!response) {
                response = getLocalResponse(intent, message);
            }
            
            // Atualiza status
            updateStatus('ready');
            
            return response;
        }

        // ============================================
        // PROCESSAMENTO DE MENSAGENS
        // ============================================
        async function sendMessage() {
            const message = elements.userInput.value.trim();
            if (!message || state.isProcessing) return;
            
            // Limpa input
            elements.userInput.value = '';
            
            // Atualiza estado
            state.isProcessing = true;
            elements.userInput.disabled = true;
            elements.sendButton.disabled = true;
            
            // Adiciona mensagem do usu√°rio
            const userMessageId = addMessage(message, 'user');
            
            // Mostra indicador de digita√ß√£o
            showTypingIndicator();
            
            // Timeout de seguran√ßa
            const safetyTimeout = setTimeout(() => {
                hideTypingIndicator();
                state.isProcessing = false;
                elements.userInput.disabled = false;
                elements.sendButton.disabled = false;
                elements.userInput.focus();
                
                addMessage('Desculpe, levei um tempo para processar. Pode reformular sua pergunta?', 'ai');
                updateStatus('ready');
            }, 15000);
            
            try {
                // Gera resposta
                const response = await generateResponse(message);
                
                clearTimeout(safetyTimeout);
                hideTypingIndicator();
                
                // Adiciona resposta
                addMessage(response, 'ai');
                
                // Restaura estado
                state.isProcessing = false;
                elements.userInput.disabled = false;
                elements.sendButton.disabled = false;
                elements.userInput.focus();
                
            } catch (error) {
                clearTimeout(safetyTimeout);
                hideTypingIndicator();
                
                console.error('Error processing message:', error);
                addMessage('Desculpe, ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.', 'ai');
                
                state.isProcessing = false;
                elements.userInput.disabled = false;
                elements.sendButton.disabled = false;
                elements.userInput.focus();
                updateStatus('ready');
            }
        }

        // ============================================
        // GERENCIAMENTO DE ESTADO
        // ============================================
        function updateStatus(status) {
            switch (status) {
                case 'processando':
                    elements.statusText.textContent = 'Processando...';
                    break;
                case 'deepseek':
                    elements.statusText.textContent = 'Consultando DeepSeek...';
                    break;
                case 'ready':
                    elements.statusText.textContent = state.deepseekApiKey ? 
                        'Online ‚Ä¢ DeepSeek Ativo' : 
                        'Online ‚Ä¢ IA Generativa';
                    break;
                case 'offline':
                    elements.statusText.textContent = 'Offline ‚Ä¢ Modo Local';
                    break;
            }
        }

        function saveSettings() {
            try {
                const settings = {
                    deepseekApiKey: state.deepseekApiKey ? '***' : '',
                    useDeepSeek: state.useDeepSeek,
                    lastConfig: new Date().toISOString()
                };
                localStorage.setItem(CONFIG.STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
            } catch (error) {
                console.warn('N√£o foi poss√≠vel salvar configura√ß√µes:', error);
            }
        }

        // ============================================
        // MODAIS E CONFIGURA√á√ïES
        // ============================================
        function showConfirmationModal(title, message, onConfirm) {
            state.isModalOpen = true;
            elements.modalTitle.textContent = title;
            elements.modalDescription.textContent = message;
            elements.confirmationModal.style.display = 'flex';
            
            elements.modalConfirm.onclick = () => {
                elements.confirmationModal.style.display = 'none';
                state.isModalOpen = false;
                onConfirm();
            };
            
            elements.modalCancel.onclick = () => {
                elements.confirmationModal.style.display = 'none';
                state.isModalOpen = false;
            };
        }

        function showApiConfigModal() {
            state.isModalOpen = true;
            elements.apiKeyInput.value = state.deepseekApiKey || '';
            elements.apiConfigModal.style.display = 'flex';
        }

        function saveApiConfig() {
            const key = elements.apiKeyInput.value.trim();
            
            if (key === '') {
                state.deepseekApiKey = '';
                state.useDeepSeek = false;
                updateStatus('ready');
                showNotification('DeepSeek desativado. Usando respostas locais.', 'info');
            } else if (key.startsWith('sk-')) {
                state.deepseekApiKey = key;
                state.useDeepSeek = true;
                updateStatus('ready');
                showNotification('Chave DeepSeek configurada com sucesso! ‚úÖ', 'success');
            } else {
                showNotification('Chave inv√°lida. Deve come√ßar com "sk-"', 'error');
                return;
            }
            
            localStorage.setItem(CONFIG.STORAGE_KEYS.API_KEY, state.deepseekApiKey);
            saveSettings();
            elements.apiConfigModal.style.display = 'none';
            state.isModalOpen = false;
        }

        function showNotification(message, type = 'info') {
            // Implementa√ß√£o simples de notifica√ß√£o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 10001;
                font-size: 14px;
                font-weight: 500;
                transform: translateX(120%);
                transition: transform 0.3s ease;
                max-width: 300px;
                pointer-events: none;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Anima√ß√£o de entrada
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Remove ap√≥s 3 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(120%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Input
            elements.userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Bot√£o enviar
            elements.sendButton.addEventListener('click', sendMessage);
            
            // Bot√£o hist√≥rico
            elements.historyBtn.addEventListener('click', () => {
                const count = state.conversation.filter(m => m.sender === 'user').length;
                showNotification(`Voc√™ enviou ${count} mensagens nesta conversa.`, 'info');
            });
            
            // Bot√£o limpar
            elements.clearBtn.addEventListener('click', () => {
                showConfirmationModal(
                    'Limpar Conversa',
                    'Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.',
                    clearConversation
                );
            });
            
            // Bot√£o configura√ß√µes
            elements.settingsBtn.addEventListener('click', showApiConfigModal);
            
            // Bot√£o fechar
            elements.closeBtn.addEventListener('click', () => {
                if (state.conversation.length > 0) {
                    showConfirmationModal(
                        'Fechar Assistente',
                        'Tem certeza que deseja fechar o assistente? Seu progresso ser√° salvo automaticamente.',
                        () => {
                            if (window.parent && window.parent !== window) {
                                window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                            }
                        }
                    );
                } else {
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                    }
                }
            });
            
            // Configura√ß√£o da API
            elements.apiConfigSave.addEventListener('click', saveApiConfig);
            elements.apiConfigCancel.addEventListener('click', () => {
                elements.apiConfigModal.style.display = 'none';
                state.isModalOpen = false;
            });
            
            // Fechar modais com ESC ou clicar fora
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && state.isModalOpen) {
                    if (elements.confirmationModal.style.display === 'flex') {
                        elements.confirmationModal.style.display = 'none';
                        state.isModalOpen = false;
                    }
                    if (elements.apiConfigModal.style.display === 'flex') {
                        elements.apiConfigModal.style.display = 'none';
                        state.isModalOpen = false;
                    }
                }
            });

            // Fechar modal clicando fora
            document.addEventListener('click', (e) => {
                if (state.isModalOpen && e.target.classList.contains('modal-overlay')) {
                    elements.confirmationModal.style.display = 'none';
                    elements.apiConfigModal.style.display = 'none';
                    state.isModalOpen = false;
                }
            });
            
            // Intera√ß√£o com carrossel
            elements.suggestionsCarousel.addEventListener('mouseenter', pauseCarousel);
            elements.suggestionsCarousel.addEventListener('mouseleave', startCarousel);
            elements.suggestionsCarousel.addEventListener('touchstart', pauseCarousel);
            elements.suggestionsCarousel.addEventListener('touchend', () => {
                setTimeout(startCarousel, 3000);
            });
            
            // Comunica√ß√£o com iframe pai
            window.addEventListener('message', (event) => {
                if (event.data?.type === 'OPEN_ASSISTANT') {
                    elements.container.style.display = 'flex';
                    setTimeout(() => elements.userInput.focus(), 100);
                }
                
                if (event.data?.type === 'SET_API_KEY') {
                    state.deepseekApiKey = event.data.key || '';
                    if (state.deepseekApiKey) {
                        localStorage.setItem(CONFIG.STORAGE_KEYS.API_KEY, state.deepseekApiKey);
                        state.useDeepSeek = true;
                    }
                    updateStatus('ready');
                }
                
                if (event.data?.type === 'GET_STATE') {
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'ASSISTANT_STATE',
                            data: {
                                conversationLength: state.conversation.length,
                                hasApiKey: !!state.deepseekApiKey,
                                messageCount: state.messageCount,
                                isOnline: state.isOnline
                            }
                        }, '*');
                    }
                }
            });
            
            // Detectar mudan√ßa de rede
            window.addEventListener('online', () => {
                state.isOnline = true;
                updateStatus('ready');
                showNotification('Conex√£o restabelecida!', 'success');
            });
            
            window.addEventListener('offline', () => {
                state.isOnline = false;
                updateStatus('offline');
                showNotification('Conex√£o perdida - usando respostas locais', 'warning');
            });
            
            // Detectar mudan√ßa de tema
            const themeObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'data-theme') {
                        const theme = document.documentElement.getAttribute('data-theme') || 'dark';
                        document.body.setAttribute('data-theme', theme);
                    }
                });
            });
            
            themeObserver.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['data-theme']
            });
            
            // Sincronizar tema inicial
            const initialTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            document.body.setAttribute('data-theme', initialTheme);
            
            // Redimensionamento responsivo
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    state.isMobile = window.innerWidth <= 767;
                    state.isTablet = window.innerWidth >= 768 && window.innerWidth <= 1023;
                    state.isDesktop = window.innerWidth >= 1024;
                    state.itemsPerView = calculateItemsPerView();
                    
                    // Atualizar carrossel se necess√°rio
                    const oldSlides = state.slidesCount;
                    const itemsCount = elements.suggestionsCarousel.children.length;
                    state.slidesCount = Math.ceil(itemsCount / Math.floor(state.itemsPerView));
                    
                    if (oldSlides !== state.slidesCount) {
                        updateCarouselDots();
                        goToSlide(Math.min(state.currentSlide, state.slidesCount - 1));
                    }
                    
                    // Atualizar vari√°veis CSS responsivas
                    updateResponsiveVariables();
                }, 250);
            });

            // Atualizar vari√°veis CSS baseadas no tamanho da tela
            function updateResponsiveVariables() {
                const width = window.innerWidth;
                const root = document.documentElement;
                
                if (width < 480) {
                    root.style.setProperty('--header-height', '56px');
                    root.style.setProperty('--input-height', '48px');
                    root.style.setProperty('--quick-option-height', '48px');
                } else if (width < 768) {
                    root.style.setProperty('--header-height', '60px');
                    root.style.setProperty('--input-height', '52px');
                    root.style.setProperty('--quick-option-height', '52px');
                } else if (width < 1024) {
                    root.style.setProperty('--header-height', '64px');
                    root.style.setProperty('--input-height', '56px');
                    root.style.setProperty('--quick-option-height', '56px');
                } else if (width < 1440) {
                    root.style.setProperty('--header-height', '68px');
                    root.style.setProperty('--input-height', '56px');
                    root.style.setProperty('--quick-option-height', '56px');
                } else {
                    root.style.setProperty('--header-height', '72px');
                    root.style.setProperty('--input-height', '60px');
                    root.style.setProperty('--quick-option-height', '60px');
                }
            }

            // Inicializar vari√°veis
            updateResponsiveVariables();
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        function init() {
            // Configura√ß√£o inicial
            state.useDeepSeek = !!state.deepseekApiKey;
            updateStatus('ready');
            
            // Inicializar componentes
            initCarousel();
            setupEventListeners();
            
            // Carregar hist√≥rico ou iniciar nova conversa
            const hasHistory = loadConversation();
            if (!hasHistory) {
                // Adicionar mensagem de boas-vindas com delay
                setTimeout(() => {
                    addMessage(getWelcomeMessage(), 'ai');
                }, 800);
            }
            
            // Focar no input
            setTimeout(() => {
                elements.userInput.focus();
            }, 1000);
            
            // Notificar que est√° pronto
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'ASSISTANT_READY' }, '*');
            }
        }

        // ============================================
        // LIMPEZA
        // ============================================
        function cleanup() {
            if (state.carouselInterval) {
                clearInterval(state.carouselInterval);
            }
            
            if (state.typingTimeout) {
                clearTimeout(state.typingTimeout);
            }
            
            saveConversation();
        }

        // ============================================
        // EVENTOS GLOBAIS
        // ============================================
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('beforeunload', cleanup);
        
        // Expor fun√ß√µes globais para comunica√ß√£o
        window.Assistant = {
            open: () => {
                elements.container.style.display = 'flex';
                setTimeout(() => elements.userInput.focus(), 100);
                return true;
            },
            close: () => {
                elements.container.style.display = 'none';
                return true;
            },
            clear: clearConversation,
            setApiKey: (key) => {
                state.deepseekApiKey = key;
                state.useDeepSeek = !!key;
                if (key) {
                    localStorage.setItem(CONFIG.STORAGE_KEYS.API_KEY, key);
                }
                updateStatus('ready');
                return true;
            },
            getState: () => ({
                conversationLength: state.conversation.length,
                hasApiKey: !!state.deepseekApiKey,
                messageCount: state.messageCount,
                isOnline: state.isOnline,
                isModalOpen: state.isModalOpen
            }),
            isReady: () => true
        };
    </script>
</body>
</html>