<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistente IA MakerAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #5f2eff, #8f6bff);
            --secondary-gradient: linear-gradient(135deg, #8f6bff, #9d7aff);
            --deepseek-gradient: linear-gradient(135deg, #10a37f, #0d8b6b);
            --bg-primary: rgba(18, 18, 18, 0.98);
            --bg-secondary: rgba(15, 15, 15, 0.95);
            --bg-tertiary: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-color: #8f6bff;
            --deepseek-color: #10a37f;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: transparent;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }

        .assistant-panel {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: var(--bg-primary);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(20px);
            animation: panelIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes panelIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header melhorado */
        .chat-header {
            padding: 14px 18px;
            background: linear-gradient(135deg, 
                rgba(95, 46, 255, 0.25), 
                rgba(143, 107, 255, 0.15));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            box-shadow: 0 4px 12px rgba(95, 46, 255, 0.3);
            animation: pulse 2s infinite;
            position: relative;
        }

        .ai-avatar.deepseek::after {
            content: 'ü§ñ';
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: var(--deepseek-color);
            color: white;
            font-size: 10px;
            padding: 2px 4px;
            border-radius: var(--radius-full);
            border: 2px solid var(--bg-primary);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-text {
            flex: 1;
        }

        .header-text h3 {
            font-size: 17px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #d4c4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
        }

        .header-text .status {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--success-color);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .icon-btn[data-badge]::after {
            content: attr(data-badge);
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--accent-color);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 18px;
            text-align: center;
            border: 2px solid var(--bg-primary);
        }

        .icon-btn.deepseek-active {
            background: rgba(16, 163, 127, 0.2);
            border-color: var(--deepseek-color);
            color: var(--deepseek-color);
        }

        /* Container de mensagens melhorado */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 18px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(95, 46, 255, 0.02) 10%,
                transparent 90%
            );
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #5f2eff, #8f6bff);
            border-radius: var(--radius-full);
        }

        /* Mensagens aprimoradas */
        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: var(--radius-md);
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            font-size: 15px;
            box-shadow: var(--shadow-md);
            animation: messageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(10px);
        }

        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-message {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .ai-message.deepseek-response {
            background: rgba(16, 163, 127, 0.1);
            border-color: var(--deepseek-color);
            border-left: 3px solid var(--deepseek-color);
        }

        .message-source {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            opacity: 0.7;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .message-source .badge {
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .message-source .badge.makerai {
            background: rgba(143, 107, 255, 0.2);
            color: #8f6bff;
        }

        .message-source .badge.deepseek {
            background: rgba(16, 163, 127, 0.2);
            color: #10a37f;
        }

        .message-time {
            display: block;
            font-size: 11px;
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
            font-weight: 500;
        }

        /* Indicador de digita√ß√£o melhorado */
        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            align-self: flex-start;
            border: 1px solid var(--border-color);
            animation: typingIn 0.3s ease;
            max-width: 120px;
        }

        @keyframes typingIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--accent-color);
            opacity: 0.4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { 
                opacity: 0.4; 
                transform: translateY(0px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-4px); 
            }
        }

        /* Container de op√ß√µes r√°pidas aprimorado */
        .quick-options-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            flex-shrink: 0;
            position: relative;
        }

        .quick-options-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .quick-options-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quick-options-title i {
            color: var(--accent-color);
        }

        .quick-options-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 12px;
            scrollbar-width: none;
        }

        .quick-options-carousel::-webkit-scrollbar {
            display: none;
        }

        .quick-option {
            flex: 0 0 auto;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
        }

        .quick-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 0;
        }

        .quick-option > * {
            position: relative;
            z-index: 1;
        }

        .quick-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-option:hover::before {
            opacity: 0.1;
        }

        .quick-option:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .quick-option i {
            color: var(--accent-color);
            font-size: 14px;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .carousel-indicator {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
            padding: 0;
        }

        .carousel-indicator.active {
            background: var(--accent-color);
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(143, 107, 255, 0.5);
        }

        /* Container de input aprimorado */
        .input-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background: var(--bg-secondary);
            align-items: center;
            position: relative;
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        #assistantInput {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
        }

        #assistantInput:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(143, 107, 255, 0.1);
        }

        #assistantInput::placeholder {
            color: var(--text-tertiary);
        }

        .send-btn {
            background: var(--primary-gradient);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .send-btn.deepseek-mode {
            background: var(--deepseek-gradient);
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(95, 46, 255, 0.4);
        }

        .send-btn.deepseek-mode:hover {
            box-shadow: 0 8px 24px rgba(16, 163, 127, 0.4);
        }

        .send-btn:hover::before {
            opacity: 1;
        }

        .send-btn:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Bot√£o de DeepSeek */
        .deepseek-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(16, 163, 127, 0.1);
            border: 1px solid rgba(16, 163, 127, 0.3);
            border-radius: var(--radius-md);
            color: var(--deepseek-color);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .deepseek-toggle:hover {
            background: rgba(16, 163, 127, 0.2);
            transform: translateY(-1px);
        }

        .deepseek-toggle.active {
            background: var(--deepseek-gradient);
            color: white;
            border-color: var(--deepseek-color);
        }

        /* Bot√£o de voltar */
        .back-btn {
            display: none;
        }

        /* Sugest√µes em tempo real */
        .suggestions-container {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 18px;
            right: 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
        }

        .suggestion-item {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            color: var(--text-primary);
        }

        .suggestion-item:hover {
            background: var(--bg-tertiary);
        }

        /* Modal de confirma√ß√£o */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .modal-message {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            border: 1px solid var(--border-color);
        }

        .modal-btn.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Feedback visual */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--transition-normal);
            z-index: 10001;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Indicador de fonte */
        .source-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-left: 6px;
            vertical-align: middle;
        }

        .source-indicator.makerai {
            background: rgba(143, 107, 255, 0.2);
            color: #8f6bff;
        }

        .source-indicator.deepseek {
            background: rgba(16, 163, 127, 0.2);
            color: #10a37f;
        }

        /* Responsividade aprimorada */
        @media (max-width: 767px) {
            .back-btn {
                display: flex;
            }

            .quick-option {
                font-size: 12.5px;
                padding: 12px 16px;
            }

            .message {
                max-width: 90%;
                padding: 14px 18px;
            }

            .input-container,
            .quick-options-container,
            .messages-container {
                padding-left: 16px;
                padding-right: 16px;
            }

            .chat-header {
                padding: 12px 16px;
            }

            .ai-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .header-text h3 {
                font-size: 16px;
            }

            .deepseek-toggle {
                padding: 6px 10px;
                font-size: 11px;
            }
        }

        @media (max-height: 600px) {
            .messages-container {
                padding-top: 12px;
                padding-bottom: 12px;
            }

            .message {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: rgba(255, 255, 255, 0.98);
                --bg-secondary: rgba(250, 250, 250, 0.95);
                --bg-tertiary: rgba(0, 0, 0, 0.05);
                --text-primary: #1a1a1a;
                --text-secondary: rgba(0, 0, 0, 0.6);
                --text-tertiary: rgba(0, 0, 0, 0.4);
                --border-color: rgba(0, 0, 0, 0.1);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Anima√ß√µes de entrada */
        .message:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .message:nth-child(even) {
            animation-delay: 0.2s;
        }
    </style>
</head>
<body>
    <div class="assistant-panel" id="assistantPanel">
        <!-- Header aprimorado -->
        <div class="chat-header">
            <div class="header-content">
                <div class="ai-avatar" id="aiAvatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="header-text">
                    <h3>Assistente MakerAI</h3>
                    <div class="status">
                        <span class="status-dot"></span>
                        <span id="statusText">Online ‚Ä¢ IA Generativa</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="deepseek-toggle" id="deepseekToggle">
                    <i class="fas fa-robot"></i>
                    <span id="deepseekStatus">DeepSeek OFF</span>
                </button>
                <button class="icon-btn" id="historyBtn" aria-label="Hist√≥rico" data-badge="0">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" id="clearBtn" aria-label="Limpar conversa">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="icon-btn back-btn" id="backBtn" aria-label="Voltar">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="icon-btn" id="closeAssistant" aria-label="Fechar assistente">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Container de mensagens -->
        <div class="messages-container" id="messagesContainer">
            <!-- Mensagens ser√£o inseridas aqui dinamicamente -->
        </div>

        <!-- Sugest√µes em tempo real -->
        <div class="suggestions-container" id="suggestionsContainer"></div>

        <!-- Container de op√ß√µes r√°pidas -->
        <div class="quick-options-container" id="quickOptionsContainer">
            <div class="quick-options-title">
                <i class="fas fa-bolt"></i> Perguntas frequentes
            </div>
            <div class="quick-options-carousel" id="quickOptionsCarousel"></div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </div>

        <!-- Container de input -->
        <div class="input-container">
            <input 
                type="text" 
                id="assistantInput" 
                placeholder="Digite sua pergunta..." 
                aria-label="Mensagem para o assistente"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
            >
            <button class="send-btn" id="sendAssistantBtn" aria-label="Enviar mensagem">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Limpar conversa</h3>
                <p class="modal-message" id="modalMessage">Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modalCancel">Cancelar</button>
                <button class="modal-btn primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>

    <script>
        // ============================================
        // CONFIGURA√á√ïES DA API DEEPSEEK
        // ============================================
        const DEEPSEEK_CONFIG = {
            API_KEY: '', // ‚Üê INSIRA SUA CHAVE DA API AQUI
            BASE_URL: 'https://api.deepseek.com/v1',
            MODEL: 'deepseek-chat',
            MAX_TOKENS: 2048,
            TEMPERATURE: 0.7,
            SYSTEM_PROMPT: `Voc√™ √© um assistente especializado da MakerAI Studio, uma empresa de desenvolvimento de software, IA e solu√ß√µes digitais. 

Sobre a MakerAI Studio:
- Especializada em desenvolvimento web, mobile, IA e automa√ß√µes
- Valores: Inova√ß√£o, Qualidade e Parceria
- Tecnologias: React, Node.js, Python, Flutter, IA Generativa
- Servi√ßos: Sites, Apps, Sistemas, Chatbots, Automa√ß√µes, Consultoria

Seu papel:
1. Responder como representante oficial da MakerAI
2. Fornecer informa√ß√µes precisas sobre servi√ßos e tecnologias
3. Ser educado, profissional e entusiasta
4. Usar exemplos reais quando poss√≠vel
5. Oferecer ajuda pr√°tica e acion√°vel
6. Manter tom amig√°vel mas profissional

IMPORTANTE:
- Se for uma pergunta sobre MakerAI, responda com conhecimento da empresa
- Se for algo t√©cnico geral, forne√ßa a melhor resposta poss√≠vel
- Sempre termine oferecendo mais ajuda
- Use emojis moderadamente para manter profissionalismo
- Se n√£o souber algo, seja honesto e ofere√ßa contatar a equipe t√©cnica`
        };

        // ============================================
        // ELEMENTOS E VARI√ÅVEIS GLOBAIS
        // ============================================
        const elements = {
            panel: document.getElementById('assistantPanel'),
            messagesContainer: document.getElementById('messagesContainer'),
            assistantInput: document.getElementById('assistantInput'),
            sendAssistantBtn: document.getElementById('sendAssistantBtn'),
            quickOptionsCarousel: document.getElementById('quickOptionsCarousel'),
            carouselIndicators: document.getElementById('carouselIndicators'),
            closeAssistant: document.getElementById('closeAssistant'),
            backBtn: document.getElementById('backBtn'),
            historyBtn: document.getElementById('historyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            statusText: document.getElementById('statusText'),
            suggestionsContainer: document.getElementById('suggestionsContainer'),
            confirmationModal: document.getElementById('confirmationModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalMessage: document.getElementById('modalMessage'),
            modalCancel: document.getElementById('modalCancel'),
            modalConfirm: document.getElementById('modalConfirm'),
            notification: document.getElementById('notification'),
            deepseekToggle: document.getElementById('deepseekToggle'),
            deepseekStatus: document.getElementById('deepseekStatus'),
            aiAvatar: document.getElementById('aiAvatar')
        };

        // Estado da aplica√ß√£o
        const state = {
            conversationHistory: [],
            isProcessing: false,
            carouselInterval: null,
            currentSlide: 0,
            messageCount: 0,
            typingTimeout: null,
            suggestions: [],
            isOnline: true,
            sessionId: generateSessionId(),
            deepseekEnabled: false,
            useDeepSeek: false,
            apiKeyConfigured: DEEPSEEK_CONFIG.API_KEY.trim() !== '',
            apiRequestsCount: 0,
            lastApiRequest: null
        };

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function showNotification(message, type = 'info') {
            const notification = elements.notification;
            notification.textContent = message;
            notification.className = 'notification';
            
            // Adiciona classe baseada no tipo
            if (type === 'success') {
                notification.style.borderLeft = '4px solid var(--success-color)';
            } else if (type === 'error') {
                notification.style.borderLeft = '4px solid var(--error-color)';
            } else if (type === 'warning') {
                notification.style.borderLeft = '4px solid var(--warning-color)';
            } else {
                notification.style.borderLeft = '4px solid var(--accent-color)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ============================================
        // GERENCIAMENTO DE MENSAGENS
        // ============================================
        function addMessage(text, sender, source = 'makerai', timestamp = new Date()) {
            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            if (sender === 'ai' && source === 'deepseek') {
                div.classList.add('deepseek-response');
            }
            div.dataset.messageId = messageId;
            div.dataset.source = source;
            
            const formattedTime = formatTime(timestamp);
            
            // Adiciona indicador de fonte para mensagens AI
            let sourceIndicator = '';
            if (sender === 'ai') {
                const sourceName = source === 'deepseek' ? 'DeepSeek AI' : 'MakerAI';
                const sourceClass = source === 'deepseek' ? 'deepseek' : 'makerai';
                sourceIndicator = `<div class="message-source">
                    <span class="badge ${sourceClass}">${sourceName}</span>
                    <span>‚Ä¢</span>
                    <span>${formattedTime}</span>
                </div>`;
            }
            
            // Processa markdown b√°sico
            let processedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            div.innerHTML = sourceIndicator + processedText;
            
            if (sender === 'user') {
                div.innerHTML += `<span class="message-time">${formattedTime}</span>`;
            }
            
            // Adiciona anima√ß√£o baseada na posi√ß√£o
            const delay = state.messageCount * 0.1;
            div.style.animationDelay = `${delay}s`;
            
            elements.messagesContainer.appendChild(div);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
            
            state.messageCount++;
            
            return messageId;
        }

        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            elements.messagesContainer.appendChild(typing);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // ============================================
        // INTEGRA√á√ÉO COM API DEEPSEEK
        // ============================================
        async function callDeepSeekAPI(message, conversationContext) {
            if (!state.apiKeyConfigured) {
                throw new Error('API Key n√£o configurada. Configure DEEPSEEK_CONFIG.API_KEY no c√≥digo.');
            }

            try {
                state.apiRequestsCount++;
                state.lastApiRequest = new Date();
                
                // Prepara o hist√≥rico para a API
                const apiMessages = [
                    {
                        role: "system",
                        content: DEEPSEEK_CONFIG.SYSTEM_PROMPT
                    },
                    ...conversationContext.slice(-10).map(msg => ({
                        role: msg.role === 'user' ? 'user' : 'assistant',
                        content: msg.content
                    })),
                    {
                        role: "user",
                        content: message
                    }
                ];

                const response = await fetch(`${DEEPSEEK_CONFIG.BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_CONFIG.API_KEY}`
                    },
                    body: JSON.stringify({
                        model: DEEPSEEK_CONFIG.MODEL,
                        messages: apiMessages,
                        max_tokens: DEEPSEEK_CONFIG.MAX_TOKENS,
                        temperature: DEEPSEEK_CONFIG.TEMPERATURE,
                        stream: false
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API Error ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0]) {
                    return {
                        success: true,
                        response: data.choices[0].message.content,
                        usage: data.usage,
                        model: data.model
                    };
                } else {
                    throw new Error('Resposta inv√°lida da API');
                }
                
            } catch (error) {
                console.error('Erro na API DeepSeek:', error);
                
                // Fallback para respostas locais em caso de erro
                return {
                    success: false,
                    error: error.message,
                    fallbackResponse: generateLocalResponse(message)
                };
            }
        }

        // ============================================
        // SISTEMA H√çBRIDO DE RESPOSTAS
        // ============================================
        function shouldUseDeepSeek(message) {
            if (!state.deepseekEnabled || !state.apiKeyConfigured) {
                return false;
            }

            const analysis = analyzeMessage(message);
            
            // Usa DeepSeek para:
            // 1. Perguntas complexas
            if (analysis.words > 15) return true;
            
            // 2. Perguntas t√©cnicas detalhadas
            const techKeywords = ['como funciona', 'tutorial', 'explica√ß√£o', 'detalhes', 't√©cnico', 'c√≥digo', 'implementar'];
            if (techKeywords.some(keyword => message.toLowerCase().includes(keyword))) return true;
            
            // 3. Perguntas espec√≠ficas n√£o cobertas pelo conhecimento base
            if (!isCoveredByKnowledgeBase(message)) return true;
            
            // 4. Quando explicitamente solicitado
            if (message.toLowerCase().includes('deepseek') || message.toLowerCase().includes('ia avan√ßada')) return true;
            
            return false;
        }

        function isCoveredByKnowledgeBase(message) {
            const lowerMsg = message.toLowerCase();
            const coveredTopics = [
                'servi√ßos', 'pre√ßo', 'or√ßamento', 'portfolio', 'contato',
                'makerai', 'empresa', 'quem somos', 'equipe',
                'site', 'app', 'sistema', 'desenvolvimento',
                'prazo', 'tempo', 'entrega',
                'suporte', 'garantia', 'manuten√ß√£o'
            ];
            
            return coveredTopics.some(topic => lowerMsg.includes(topic));
        }

        function generateLocalResponse(message) {
            const analysis = analyzeMessage(message);
            
            // Respostas para sauda√ß√µes
            if (analysis.intents.greeting) {
                const hour = new Date().getHours();
                let timeGreeting;
                
                if (hour < 12) timeGreeting = "Bom dia";
                else if (hour < 18) timeGreeting = "Boa tarde";
                else timeGreeting = "Boa noite";
                
                const deepseekStatus = state.deepseekEnabled ? 
                    ' (Modo DeepSeek dispon√≠vel para perguntas complexas ü§ñ)' : 
                    '';
                
                return `${timeGreeting}! üòä\n\nSou o assistente da MakerAI Studio${deepseekStatus}.\n\nPosso te ajudar com:\n\n‚Ä¢ Informa√ß√µes sobre nossos servi√ßos\n‚Ä¢ Or√ßamentos e prazos\n‚Ä¢ Cases e portf√≥lio\n‚Ä¢ D√∫vidas t√©cnicas\n‚Ä¢ E muito mais!\n\nNo que posso te ajudar hoje?`;
            }
            
            // Mapeamento de inten√ß√µes para respostas
            const intentMap = {
                services: `üöÄ **Nossos Servi√ßos de Desenvolvimento**\n\n**üíª Desenvolvimento Web & Mobile**\n‚Ä¢ Sites institucionais e corporativos\n‚Ä¢ PWAs (Progressive Web Apps)\n‚Ä¢ E-commerce e marketplaces\n‚Ä¢ Aplicativos nativos (React Native/Flutter)\n\n**ü§ñ Intelig√™ncia Artificial**\n‚Ä¢ Assistentes virtuais e chatbots\n‚Ä¢ An√°lise preditiva de dados\n‚Ä¢ Processamento de linguagem natural\n‚Ä¢ Automa√ß√£o com IA\n\n**üé® Design & Experi√™ncia**\n‚Ä¢ UI/UX Design premium\n‚Ä¢ Identidade visual completa\n‚Ä¢ Prototipagem interativa\n\n*Qual servi√ßo te interessa mais?*`,
                pricing: `üí∞ **Transpar√™ncia Total nos Valores**\n\n**üìä Modelos de Pre√ßo**\n1. **Projeto Fixo** - Escopo definido\n   ‚Ä¢ Sites: R$ 8.000 - R$ 25.000\n   ‚Ä¢ Apps: R$ 30.000 - R$ 80.000\n\n2. **Horas Avulsas** - R$ 120/hora\n   ‚Ä¢ Para ajustes e melhorias\n\n3. **Assinatura Mensal** - A partir de R$ 1.500/m√™s\n   ‚Ä¢ Suporte priorit√°rio 24/7\n\n*Posso te passar uma estimativa personalizada!* ‚ú®`,
                portfolio: `üé® **Cases de Sucesso**\n\n**üè• Sa√∫de & Bem-estar**\n‚Ä¢ App de telemedicina com IA\n‚Ä¢ Sistema de gest√£o para cl√≠nicas\n\n**üè¢ Empresarial**\n‚Ä¢ Dashboard de BI em tempo real\n‚Ä¢ Sistema de automa√ß√£o de processos\n\n**üõí E-commerce**\n‚Ä¢ Marketplace com recomenda√ß√£o IA\n‚Ä¢ E-commerce com realidade aumentada\n\n*Quer ver detalhes de algum case espec√≠fico?* üìä`,
                contact: `üìû **Vamos Conversar!**\n\n**üì± Canais Diretos**\n‚Ä¢ WhatsApp: (11) 99999-9999\n‚Ä¢ Email: contato@makerai.com.br\n‚Ä¢ LinkedIn: /makerai-studio\n\n**üéØ Pr√≥ximos Passos:**\n1. Agendamos uma call explorat√≥ria\n2. Analisamos suas necessidades\n3. Criamos proposta personalizada\n\n*Prefere que eu te direcione para o formul√°rio ou j√° quer marcar uma call?* üöÄ`
            };
            
            // Encontra a primeira inten√ß√£o ativa
            for (const [intent, isActive] of Object.entries(analysis.intents)) {
                if (isActive && intentMap[intent]) {
                    return intentMap[intent];
                }
            }
            
            // Resposta padr√£o
            const genericResponses = [
                `Interessante! üßê\n\nPara te ajudar melhor, voc√™ poderia me contar mais detalhes sobre:\n\n‚Ä¢ O objetivo do projeto\n‚Ä¢ Prazo que voc√™ tem em mente\n‚Ä¢ Or√ßamento dispon√≠vel\n\nAssim posso te orientar da melhor forma! üìã`,
                `Show! ‚ú®\n\nVamos explorar isso juntos! Me conta qual o objetivo principal ou que problema voc√™ quer resolver com a tecnologia.\n\n*Dica:* Se for algo mais complexo, posso ativar o modo DeepSeek para uma an√°lise mais detalhada! ü§ñ`,
                `Perfeito! üéØ\n\nPara te dar as melhores op√ß√µes, voc√™ poderia me falar um pouco mais sobre o contexto? Assim posso te ajudar de forma personalizada!\n\n*Pressione o bot√£o "DeepSeek" para respostas mais avan√ßadas quando necess√°rio.*`
            ];
            
            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        function analyzeMessage(message) {
            const lowerMsg = message.toLowerCase().trim();
            
            return {
                intents: {
                    greeting: /^(oi|ol√°|ola|e a√≠|bom dia|boa tarde|boa noite|hello|hi|hey)/i.test(lowerMsg),
                    services: /servi[√ßc]os|desenvolvimento|site|app|sistema|programa[√ßc]|software/i.test(lowerMsg),
                    pricing: /pre[√ßc]o|valor|custo|or[√ßc]amento|quanto custa|investimento/i.test(lowerMsg),
                    portfolio: /portf[√≥o]lio|cases|projetos|trabalhos|exemplos|j[a√°] fez/i.test(lowerMsg),
                    contact: /contato|whatsapp|email|telefone|falar|conversar|agendar|reuni[a√£]o/i.test(lowerMsg)
                },
                words: lowerMsg.split(/\s+/).length
            };
        }

        // ============================================
        // PROCESSAMENTO DE MENSAGENS H√çBRIDO
        // ============================================
        async function sendMessage() {
            const message = elements.assistantInput.value.trim();
            if (!message || state.isProcessing) return;
            
            // Esconde sugest√µes
            elements.suggestionsContainer.style.display = 'none';
            
            // Atualiza estado
            state.isProcessing = true;
            const originalMessage = message;
            elements.assistantInput.value = '';
            elements.assistantInput.disabled = true;
            elements.sendAssistantBtn.disabled = true;
            
            // Adiciona mensagem do usu√°rio
            const timestamp = new Date();
            addMessage(originalMessage, 'user', 'user', timestamp);
            
            // Salva no hist√≥rico
            state.conversationHistory.push({
                role: 'user',
                content: originalMessage,
                timestamp: timestamp.toISOString(),
                source: 'user'
            });
            saveHistory();
            
            // Mostra indicador de digita√ß√£o
            showTyping();
            
            // Decide qual fonte usar
            const useDeepSeek = shouldUseDeepSeek(originalMessage);
            let response;
            let source = 'makerai';
            
            try {
                if (useDeepSeek && state.deepseekEnabled && state.apiKeyConfigured) {
                    // Usa DeepSeek API
                    elements.statusText.textContent = 'Pensando... ü§ñ';
                    elements.aiAvatar.classList.add('deepseek');
                    
                    const apiResponse = await callDeepSeekAPI(originalMessage, state.conversationHistory);
                    
                    if (apiResponse.success) {
                        response = apiResponse.response;
                        source = 'deepseek';
                        
                        // Adiciona indicador de uso da API
                        response += `\n\n---\n*Resposta gerada por DeepSeek AI ‚Ä¢ Tokens usados: ${apiResponse.usage?.total_tokens || 'N/A'}*`;
                        
                        showNotification(`Resposta da DeepSeek AI gerada com sucesso!`, 'success');
                    } else {
                        // Fallback para resposta local
                        response = apiResponse.fallbackResponse;
                        showNotification(`Usando resposta local: ${apiResponse.error}`, 'warning');
                    }
                    
                    elements.aiAvatar.classList.remove('deepseek');
                } else {
                    // Usa resposta local
                    const thinkingTime = Math.min(originalMessage.length * 20, 1500);
                    await new Promise(resolve => setTimeout(resolve, thinkingTime));
                    response = generateLocalResponse(originalMessage);
                    
                    if (useDeepSeek && !state.deepseekEnabled) {
                        response += `\n\nüí° *Dica:* Ative o modo DeepSeek para respostas mais detalhadas e t√©cnicas!`;
                    }
                }
                
                // Esconde indicador de digita√ß√£o
                hideTyping();
                
                // Adiciona atraso de digita√ß√£o realista
                const typingTime = Math.min(response.length * 5, 2000);
                await new Promise(resolve => setTimeout(resolve, typingTime));
                
                // Adiciona resposta
                const responseTimestamp = new Date();
                addMessage(response, 'ai', source, responseTimestamp);
                
                // Atualiza hist√≥rico
                state.conversationHistory.push({
                    role: 'assistant',
                    content: response,
                    timestamp: responseTimestamp.toISOString(),
                    source: source
                });
                saveHistory();
                
                // Atualiza status
                elements.statusText.textContent = source === 'deepseek' ? 
                    'Online ‚Ä¢ DeepSeek AI' : 
                    'Online ‚Ä¢ MakerAI Assist';
                
            } catch (error) {
                console.error('Erro ao processar mensagem:', error);
                hideTyping();
                
                // Resposta de erro
                const errorResponse = `Desculpe, encontrei um erro ao processar sua mensagem. üòî\n\n**Erro:** ${error.message}\n\nPor favor, tente novamente ou reformule sua pergunta.`;
                addMessage(errorResponse, 'ai', 'makerai', new Date());
                
                showNotification('Erro ao processar resposta', 'error');
            } finally {
                // Habilita input novamente
                state.isProcessing = false;
                elements.assistantInput.disabled = false;
                elements.sendAssistantBtn.disabled = false;
                elements.assistantInput.focus();
                elements.statusText.textContent = state.deepseekEnabled ? 
                    'Online ‚Ä¢ DeepSeek Dispon√≠vel' : 
                    'Online ‚Ä¢ IA Generativa';
            }
        }

        // ============================================
        // CONTROLE DO DEEPSEEK
        // ============================================
        function toggleDeepSeek() {
            if (!state.apiKeyConfigured) {
                showNotification('Configure sua API Key do DeepSeek primeiro!', 'error');
                return;
            }
            
            state.deepseekEnabled = !state.deepseekEnabled;
            
            if (state.deepseekEnabled) {
                elements.deepseekToggle.classList.add('active');
                elements.deepseekStatus.textContent = 'DeepSeek ON';
                elements.sendAssistantBtn.classList.add('deepseek-mode');
                elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Dispon√≠vel';
                showNotification('Modo DeepSeek ativado! ü§ñ\nPerguntas complexas ser√£o respondidas pela IA avan√ßada.', 'success');
            } else {
                elements.deepseekToggle.classList.remove('active');
                elements.deepseekStatus.textContent = 'DeepSeek OFF';
                elements.sendAssistantBtn.classList.remove('deepseek-mode');
                elements.statusText.textContent = 'Online ‚Ä¢ IA Generativa';
                showNotification('Modo DeepSeek desativado.', 'info');
            }
            
            // Salva prefer√™ncia
            localStorage.setItem('makerai_deepseek_enabled', state.deepseekEnabled);
        }

        function loadPreferences() {
            const deepseekEnabled = localStorage.getItem('makerai_deepseek_enabled');
            if (deepseekEnabled === 'true' && state.apiKeyConfigured) {
                state.deepseekEnabled = true;
                elements.deepseekToggle.classList.add('active');
                elements.deepseekStatus.textContent = 'DeepSeek ON';
                elements.sendAssistantBtn.classList.add('deepseek-mode');
                elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Dispon√≠vel';
            }
        }

        // ============================================
        // RESTANTE DAS FUN√á√ïES (simplificadas para brevidade)
        // ============================================
        function saveHistory() {
            const history = {
                sessionId: state.sessionId,
                messages: state.conversationHistory,
                lastUpdated: new Date().toISOString(),
                messageCount: state.messageCount,
                deepseekEnabled: state.deepseekEnabled
            };
            localStorage.setItem('makerai_chat_history', JSON.stringify(history));
            updateHistoryBadge();
        }

        function loadHistory() {
            try {
                const saved = localStorage.getItem('makerai_chat_history');
                if (saved) {
                    const history = JSON.parse(saved);
                    state.conversationHistory = history.messages || [];
                    state.messageCount = history.messageCount || 0;
                    
                    state.conversationHistory.forEach(msg => {
                        const timestamp = msg.timestamp ? new Date(msg.timestamp) : new Date();
                        addMessage(msg.content, msg.role, msg.source || 'makerai', timestamp);
                    });
                    
                    updateHistoryBadge();
                    return true;
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
            return false;
        }

        function clearHistory() {
            state.conversationHistory = [];
            state.messageCount = 0;
            elements.messagesContainer.innerHTML = '';
            localStorage.removeItem('makerai_chat_history');
            updateHistoryBadge();
            showNotification('Hist√≥rico limpo com sucesso!', 'success');
            
            // Adiciona mensagem inicial
            setTimeout(() => {
                addMessage(getInitialGreeting(), 'ai', 'makerai');
            }, 500);
        }

        function getInitialGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = "Bom dia";
            else if (hour < 18) greeting = "Boa tarde";
            else greeting = "Boa noite";
            
            const deepseekStatus = state.apiKeyConfigured ? 
                '\n\nüí° *Dica:* Ative o modo DeepSeek para respostas mais avan√ßadas!' : 
                '\n\n‚ö†Ô∏è *Aten√ß√£o:* Configure sua API Key do DeepSeek para usar IA avan√ßada.';
            
            return `${greeting}! üëã Sou o assistente da MakerAI Studio.${deepseekStatus}\n\nPosso te ajudar com projetos, or√ßamentos, cases ou qualquer d√∫vida sobre tecnologia!\n\nNo que posso te ajudar hoje?`;
        }

        function updateHistoryBadge() {
            const badge = elements.historyBtn;
            const count = state.conversationHistory.length;
            badge.dataset.badge = count > 0 ? count : '';
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Verifica API Key
            if (!state.apiKeyConfigured) {
                showNotification('‚ö†Ô∏è Configure DEEPSEEK_CONFIG.API_KEY para usar IA avan√ßada', 'warning');
                elements.deepseekToggle.style.opacity = '0.5';
                elements.deepseekToggle.style.cursor = 'not-allowed';
                elements.deepseekToggle.title = 'Configure a API Key primeiro';
            } else {
                elements.deepseekToggle.onclick = toggleDeepSeek;
                loadPreferences();
            }
            
            // Configura eventos
            elements.assistantInput.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            elements.sendAssistantBtn.addEventListener('click', sendMessage);
            
            // Configura bot√µes
            elements.closeAssistant.addEventListener('click', () => {
                window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
            });
            
            elements.clearBtn.addEventListener('click', () => {
                if (state.conversationHistory.length > 0) {
                    if (confirm('Tem certeza que deseja limpar toda a conversa?')) {
                        clearHistory();
                    }
                }
            });
            
            // Carrega hist√≥rico ou inicia nova conversa
            const hasHistory = loadHistory();
            if (!hasHistory) {
                setTimeout(() => {
                    addMessage(getInitialGreeting(), 'ai', 'makerai');
                }, 1000);
            }
            
            // Foco autom√°tico
            setTimeout(() => {
                elements.assistantInput.focus();
            }, 1500);
            
            // Notifica que est√° pronto
            setTimeout(() => {
                window.parent.postMessage({ 
                    type: 'ASSISTANT_READY',
                    config: {
                        deepseekAvailable: state.apiKeyConfigured,
                        deepseekEnabled: state.deepseekEnabled
                    }
                }, '*');
            }, 1000);
        });
    </script>
</body>
</html>