<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistente IA MakerAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #5f2eff, #8f6bff);
            --secondary-gradient: linear-gradient(135deg, #8f6bff, #9d7aff);
            --bg-primary: rgba(18, 18, 18, 0.98);
            --bg-secondary: rgba(15, 15, 15, 0.95);
            --bg-tertiary: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-color: #8f6bff;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: transparent;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }

        .assistant-panel {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: var(--bg-primary);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(20px);
            animation: panelIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes panelIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header melhorado */
        .chat-header {
            padding: 14px 18px;
            background: linear-gradient(135deg, 
                rgba(95, 46, 255, 0.25), 
                rgba(143, 107, 255, 0.15));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .ai-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            box-shadow: 0 4px 12px rgba(95, 46, 255, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-text {
            flex: 1;
        }

        .header-text h3 {
            font-size: 17px;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #d4c4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2px;
        }

        .header-text .status {
            font-size: 11px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--success-color);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .icon-btn[data-badge]::after {
            content: attr(data-badge);
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--accent-color);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 18px;
            text-align: center;
            border: 2px solid var(--bg-primary);
        }

        /* Container de mensagens melhorado */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 18px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(95, 46, 255, 0.02) 10%,
                transparent 90%
            );
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #5f2eff, #8f6bff);
            border-radius: var(--radius-full);
        }

        /* Mensagens aprimoradas */
        .message {
            max-width: 85%;
            padding: 16px 20px;
            border-radius: var(--radius-md);
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            font-size: 15px;
            box-shadow: var(--shadow-md);
            animation: messageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(10px);
        }

        @keyframes messageIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-message::before {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--primary-gradient);
            clip-path: polygon(100% 50%, 0 0, 0 100%);
        }

        .ai-message {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .ai-message::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--bg-tertiary);
            clip-path: polygon(0 50%, 100% 0, 100% 100%);
        }

        .message-time {
            display: block;
            font-size: 11px;
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
            font-weight: 500;
        }

        /* Indicador de digita√ß√£o melhorado */
        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            align-self: flex-start;
            border: 1px solid var(--border-color);
            animation: typingIn 0.3s ease;
            max-width: 120px;
        }

        @keyframes typingIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--accent-color);
            opacity: 0.4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { 
                opacity: 0.4; 
                transform: translateY(0px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-4px); 
            }
        }

        /* Container de op√ß√µes r√°pidas aprimorado */
        .quick-options-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            flex-shrink: 0;
            position: relative;
        }

        .quick-options-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .quick-options-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quick-options-title i {
            color: var(--accent-color);
        }

        .quick-options-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 12px;
            scrollbar-width: none;
        }

        .quick-options-carousel::-webkit-scrollbar {
            display: none;
        }

        .quick-option {
            flex: 0 0 auto;
            padding: 14px 18px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
        }

        .quick-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 0;
        }

        .quick-option > * {
            position: relative;
            z-index: 1;
        }

        .quick-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-option:hover::before {
            opacity: 0.1;
        }

        .quick-option:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .quick-option i {
            color: var(--accent-color);
            font-size: 14px;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .carousel-indicator {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
            padding: 0;
        }

        .carousel-indicator.active {
            background: var(--accent-color);
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(143, 107, 255, 0.5);
        }

        /* Container de input aprimorado */
        .input-container {
            padding: 16px 18px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            background: var(--bg-secondary);
            align-items: center;
            position: relative;
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        #assistantInput {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
        }

        #assistantInput:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(143, 107, 255, 0.1);
        }

        #assistantInput::placeholder {
            color: var(--text-tertiary);
        }

        .send-btn {
            background: var(--primary-gradient);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(95, 46, 255, 0.4);
        }

        .send-btn:hover::before {
            opacity: 1;
        }

        .send-btn:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Bot√£o de voltar */
        .back-btn {
            display: none;
        }

        /* Sugest√µes em tempo real */
        .suggestions-container {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 18px;
            right: 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
        }

        .suggestion-item {
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            color: var(--text-primary);
        }

        .suggestion-item:hover {
            background: var(--bg-tertiary);
        }

        /* Modal de confirma√ß√£o */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            margin-bottom: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .modal-message {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            border: 1px solid var(--border-color);
        }

        .modal-btn.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Feedback visual */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--transition-normal);
            z-index: 10001;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Responsividade aprimorada */
        @media (max-width: 767px) {
            .back-btn {
                display: flex;
            }

            .quick-option {
                font-size: 12.5px;
                padding: 12px 16px;
            }

            .message {
                max-width: 90%;
                padding: 14px 18px;
            }

            .input-container,
            .quick-options-container,
            .messages-container {
                padding-left: 16px;
                padding-right: 16px;
            }

            .chat-header {
                padding: 12px 16px;
            }

            .ai-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .header-text h3 {
                font-size: 16px;
            }
        }

        @media (max-height: 600px) {
            .messages-container {
                padding-top: 12px;
                padding-bottom: 12px;
            }

            .message {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: rgba(255, 255, 255, 0.98);
                --bg-secondary: rgba(250, 250, 250, 0.95);
                --bg-tertiary: rgba(0, 0, 0, 0.05);
                --text-primary: #1a1a1a;
                --text-secondary: rgba(0, 0, 0, 0.6);
                --text-tertiary: rgba(0, 0, 0, 0.4);
                --border-color: rgba(0, 0, 0, 0.1);
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Anima√ß√µes de entrada */
        .message:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .message:nth-child(even) {
            animation-delay: 0.2s;
        }
    </style>
</head>
<body>
    <div class="assistant-panel" id="assistantPanel">
        <!-- Header aprimorado -->
        <div class="chat-header">
            <div class="header-content">
                <div class="ai-avatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="header-text">
                    <h3>Assistente MakerAI</h3>
                    <div class="status">
                        <span class="status-dot"></span>
                        <span id="statusText">Online ‚Ä¢ IA Generativa</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="historyBtn" aria-label="Hist√≥rico" data-badge="0">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" id="clearBtn" aria-label="Limpar conversa">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button class="icon-btn back-btn" id="backBtn" aria-label="Voltar">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="icon-btn" id="closeAssistant" aria-label="Fechar assistente">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Container de mensagens -->
        <div class="messages-container" id="messagesContainer">
            <!-- Mensagens ser√£o inseridas aqui dinamicamente -->
        </div>

        <!-- Sugest√µes em tempo real -->
        <div class="suggestions-container" id="suggestionsContainer"></div>

        <!-- Container de op√ß√µes r√°pidas -->
        <div class="quick-options-container" id="quickOptionsContainer">
            <div class="quick-options-title">
                <i class="fas fa-bolt"></i> Perguntas frequentes
            </div>
            <div class="quick-options-carousel" id="quickOptionsCarousel"></div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </div>

        <!-- Container de input -->
        <div class="input-container">
            <input 
                type="text" 
                id="assistantInput" 
                placeholder="Digite sua pergunta..." 
                aria-label="Mensagem para o assistente"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
            >
            <button class="send-btn" id="sendAssistantBtn" aria-label="Enviar mensagem">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Limpar conversa</h3>
                <p class="modal-message" id="modalMessage">Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modalCancel">Cancelar</button>
                <button class="modal-btn primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>

    <script>
        // ============================================
        // ELEMENTOS E VARI√ÅVEIS GLOBAIS
        // ============================================
        const elements = {
            panel: document.getElementById('assistantPanel'),
            messagesContainer: document.getElementById('messagesContainer'),
            assistantInput: document.getElementById('assistantInput'),
            sendAssistantBtn: document.getElementById('sendAssistantBtn'),
            quickOptionsCarousel: document.getElementById('quickOptionsCarousel'),
            carouselIndicators: document.getElementById('carouselIndicators'),
            closeAssistant: document.getElementById('closeAssistant'),
            backBtn: document.getElementById('backBtn'),
            historyBtn: document.getElementById('historyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            statusText: document.getElementById('statusText'),
            suggestionsContainer: document.getElementById('suggestionsContainer'),
            confirmationModal: document.getElementById('confirmationModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalMessage: document.getElementById('modalMessage'),
            modalCancel: document.getElementById('modalCancel'),
            modalConfirm: document.getElementById('modalConfirm'),
            notification: document.getElementById('notification')
        };

        // Estado da aplica√ß√£o
        const state = {
            conversationHistory: [],
            isProcessing: false,
            carouselInterval: null,
            currentSlide: 0,
            messageCount: 0,
            typingTimeout: null,
            suggestions: [],
            isOnline: true,
            sessionId: generateSessionId()
        };

        // ============================================
        // CONFIGURA√á√ïES
        // ============================================
        const CONFIG = {
            TYPING_DELAY: 800,
            CAROUSEL_INTERVAL: 5000,
            SESSION_TIMEOUT: 30 * 60 * 1000, // 30 minutos
            MAX_MESSAGES: 100,
            SUGGESTIONS_LIMIT: 3
        };

        // ============================================
        // BANCO DE DADOS DE CONHECIMENTO
        // ============================================
        const KNOWLEDGE_BASE = {
            services: {
                title: "Servi√ßos",
                icon: "fas fa-cogs",
                response: `üöÄ **Solu√ß√µes Completas em Tecnologia**

**üíª Desenvolvimento Web & Mobile**
‚Ä¢ Sites institucionais e corporativos
‚Ä¢ PWAs (Progressive Web Apps)
‚Ä¢ E-commerce e marketplaces
‚Ä¢ Aplicativos nativos (React Native/Flutter)
‚Ä¢ Sistemas web complexos

**ü§ñ Intelig√™ncia Artificial**
‚Ä¢ Assistentes virtuais e chatbots
‚Ä¢ An√°lise preditiva de dados
‚Ä¢ Processamento de linguagem natural
‚Ä¢ Vis√£o computacional
‚Ä¢ Automa√ß√£o com IA

**üé® Design & Experi√™ncia**
‚Ä¢ UI/UX Design premium
‚Ä¢ Identidade visual
‚Ä¢ Prototipagem interativa
‚Ä¢ Design System
‚Ä¢ Microintera√ß√µes

**‚ö° Otimiza√ß√£o & Performance**
‚Ä¢ SEO t√©cnico
‚Ä¢ Performance web
‚Ä¢ Seguran√ßa digital
‚Ä¢ DevOps & CI/CD
‚Ä¢ Monitoramento

*Qual √°rea voc√™ gostaria de explorar?* üòä`,
                tags: ["site", "app", "sistema", "desenvolvimento", "web", "mobile"]
            },

            pricing: {
                title: "Or√ßamento",
                icon: "fas fa-money-bill-wave",
                response: `üí∞ **Transpar√™ncia Total nos Valores**

**üìä Modelos de Pre√ßo**
1. **Projeto Fixo** - Escopo definido, prazo fechado
   ‚Ä¢ Sites: R$ 8.000 - R$ 25.000
   ‚Ä¢ Apps: R$ 30.000 - R$ 80.000
   ‚Ä¢ Sistemas: R$ 40.000 - R$ 150.000

2. **Horas Avulsas** - R$ 120/hora
   ‚Ä¢ Para ajustes e melhorias
   ‚Ä¢ Manuten√ß√£o cont√≠nua
   ‚Ä¢ Consultorias t√©cnicas

3. **Assinatura Mensal** - A partir de R$ 1.500/m√™s
   ‚Ä¢ Suporte priorit√°rio
   ‚Ä¢ Atualiza√ß√µes constantes
   ‚Ä¢ Monitoramento 24/7

**üéØ Fatores que Influenciam:**
‚Ä¢ Complexidade do projeto
‚Ä¢ Prazo de entrega
‚Ä¢ Integra√ß√µes necess√°rias
‚Ä¢ N√≠vel de design
‚Ä¢ Recursos de IA inclu√≠dos

*Posso te passar uma estimativa mais precisa se voc√™ me contar sobre seu projeto!* ‚ú®`,
                tags: ["pre√ßo", "valor", "custo", "or√ßamento", "quanto custa"]
            },

            portfolio: {
                title: "Portf√≥lio",
                icon: "fas fa-images",
                response: `üé® **Cases de Sucesso**

**üè• Sa√∫de & Bem-estar**
‚Ä¢ App de telemedicina com IA
‚Ä¢ Sistema de gest√£o para cl√≠nicas
‚Ä¢ Plataforma de wellness corporativo

**üè¢ Empresarial**
‚Ä¢ Dashboard de BI em tempo real
‚Ä¢ Sistema de automa√ß√£o de processos
‚Ä¢ CRM personalizado com IA

**üõí E-commerce**
‚Ä¢ Marketplace com recomenda√ß√£o IA
‚Ä¢ E-commerce com realidade aumentada
‚Ä¢ Sistema de log√≠stica integrado

**üéì Educa√ß√£o**
‚Ä¢ Plataforma E-learning gamificada
‚Ä¢ App de cursos com tutoria IA
‚Ä¢ Sistema de gest√£o escolar

**üîó Tecnologia**
‚Ä¢ API Gateway para fintech
‚Ä¢ Sistema de monitoramento IoT
‚Ä¢ Plataforma de an√°lise de dados

*Tem algum setor espec√≠fico que te interessa? Posso detalhar cases similares!* üìä`,
                tags: ["cases", "projetos", "trabalhos", "exemplos", "portf√≥lio"]
            },

            contact: {
                title: "Contato",
                icon: "fas fa-envelope",
                response: `üìû **Vamos Conversar!**

**üì± Canais Diretos**
‚Ä¢ WhatsApp: (11) 99999-9999
‚Ä¢ Email: contato@makerai.com.br
‚Ä¢ LinkedIn: /makerai-studio

**üìç Endere√ßo**
‚Ä¢ S√£o Paulo - SP
‚Ä¢ Atendimento remoto em todo Brasil

**‚è∞ Hor√°rio de Atendimento**
‚Ä¢ Segunda a Sexta: 9h √†s 18h
‚Ä¢ S√°bado: 9h √†s 12h
‚Ä¢ Plant√£o t√©cnico: 24/7

**üéØ Pr√≥ximos Passos:**
1. Agendamos uma call explorat√≥ria
2. Analisamos suas necessidades
3. Criamos uma proposta personalizada
4. Iniciamos o projeto!

*Prefere que eu te direcione para o formul√°rio ou j√° quer marcar uma call?* üöÄ`,
                tags: ["contato", "whatsapp", "email", "telefone", "agendar"]
            }
        };

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function showNotification(message, type = 'info') {
            const notification = elements.notification;
            notification.textContent = message;
            notification.className = 'notification';
            
            // Adiciona classe baseada no tipo
            if (type === 'success') {
                notification.style.borderLeft = '4px solid var(--success-color)';
            } else if (type === 'error') {
                notification.style.borderLeft = '4px solid var(--error-color)';
            } else if (type === 'warning') {
                notification.style.borderLeft = '4px solid var(--warning-color)';
            } else {
                notification.style.borderLeft = '4px solid var(--accent-color)';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ============================================
        // GERENCIAMENTO DE MENSAGENS
        // ============================================
        function addMessage(text, sender, timestamp = new Date()) {
            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            div.dataset.messageId = messageId;
            
            const formattedTime = formatTime(timestamp);
            const timeElement = `<span class="message-time">${formattedTime}</span>`;
            
            // Processa markdown b√°sico
            let processedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            div.innerHTML = processedText + timeElement;
            
            // Adiciona anima√ß√£o baseada na posi√ß√£o
            const delay = state.messageCount * 0.1;
            div.style.animationDelay = `${delay}s`;
            
            elements.messagesContainer.appendChild(div);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
            
            state.messageCount++;
            
            return messageId;
        }

        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            elements.messagesContainer.appendChild(typing);
            elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;
        }

        function hideTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        // ============================================
        // GERENCIAMENTO DE HIST√ìRICO
        // ============================================
        function saveHistory() {
            const history = {
                sessionId: state.sessionId,
                messages: state.conversationHistory,
                lastUpdated: new Date().toISOString(),
                messageCount: state.messageCount
            };
            localStorage.setItem('makerai_chat_history', JSON.stringify(history));
            updateHistoryBadge();
        }

        function loadHistory() {
            try {
                const saved = localStorage.getItem('makerai_chat_history');
                if (saved) {
                    const history = JSON.parse(saved);
                    
                    // Verifica se a sess√£o √© muito antiga
                    const lastUpdated = new Date(history.lastUpdated);
                    const now = new Date();
                    const diffHours = (now - lastUpdated) / (1000 * 60 * 60);
                    
                    if (diffHours < 24) { // Mant√©m hist√≥rico por 24 horas
                        state.conversationHistory = history.messages || [];
                        state.messageCount = history.messageCount || 0;
                        
                        state.conversationHistory.forEach(msg => {
                            const timestamp = msg.timestamp ? new Date(msg.timestamp) : new Date();
                            addMessage(msg.content, msg.role, timestamp);
                        });
                        
                        updateHistoryBadge();
                        return true;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
            }
            return false;
        }

        function clearHistory() {
            state.conversationHistory = [];
            state.messageCount = 0;
            elements.messagesContainer.innerHTML = '';
            localStorage.removeItem('makerai_chat_history');
            updateHistoryBadge();
            showNotification('Hist√≥rico limpo com sucesso!', 'success');
            
            // Adiciona mensagem inicial
            setTimeout(() => {
                addMessage(getInitialGreeting(), 'ai');
            }, 500);
        }

        function updateHistoryBadge() {
            const badge = elements.historyBtn;
            const count = state.conversationHistory.length;
            badge.dataset.badge = count > 0 ? count : '';
        }

        // ============================================
        // SISTEMA DE RESPOSTAS INTELIGENTES
        // ============================================
        function getInitialGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = "Bom dia";
            else if (hour < 18) greeting = "Boa tarde";
            else greeting = "Boa noite";
            
            const greetings = [
                `${greeting}! üëã Sou o assistente da MakerAI. Como posso te ajudar hoje?`,
                `${greeting}! üòä Aqui √© o assistente da MakerAI. Pronto para criar algo incr√≠vel juntos?`,
                `${greeting}! üöÄ Eu sou o assistente da MakerAI. Vamos transformar sua ideia em realidade?`
            ];
            
            return greetings[Math.floor(Math.random() * greetings.length)];
        }

        function analyzeMessage(message) {
            const lowerMsg = message.toLowerCase().trim();
            const words = lowerMsg.split(/\s+/);
            
            // An√°lise de inten√ß√£o
            const intents = {
                greeting: /^(oi|ol√°|ola|e a√≠|bom dia|boa tarde|boa noite|hello|hi|hey)/i.test(lowerMsg),
                services: /servi[√ßc]os|desenvolvimento|site|app|sistema|programa[√ßc]|software/i.test(lowerMsg),
                pricing: /pre[√ßc]o|valor|custo|or[√ßc]amento|quanto custa|investimento/i.test(lowerMsg),
                portfolio: /portf[√≥o]lio|cases|projetos|trabalhos|exemplos|j[a√°] fez/i.test(lowerMsg),
                contact: /contato|whatsapp|email|telefone|falar|conversar|agendar|reuni[a√£]o/i.test(lowerMsg),
                help: /ajuda|como funciona|duvida|d[u√∫]vida|informa[√ßc][√£a]o/i.test(lowerMsg),
                urgent: /urgente|r[a√°]pido|imediat[ao]|hoje|agora|j[a√°]/i.test(lowerMsg)
            };
            
            // An√°lise de sentimento
            let sentiment = 'neutral';
            const positiveWords = ['√≥timo', 'excelente', 'perfeito', 'bom', 'legal', 'incr√≠vel', 'maravilhoso'];
            const negativeWords = ['ruim', 'p√©ssimo', 'horr√≠vel', 'problema', 'erro', 'bug', 'n√£o funciona'];
            
            if (positiveWords.some(word => lowerMsg.includes(word))) sentiment = 'positive';
            if (negativeWords.some(word => lowerMsg.includes(word))) sentiment = 'negative';
            
            return {
                intents,
                sentiment,
                words: words.length,
                hasQuestion: /\?$/.test(message),
                isUrgent: intents.urgent
            };
        }

        function generateResponse(message) {
            const analysis = analyzeMessage(message);
            
            // Respostas para sauda√ß√µes
            if (analysis.intents.greeting) {
                const hour = new Date().getHours();
                let timeGreeting;
                
                if (hour < 12) timeGreeting = "Bom dia";
                else if (hour < 18) timeGreeting = "Boa tarde";
                else timeGreeting = "Boa noite";
                
                return `${timeGreeting}! üòä\n\nSou o assistente da MakerAI Studio, especializado em transformar ideias em solu√ß√µes digitais incr√≠veis.\n\nNo que posso te ajudar hoje? Pode me contar sobre seu projeto, tirar d√∫vidas sobre or√ßamentos ou conhecer nossos cases de sucesso!`;
            }
            
            // Mapeamento de inten√ß√µes para respostas
            const intentMap = {
                services: KNOWLEDGE_BASE.services.response,
                pricing: KNOWLEDGE_BASE.pricing.response,
                portfolio: KNOWLEDGE_BASE.portfolio.response,
                contact: KNOWLEDGE_BASE.contact.response,
                help: `ü§ù **Como Posso Ajudar?**\n\nPosso te auxiliar com:\n\n‚Ä¢ Informa√ß√µes sobre nossos servi√ßos\n‚Ä¢ Estimativas de or√ßamento\n‚Ä¢ Exemplos de projetos realizados\n‚Ä¢ Processo de trabalho\n‚Ä¢ Agendamento de reuni√µes\n\n**Dica:** Use os bot√µes r√°pidos abaixo para navegar pelos t√≥picos principais! üöÄ`,
                urgent: `‚ö° **Entendi que √© urgente!**\n\nVamos acelerar o processo:\n\n1. Me conte rapidamente sobre o projeto\n2. Posso conectar voc√™ diretamente com nossa equipe\n3. Priorizamos atendimento imediato\n\n*Qual √© a situa√ß√£o?* üö®`
            };
            
            // Encontra a primeira inten√ß√£o ativa
            for (const [intent, isActive] of Object.entries(analysis.intents)) {
                if (isActive && intentMap[intent]) {
                    return intentMap[intent];
                }
            }
            
            // Resposta padr√£o baseada na an√°lise
            if (analysis.sentiment === 'negative') {
                return `Entendi que voc√™ pode estar com alguma dificuldade. üòî\n\nPosso te ajudar a resolver isso! Me conte mais detalhes sobre o que est√° acontecendo ou que tipo de solu√ß√£o voc√™ est√° procurando.\n\nJuntos vamos encontrar a melhor op√ß√£o! ü§ù`;
            }
            
            if (analysis.hasQuestion) {
                return `√ìtima pergunta! ü§î\n\nPara te dar uma resposta precisa, me conta um pouco mais sobre:\n\n‚Ä¢ O contexto do projeto\n‚Ä¢ Prazo que voc√™ tem em mente\n‚Ä¢ Or√ßamento dispon√≠vel\n‚Ä¢ Funcionalidades principais\n\nAssim posso te orientar da melhor forma poss√≠vel! üìã`;
            }
            
            // Resposta generativa para outras mensagens
            const genericResponses = [
                `Interessante! üßê\n\nNo que mais posso te ajudar sobre isso? Se for sobre desenvolvimento, IA, design ou qualquer outra √°rea da tecnologia, estou aqui para esclarecer!`,
                `Show! ‚ú®\n\nVamos explorar isso juntos! Me conta qual o objetivo principal do seu projeto ou que problema voc√™ quer resolver com a tecnologia.`,
                `Perfeito! üéØ\n\nPara te dar as melhores op√ß√µes, voc√™ poderia me falar:\n\n1. Qual √© o seu setor/niche?\n2. Tem algum prazo espec√≠fico?\n3. J√° tem alguma ideia de funcionalidades?\n\nAssim posso te ajudar de forma personalizada!`
            ];
            
            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        // ============================================
        // SUGEST√ïES EM TEMPO REAL
        // ============================================
        const updateSuggestions = debounce(function() {
            const query = elements.assistantInput.value.trim().toLowerCase();
            if (!query || query.length < 2) {
                elements.suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Filtra sugest√µes baseadas na query
            const allSuggestions = Object.values(KNOWLEDGE_BASE).flatMap(item => 
                item.tags.filter(tag => tag.includes(query)).map(tag => ({
                    text: `Sobre "${tag}"`,
                    action: () => {
                        elements.assistantInput.value = item.title;
                        sendMessage();
                    }
                }))
            );
            
            // Remove duplicatas
            const uniqueSuggestions = Array.from(
                new Map(allSuggestions.map(s => [s.text, s])).values()
            ).slice(0, CONFIG.SUGGESTIONS_LIMIT);
            
            if (uniqueSuggestions.length === 0) {
                elements.suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Atualiza UI
            elements.suggestionsContainer.innerHTML = '';
            uniqueSuggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = suggestion.text;
                item.onclick = suggestion.action;
                elements.suggestionsContainer.appendChild(item);
            });
            
            elements.suggestionsContainer.style.display = 'block';
        }, 300);

        // ============================================
        // CARROSSEL DE OP√á√ïES
        // ============================================
        function initQuickOptions() {
            elements.quickOptionsCarousel.innerHTML = '';
            
            Object.values(KNOWLEDGE_BASE).forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'quick-option';
                btn.innerHTML = `<i class="${item.icon}"></i> ${item.title}`;
                btn.onclick = () => {
                    elements.assistantInput.value = item.title;
                    sendMessage();
                };
                elements.quickOptionsCarousel.appendChild(btn);
            });
            
            updateIndicators();
            startCarousel();
        }

        function updateIndicators() {
            const itemsPerView = window.innerWidth < 768 ? 2 : 4;
            const total = Math.ceil(Object.keys(KNOWLEDGE_BASE).length / itemsPerView);
            elements.carouselIndicators.innerHTML = '';
            
            for (let i = 0; i < total; i++) {
                const dot = document.createElement('button');
                dot.className = `carousel-indicator ${i === state.currentSlide ? 'active' : ''}`;
                dot.onclick = () => goToSlide(i);
                elements.carouselIndicators.appendChild(dot);
            }
        }

        function goToSlide(index) {
            const itemsPerView = window.innerWidth < 768 ? 2 : 4;
            const totalSlides = Math.ceil(Object.keys(KNOWLEDGE_BASE).length / itemsPerView);
            
            if (index < 0) index = totalSlides - 1;
            if (index >= totalSlides) index = 0;
            
            state.currentSlide = index;
            const offset = index * itemsPerView * (elements.quickOptionsCarousel.children[0]?.offsetWidth + 10 || 140);
            elements.quickOptionsCarousel.scrollTo({ left: offset, behavior: 'smooth' });
            updateIndicators();
            
            // Reinicia o carrossel
            clearInterval(state.carouselInterval);
            startCarousel();
        }

        function startCarousel() {
            state.carouselInterval = setInterval(() => {
                goToSlide(state.currentSlide + 1);
            }, CONFIG.CAROUSEL_INTERVAL);
        }

        // ============================================
        // PROCESSAMENTO DE MENSAGENS
        // ============================================
        function sendMessage() {
            const message = elements.assistantInput.value.trim();
            if (!message || state.isProcessing) return;
            
            // Esconde sugest√µes
            elements.suggestionsContainer.style.display = 'none';
            
            // Atualiza estado
            state.isProcessing = true;
            elements.assistantInput.value = '';
            elements.assistantInput.disabled = true;
            elements.sendAssistantBtn.disabled = true;
            
            // Adiciona mensagem do usu√°rio
            const timestamp = new Date();
            addMessage(message, 'user', timestamp);
            
            // Salva no hist√≥rico
            state.conversationHistory.push({
                role: 'user',
                content: message,
                timestamp: timestamp.toISOString()
            });
            saveHistory();
            
            // Mostra indicador de digita√ß√£o
            showTyping();
            
            // Simula processamento com IA
            const thinkingTime = Math.min(message.length * 20, 2000); // M√°ximo 2 segundos
            const typingTime = Math.min(message.length * 5, 1000); // M√°ximo 1 segundo
            
            setTimeout(() => {
                hideTyping();
                
                // Gera resposta
                const response = generateResponse(message);
                
                // Adiciona atraso de digita√ß√£o realista
                setTimeout(() => {
                    const responseTimestamp = new Date();
                    addMessage(response, 'ai', responseTimestamp);
                    
                    // Atualiza hist√≥rico
                    state.conversationHistory.push({
                        role: 'assistant',
                        content: response,
                        timestamp: responseTimestamp.toISOString()
                    });
                    saveHistory();
                    
                    // Atualiza status
                    elements.statusText.textContent = 'Online ‚Ä¢ IA Generativa';
                    
                    // Habilita input novamente
                    state.isProcessing = false;
                    elements.assistantInput.disabled = false;
                    elements.sendAssistantBtn.disabled = false;
                    elements.assistantInput.focus();
                    
                    // Mostra notifica√ß√£o se for urgente
                    const analysis = analyzeMessage(message);
                    if (analysis.isUrgent) {
                        showNotification('‚ö° Atendimento priorit√°rio ativado', 'warning');
                    }
                    
                }, typingTime);
                
            }, thinkingTime);
        }

        // ============================================
        // MODAL DE CONFIRMA√á√ÉO
        // ============================================
        function showConfirmation(type, message, onConfirm) {
            const modal = elements.confirmationModal;
            
            // Configura baseada no tipo
            switch(type) {
                case 'clear':
                    elements.modalTitle.textContent = 'Limpar Conversa';
                    elements.modalMessage.textContent = message;
                    break;
                case 'close':
                    elements.modalTitle.textContent = 'Fechar Assistente';
                    elements.modalMessage.textContent = message;
                    break;
            }
            
            // Configura bot√µes
            elements.modalConfirm.onclick = () => {
                onConfirm();
                modal.style.display = 'none';
            };
            
            elements.modalCancel.onclick = () => {
                modal.style.display = 'none';
            };
            
            // Mostra modal
            modal.style.display = 'flex';
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Input principal
            elements.assistantInput.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            elements.assistantInput.addEventListener('input', updateSuggestions);
            
            // Bot√£o enviar
            elements.sendAssistantBtn.addEventListener('click', sendMessage);
            
            // Bot√£o fechar
            elements.closeAssistant.addEventListener('click', () => {
                if (state.conversationHistory.length > 0) {
                    showConfirmation(
                        'close',
                        'Tem certeza que deseja fechar o assistente? Seu progresso ser√° salvo automaticamente.',
                        () => window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*')
                    );
                } else {
                    window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                }
            });
            
            // Bot√£o voltar
            elements.backBtn.addEventListener('click', () => {
                window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
            });
            
            // Bot√£o hist√≥rico
            elements.historyBtn.addEventListener('click', () => {
                showNotification(`Voc√™ tem ${state.conversationHistory.length} mensagens nesta conversa.`, 'info');
            });
            
            // Bot√£o limpar
            elements.clearBtn.addEventListener('click', () => {
                showConfirmation(
                    'clear',
                    'Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.',
                    clearHistory
                );
            });
            
            // Fechar sugest√µes ao clicar fora
            document.addEventListener('click', (e) => {
                if (!elements.suggestionsContainer.contains(e.target) && 
                    !elements.assistantInput.contains(e.target)) {
                    elements.suggestionsContainer.style.display = 'none';
                }
            });
            
            // Comunica√ß√£o com o iframe pai
            window.addEventListener('message', (e) => {
                if (e.data?.type === 'OPEN_ASSISTANT') {
                    elements.panel.style.display = 'flex';
                    setTimeout(() => elements.assistantInput.focus(), 500);
                }
                
                if (e.data?.type === 'SET_INITIAL_MESSAGE') {
                    const msg = e.data.message || getInitialGreeting();
                    addMessage(msg, 'ai');
                    state.conversationHistory.push({
                        role: 'assistant',
                        content: msg,
                        timestamp: new Date().toISOString()
                    });
                    saveHistory();
                }
                
                if (e.data?.type === 'GET_HISTORY') {
                    window.parent.postMessage({
                        type: 'HISTORY_DATA',
                        data: state.conversationHistory
                    }, '*');
                }
            });
            
            // Redimensionamento
            window.addEventListener('resize', () => {
                updateIndicators();
                goToSlide(state.currentSlide);
            });
            
            // Pausa carrossel durante intera√ß√µes
            elements.quickOptionsCarousel.addEventListener('mouseenter', () => {
                clearInterval(state.carouselInterval);
            });
            
            elements.quickOptionsCarousel.addEventListener('mouseleave', startCarousel);
            
            elements.quickOptionsCarousel.addEventListener('touchstart', () => {
                clearInterval(state.carouselInterval);
            });
            
            elements.quickOptionsCarousel.addEventListener('touchend', () => {
                setTimeout(startCarousel, 3000);
            });
            
            // Verifica√ß√£o de conex√£o
            window.addEventListener('online', () => {
                state.isOnline = true;
                elements.statusText.textContent = 'Online ‚Ä¢ IA Generativa';
                showNotification('Conex√£o restabelecida!', 'success');
            });
            
            window.addEventListener('offline', () => {
                state.isOnline = false;
                elements.statusText.textContent = 'Offline ‚Ä¢ Modo Limitado';
                showNotification('Conex√£o perdida - algumas funcionalidades podem n√£o estar dispon√≠veis', 'warning');
            });
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializa componentes
            initQuickOptions();
            setupEventListeners();
            
            // Carrega hist√≥rico ou inicia nova conversa
            const hasHistory = loadHistory();
            if (!hasHistory) {
                setTimeout(() => {
                    addMessage(getInitialGreeting(), 'ai');
                }, 1000);
            }
            
            // Foco autom√°tico
            setTimeout(() => {
                elements.assistantInput.focus();
            }, 1500);
            
            // Notifica que est√° pronto
            setTimeout(() => {
                window.parent.postMessage({ type: 'ASSISTANT_READY' }, '*');
            }, 1000);
            
            // Verifica status inicial
            if (!navigator.onLine) {
                state.isOnline = false;
                elements.statusText.textContent = 'Offline ‚Ä¢ Modo Limitado';
            }
        });

        // Limpeza ao sair
        window.addEventListener('beforeunload', () => {
            clearInterval(state.carouselInterval);
            saveHistory();
        });
    </script>
</body>
</html>