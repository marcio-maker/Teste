<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assistente IA MakerAI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #5f2eff, #8f6bff);
            --secondary-gradient: linear-gradient(135deg, #8f6bff, #9d7aff);
            --deepseek-gradient: linear-gradient(135deg, #10a37f, #0d8b6b);
            --bg-primary: rgba(18, 18, 18, 0.98);
            --bg-secondary: rgba(15, 15, 15, 0.95);
            --bg-tertiary: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.5);
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-color: #8f6bff;
            --deepseek-color: #10a37f;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: transparent;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .assistant-panel {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 900px;
            background: var(--bg-primary);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(20px);
            animation: panelIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @keyframes panelIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header responsivo */
        .chat-header {
            padding: clamp(12px, 2vw, 16px) clamp(16px, 3vw, 24px);
            background: linear-gradient(135deg, 
                rgba(95, 46, 255, 0.25), 
                rgba(143, 107, 255, 0.15));
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            min-height: 64px;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.5vw, 16px);
            flex: 1;
            min-width: 0;
        }

        .ai-avatar {
            width: clamp(32px, 4vw, 48px);
            height: clamp(32px, 4vw, 48px);
            min-width: 32px;
            min-height: 32px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(14px, 1.8vw, 18px);
            color: white;
            box-shadow: 0 4px 12px rgba(95, 46, 255, 0.3);
            animation: pulse 2s infinite;
            position: relative;
            flex-shrink: 0;
        }

        .ai-avatar.deepseek::after {
            content: 'ü§ñ';
            position: absolute;
            bottom: -4px;
            right: -4px;
            background: var(--deepseek-color);
            color: white;
            font-size: 10px;
            padding: 3px 5px;
            border-radius: var(--radius-full);
            border: 2px solid var(--bg-primary);
            line-height: 1;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-text {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .header-text h3 {
            font-size: clamp(16px, 2vw, 20px);
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff, #d4c4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-text .status {
            font-size: clamp(10px, 1.2vw, 12px);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: var(--radius-full);
            background: var(--success-color);
            animation: blink 2s infinite;
            flex-shrink: 0;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: clamp(4px, 1vw, 12px);
            flex-shrink: 0;
        }

        .icon-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: clamp(36px, 5vw, 44px);
            height: clamp(36px, 5vw, 44px);
            min-width: 36px;
            min-height: 36px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
            position: relative;
            flex-shrink: 0;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .icon-btn[data-badge]::after {
            content: attr(data-badge);
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--accent-color);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
            min-width: 18px;
            height: 18px;
            text-align: center;
            border: 2px solid var(--bg-primary);
            line-height: 14px;
        }

        .icon-btn.deepseek-active {
            background: rgba(16, 163, 127, 0.2);
            border-color: var(--deepseek-color);
            color: var(--deepseek-color);
        }

        /* Bot√£o DeepSeek Toggle */
        .deepseek-toggle {
            display: flex;
            align-items: center;
            gap: clamp(4px, 0.8vw, 8px);
            padding: clamp(6px, 1vw, 10px) clamp(10px, 1.5vw, 16px);
            background: rgba(16, 163, 127, 0.1);
            border: 1px solid rgba(16, 163, 127, 0.3);
            border-radius: var(--radius-md);
            color: var(--deepseek-color);
            font-size: clamp(11px, 1.2vw, 13px);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            flex-shrink: 0;
            max-width: 160px;
            min-width: fit-content;
        }

        .deepseek-toggle:hover {
            background: rgba(16, 163, 127, 0.2);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .deepseek-toggle.active {
            background: var(--deepseek-gradient);
            color: white;
            border-color: var(--deepseek-color);
            box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
        }

        .deepseek-toggle i {
            font-size: clamp(12px, 1.4vw, 14px);
        }

        .deepseek-toggle span {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Container de mensagens responsivo */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: clamp(12px, 2vw, 20px) clamp(12px, 2vw, 20px);
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 1.5vw, 16px);
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(95, 46, 255, 0.02) 10%,
                transparent 90%
            );
            min-height: 0;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #5f2eff, #8f6bff);
            border-radius: var(--radius-full);
        }

        /* Mensagens responsivas */
        .message {
            max-width: 85%;
            padding: clamp(12px, 2vw, 16px) clamp(14px, 2.5vw, 20px);
            border-radius: var(--radius-md);
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            font-size: clamp(14px, 1.6vw, 16px);
            box-shadow: var(--shadow-md);
            animation: messageIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 95%;
                padding: 10px 14px;
                font-size: 13.5px;
            }
        }

        .user-message {
            background: var(--primary-gradient);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--radius-sm);
            margin-left: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ai-message {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
        }

        .ai-message.deepseek-response {
            background: rgba(16, 163, 127, 0.1);
            border-color: var(--deepseek-color);
            border-left: 3px solid var(--deepseek-color);
        }

        .message-source {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: clamp(9px, 1vw, 11px);
            opacity: 0.7;
            margin-bottom: 4px;
            font-weight: 500;
            flex-wrap: wrap;
        }

        .message-source .badge {
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .message-source .badge.makerai {
            background: rgba(143, 107, 255, 0.2);
            color: #8f6bff;
        }

        .message-source .badge.deepseek {
            background: rgba(16, 163, 127, 0.2);
            color: #10a37f;
        }

        .message-time {
            display: block;
            font-size: clamp(9px, 1vw, 11px);
            opacity: 0.6;
            margin-top: 6px;
            text-align: right;
            font-weight: 500;
        }

        /* Indicador de digita√ß√£o responsivo */
        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: clamp(12px, 2vw, 16px) clamp(16px, 2.5vw, 20px);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            align-self: flex-start;
            border: 1px solid var(--border-color);
            animation: typingIn 0.3s ease;
            max-width: 120px;
        }

        .typing-indicator span {
            width: clamp(6px, 1vw, 8px);
            height: clamp(6px, 1vw, 8px);
            border-radius: var(--radius-full);
            background: var(--accent-color);
            opacity: 0.4;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { 
                opacity: 0.4; 
                transform: translateY(0px); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-4px); 
            }
        }

        /* Container de op√ß√µes r√°pidas responsivo */
        .quick-options-container {
            padding: clamp(12px, 2vw, 16px) clamp(12px, 2vw, 18px);
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
            flex-shrink: 0;
            position: relative;
            min-height: fit-content;
        }

        .quick-options-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        .quick-options-title {
            font-size: clamp(10px, 1.2vw, 12px);
            color: var(--text-secondary);
            margin-bottom: clamp(8px, 1.5vw, 12px);
            display: flex;
            align-items: center;
            gap: clamp(4px, 1vw, 8px);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .quick-options-title i {
            color: var(--accent-color);
            font-size: clamp(11px, 1.3vw, 13px);
        }

        .quick-options-carousel {
            display: flex;
            gap: clamp(6px, 1vw, 10px);
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: clamp(8px, 1.5vw, 12px);
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .quick-options-carousel::-webkit-scrollbar {
            display: none;
        }

        .quick-option {
            flex: 0 0 auto;
            padding: clamp(10px, 1.5vw, 14px) clamp(12px, 2vw, 18px);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: clamp(12px, 1.4vw, 14px);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: clamp(6px, 1vw, 10px);
            white-space: nowrap;
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
            min-width: fit-content;
        }

        .quick-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 0;
        }

        .quick-option > * {
            position: relative;
            z-index: 1;
        }

        .quick-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .quick-option:hover::before {
            opacity: 0.1;
        }

        .quick-option:active {
            transform: translateY(0);
            transition-duration: 0.1s;
        }

        .quick-option i {
            color: var(--accent-color);
            font-size: clamp(12px, 1.4vw, 14px);
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: clamp(6px, 1.5vw, 12px);
        }

        .carousel-indicator {
            width: clamp(4px, 0.8vw, 6px);
            height: clamp(4px, 0.8vw, 6px);
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
            padding: 0;
            flex-shrink: 0;
        }

        .carousel-indicator.active {
            background: var(--accent-color);
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(143, 107, 255, 0.5);
        }

        /* Container de input responsivo */
        .input-container {
            padding: clamp(12px, 2vw, 16px) clamp(12px, 2vw, 18px);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: clamp(8px, 1.5vw, 12px);
            background: var(--bg-secondary);
            align-items: center;
            position: relative;
            min-height: fit-content;
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--accent-color), 
                transparent);
        }

        #assistantInput {
            flex: 1;
            padding: clamp(12px, 2vw, 16px) clamp(14px, 2.5vw, 20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: clamp(14px, 1.6vw, 16px);
            outline: none;
            transition: all var(--transition-normal);
            font-weight: 500;
            min-width: 0;
        }

        #assistantInput:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(143, 107, 255, 0.1);
        }

        #assistantInput::placeholder {
            color: var(--text-tertiary);
            font-size: clamp(13px, 1.5vw, 15px);
        }

        .send-btn {
            background: var(--primary-gradient);
            border: none;
            width: clamp(40px, 6vw, 52px);
            height: clamp(40px, 6vw, 52px);
            min-width: 40px;
            min-height: 40px;
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: clamp(14px, 1.8vw, 18px);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .send-btn.deepseek-mode {
            background: var(--deepseek-gradient);
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(95, 46, 255, 0.4);
        }

        .send-btn.deepseek-mode:hover {
            box-shadow: 0 8px 24px rgba(16, 163, 127, 0.4);
        }

        .send-btn:hover::before {
            opacity: 1;
        }

        .send-btn:active {
            transform: scale(0.98);
            transition-duration: 0.1s;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Bot√£o de voltar */
        .back-btn {
            display: none;
        }

        /* Sugest√µes em tempo real responsivas */
        .suggestions-container {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: clamp(12px, 2vw, 18px);
            right: clamp(12px, 2vw, 18px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            max-height: 200px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: clamp(8px, 1.5vw, 12px) clamp(10px, 2vw, 14px);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: clamp(13px, 1.5vw, 14px);
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .suggestion-item:hover {
            background: var(--bg-tertiary);
        }

        /* Modal de confirma√ß√£o responsivo */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: clamp(16px, 4vw, 32px);
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: clamp(20px, 4vw, 32px);
            max-width: min(90vw, 500px);
            width: 100%;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            margin-bottom: clamp(12px, 3vw, 20px);
        }

        .modal-title {
            font-size: clamp(16px, 2.5vw, 20px);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .modal-message {
            color: var(--text-secondary);
            font-size: clamp(13px, 1.8vw, 15px);
            line-height: 1.5;
            word-wrap: break-word;
        }

        .modal-actions {
            display: flex;
            gap: clamp(8px, 2vw, 16px);
            margin-top: clamp(16px, 3vw, 24px);
        }

        .modal-btn {
            flex: 1;
            padding: clamp(10px, 2vw, 14px) clamp(16px, 3vw, 24px);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: clamp(13px, 1.8vw, 15px);
            border: 1px solid var(--border-color);
            min-width: 0;
            text-align: center;
        }

        .modal-btn.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Feedback visual responsivo */
        .notification {
            position: fixed;
            top: clamp(16px, 4vw, 24px);
            right: clamp(16px, 4vw, 24px);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: clamp(10px, 2vw, 14px) clamp(12px, 3vw, 18px);
            color: var(--text-primary);
            font-size: clamp(12px, 1.6vw, 14px);
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--transition-normal);
            z-index: 10001;
            max-width: min(90vw, 350px);
            word-wrap: break-word;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Indicador de fonte */
        .source-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-left: 6px;
            vertical-align: middle;
            flex-shrink: 0;
        }

        .source-indicator.makerai {
            background: rgba(143, 107, 255, 0.2);
            color: #8f6bff;
        }

        .source-indicator.deepseek {
            background: rgba(16, 163, 127, 0.2);
            color: #10a37f;
        }

        /* Breakpoints espec√≠ficos */
        @media (max-width: 1200px) {
            .assistant-panel {
                max-width: 95vw;
                max-height: 95vh;
                margin: 2.5vh auto;
            }
        }

        @media (max-width: 1024px) {
            .header-actions {
                gap: 6px;
            }
            
            .deepseek-toggle span {
                display: none;
            }
            
            .deepseek-toggle {
                padding: 8px;
                width: 40px;
                justify-content: center;
            }
            
            .deepseek-toggle i {
                margin: 0;
            }
        }

        @media (max-width: 768px) {
            .assistant-panel {
                max-width: 100vw;
                max-height: 100vh;
                margin: 0;
                border-radius: 0;
                border: none;
            }
            
            .chat-header {
                padding: 12px 16px;
            }
            
            .header-actions {
                gap: 4px;
            }
            
            .deepseek-toggle {
                width: 36px;
                height: 36px;
                padding: 0;
            }
            
            .icon-btn {
                width: 36px;
                height: 36px;
            }
            
            .ai-avatar {
                width: 32px;
                height: 32px;
            }
            
            .header-text h3 {
                font-size: 15px;
            }
            
            .messages-container {
                padding: 12px;
            }
            
            .quick-options-container,
            .input-container {
                padding: 12px;
            }
            
            .quick-option {
                padding: 10px 14px;
                font-size: 12px;
            }
            
            #assistantInput {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .send-btn {
                width: 44px;
                height: 44px;
            }
            
            .back-btn {
                display: flex;
            }
        }

        @media (max-width: 480px) {
            .chat-header {
                padding: 10px 12px;
                min-height: 56px;
            }
            
            .header-content {
                gap: 8px;
            }
            
            .ai-avatar {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .header-text h3 {
                font-size: 14px;
            }
            
            .status {
                font-size: 10px;
            }
            
            .icon-btn {
                width: 32px;
                height: 32px;
            }
            
            .deepseek-toggle {
                width: 32px;
                height: 32px;
            }
            
            .messages-container {
                padding: 10px;
                gap: 10px;
            }
            
            .message {
                font-size: 13px;
                padding: 10px 14px;
            }
            
            .quick-options-container {
                padding: 10px;
            }
            
            .quick-options-title {
                font-size: 10px;
                margin-bottom: 8px;
            }
            
            .quick-option {
                padding: 8px 12px;
                font-size: 11px;
                gap: 6px;
            }
            
            .quick-option i {
                font-size: 11px;
            }
            
            .input-container {
                padding: 10px;
                gap: 8px;
            }
            
            #assistantInput {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .send-btn {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            
            .modal-content {
                padding: 16px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 360px) {
            .chat-header {
                flex-wrap: wrap;
                min-height: auto;
                padding: 8px;
            }
            
            .header-content {
                order: 1;
                width: 100%;
                margin-bottom: 8px;
            }
            
            .header-actions {
                order: 2;
                width: 100%;
                justify-content: space-between;
            }
            
            .deepseek-toggle span {
                display: inline;
                font-size: 10px;
            }
            
            .deepseek-toggle {
                width: auto;
                padding: 6px 10px;
            }
            
            .messages-container {
                padding: 8px;
            }
            
            .message {
                max-width: 100%;
            }
        }

        @media (max-height: 700px) {
            .assistant-panel {
                max-height: 100vh;
            }
            
            .messages-container {
                padding-top: 8px;
                padding-bottom: 8px;
            }
            
            .message {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .quick-options-container {
                padding: 10px;
            }
            
            .input-container {
                padding: 10px;
            }
        }

        @media (max-height: 500px) {
            .quick-options-container {
                display: none;
            }
            
            .messages-container {
                padding: 6px;
            }
            
            .message {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* Orienta√ß√£o paisagem em mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .assistant-panel {
                flex-direction: row;
            }
            
            .chat-header {
                flex-direction: column;
                width: 80px;
                min-height: 100%;
                border-right: 1px solid var(--border-color);
                border-bottom: none;
                padding: 12px 8px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .header-text h3 {
                writing-mode: vertical-rl;
                transform: rotate(180deg);
                white-space: nowrap;
                margin: 8px 0;
            }
            
            .status {
                display: none;
            }
            
            .header-actions {
                flex-direction: column;
                margin-top: auto;
            }
            
            .deepseek-toggle {
                width: 100%;
                justify-content: center;
            }
            
            .deepseek-toggle span {
                display: none;
            }
            
            .messages-container {
                flex: 1;
            }
            
            .quick-options-container,
            .input-container {
                display: none;
            }
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg-primary: rgba(255, 255, 255, 0.98);
                --bg-secondary: rgba(250, 250, 250, 0.95);
                --bg-tertiary: rgba(0, 0, 0, 0.05);
                --text-primary: #1a1a1a;
                --text-secondary: rgba(0, 0, 0, 0.6);
                --text-tertiary: rgba(0, 0, 0, 0.4);
                --border-color: rgba(0, 0, 0, 0.1);
                --accent-color: #5f2eff;
                --deepseek-color: #0d8b6b;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Utilit√°rios de layout */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .hidden {
            display: none !important;
        }

        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .flex-between {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Anima√ß√µes de entrada */
        .message:nth-child(odd) {
            animation-delay: 0.1s;
        }

        .message:nth-child(even) {
            animation-delay: 0.2s;
        }

        /* Ajustes para telas muito grandes */
        @media (min-width: 1600px) {
            .assistant-panel {
                max-width: 1400px;
                max-height: 1000px;
            }
            
            .chat-header {
                padding: 20px 32px;
            }
            
            .messages-container {
                padding: 24px 32px;
            }
            
            .quick-options-container,
            .input-container {
                padding: 20px 32px;
            }
            
            .message {
                font-size: 17px;
                max-width: 80%;
            }
        }

        /* Suporte para dispositivos com notche */
        @supports (padding-top: env(safe-area-inset-top)) {
            .assistant-panel {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
        }

        /* Suporte para dispositivos foldable */
        @media (spanning: single-fold-vertical) {
            .assistant-panel {
                max-width: calc(100vw - env(fold-width));
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="assistant-panel" id="assistantPanel">
        <!-- Header responsivo -->
        <div class="chat-header">
            <div class="header-content">
                <div class="ai-avatar" id="aiAvatar">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="header-text">
                    <h3>Assistente MakerAI</h3>
                    <div class="status">
                        <span class="status-dot"></span>
                        <span id="statusText">Conectando...</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <!-- Bot√£o DeepSeek Toggle - VIS√çVEL E FUNCIONAL -->
                <button class="deepseek-toggle" id="deepseekToggle" aria-label="Alternar modo DeepSeek">
                    <i class="fas fa-robot"></i>
                    <span id="deepseekStatus">DeepSeek OFF</span>
                </button>
                
                <button class="icon-btn" id="historyBtn" aria-label="Hist√≥rico da conversa" data-badge="0">
                    <i class="fas fa-history"></i>
                </button>
                
                <button class="icon-btn" id="clearBtn" aria-label="Limpar conversa">
                    <i class="fas fa-trash-alt"></i>
                </button>
                
                <button class="icon-btn back-btn" id="backBtn" aria-label="Voltar">
                    <i class="fas fa-arrow-left"></i>
                </button>
                
                <button class="icon-btn" id="closeAssistant" aria-label="Fechar assistente">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Container de mensagens -->
        <div class="messages-container" id="messagesContainer">
            <!-- Mensagens ser√£o inseridas aqui -->
        </div>

        <!-- Sugest√µes em tempo real -->
        <div class="suggestions-container" id="suggestionsContainer"></div>

        <!-- Container de op√ß√µes r√°pidas -->
        <div class="quick-options-container" id="quickOptionsContainer">
            <div class="quick-options-title">
                <i class="fas fa-bolt"></i> 
                <span class="quick-title-text">Perguntas r√°pidas</span>
            </div>
            <div class="quick-options-carousel" id="quickOptionsCarousel"></div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </div>

        <!-- Container de input -->
        <div class="input-container">
            <input 
                type="text" 
                id="assistantInput" 
                placeholder="Digite sua mensagem..." 
                aria-label="Mensagem para o assistente"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                enterkeyhint="send"
            >
            <button class="send-btn" id="sendAssistantBtn" aria-label="Enviar mensagem">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirma√ß√£o</h3>
                <p class="modal-message" id="modalMessage">Tem certeza que deseja realizar esta a√ß√£o?</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modalCancel">Cancelar</button>
                <button class="modal-btn primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div class="notification" id="notification"></div>

    <script>
        // ============================================
        // CONFIGURA√á√ïES DA API DEEPSEEK
        // ============================================
        const DEEPSEEK_CONFIG = {
            // üîë INSIRA SUA API KEY DO DEEPSEEK AQUI
            API_KEY: '', // Exemplo: 'sk-123456789abcdef...'
            
            BASE_URL: 'https://api.deepseek.com/v1',
            MODEL: 'deepseek-chat',
            MAX_TOKENS: 2048,
            TEMPERATURE: 0.7,
            SYSTEM_PROMPT: `Voc√™ √© um assistente especializado da MakerAI Studio. 
Forne√ßa respostas precisas, √∫teis e amig√°veis sobre desenvolvimento de software, IA e solu√ß√µes digitais.
Seja conciso mas completo, e sempre ofere√ßa ajuda adicional.`
        };

        // ============================================
        // ELEMENTOS E VARI√ÅVEIS GLOBAIS
        // ============================================
        const elements = {
            panel: document.getElementById('assistantPanel'),
            messagesContainer: document.getElementById('messagesContainer'),
            assistantInput: document.getElementById('assistantInput'),
            sendAssistantBtn: document.getElementById('sendAssistantBtn'),
            quickOptionsCarousel: document.getElementById('quickOptionsCarousel'),
            carouselIndicators: document.getElementById('carouselIndicators'),
            closeAssistant: document.getElementById('closeAssistant'),
            backBtn: document.getElementById('backBtn'),
            historyBtn: document.getElementById('historyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            statusText: document.getElementById('statusText'),
            suggestionsContainer: document.getElementById('suggestionsContainer'),
            confirmationModal: document.getElementById('confirmationModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalMessage: document.getElementById('modalMessage'),
            modalCancel: document.getElementById('modalCancel'),
            modalConfirm: document.getElementById('modalConfirm'),
            notification: document.getElementById('notification'),
            deepseekToggle: document.getElementById('deepseekToggle'),
            deepseekStatus: document.getElementById('deepseekStatus'),
            aiAvatar: document.getElementById('aiAvatar'),
            quickTitleText: document.querySelector('.quick-title-text')
        };

        // Estado da aplica√ß√£o
        const state = {
            conversationHistory: [],
            isProcessing: false,
            carouselInterval: null,
            currentSlide: 0,
            messageCount: 0,
            typingTimeout: null,
            suggestions: [],
            isOnline: true,
            sessionId: generateSessionId(),
            deepseekEnabled: false,
            useDeepSeek: false,
            apiKeyConfigured: DEEPSEEK_CONFIG.API_KEY && DEEPSEEK_CONFIG.API_KEY.trim().length > 0,
            apiRequestsCount: 0,
            lastApiRequest: null,
            windowWidth: window.innerWidth,
            windowHeight: window.innerHeight,
            isMobile: window.innerWidth <= 768,
            isTablet: window.innerWidth > 768 && window.innerWidth <= 1024,
            isDesktop: window.innerWidth > 1024,
            orientation: window.innerWidth > window.innerHeight ? 'landscape' : 'portrait'
        };

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatTime(date = new Date()) {
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        }

        function formatDate(date = new Date()) {
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function showNotification(message, type = 'info', duration = 3000) {
            const notification = elements.notification;
            notification.textContent = message;
            notification.className = 'notification';
            
            // Remove classes anteriores
            notification.classList.remove('success', 'error', 'warning', 'info');
            
            // Adiciona classe baseada no tipo
            notification.classList.add(type);
            
            // Estilo baseado no tipo
            const borderColors = {
                success: 'var(--success-color)',
                error: 'var(--error-color)',
                warning: 'var(--warning-color)',
                info: 'var(--accent-color)'
            };
            
            notification.style.borderLeft = `4px solid ${borderColors[type] || 'var(--accent-color)'}`;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // ============================================
        // GERENCIAMENTO DE MENSAGENS
        // ============================================
        function addMessage(text, sender, source = 'makerai', timestamp = new Date()) {
            const messageId = 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const div = document.createElement('div');
            div.className = `message ${sender}-message`;
            
            if (sender === 'ai' && source === 'deepseek') {
                div.classList.add('deepseek-response');
            }
            
            div.dataset.messageId = messageId;
            div.dataset.source = source;
            div.dataset.timestamp = timestamp.toISOString();
            
            const formattedTime = formatTime(timestamp);
            const formattedDate = formatDate(timestamp);
            
            // Adiciona indicador de fonte para mensagens AI
            let sourceIndicator = '';
            if (sender === 'ai') {
                const sourceName = source === 'deepseek' ? 'DeepSeek AI' : 'MakerAI';
                const sourceClass = source === 'deepseek' ? 'deepseek' : 'makerai';
                sourceIndicator = `
                    <div class="message-source">
                        <span class="badge ${sourceClass}">${sourceName}</span>
                        <span>‚Ä¢</span>
                        <span title="${formattedDate} ${formattedTime}">${formattedTime}</span>
                    </div>
                `;
            }
            
            // Processa formata√ß√£o b√°sica
            let processedText = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>')
                .replace(/\n/g, '<br>');
            
            div.innerHTML = sourceIndicator + processedText;
            
            if (sender === 'user') {
                div.innerHTML += `
                    <span class="message-time" title="${formattedDate} ${formattedTime}">
                        ${formattedTime}
                    </span>
                `;
            }
            
            // Adiciona anima√ß√£o baseada na posi√ß√£o
            const delay = Math.min(state.messageCount * 0.05, 0.5);
            div.style.animationDelay = `${delay}s`;
            
            elements.messagesContainer.appendChild(div);
            
            // Scroll suave para a nova mensagem
            setTimeout(() => {
                div.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 50);
            
            state.messageCount++;
            
            return messageId;
        }

        function showTyping() {
            // Remove indicador existente
            hideTyping();
            
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            typing.setAttribute('aria-label', 'Assistente est√° digitando...');
            
            elements.messagesContainer.appendChild(typing);
            
            // Scroll para o indicador
            setTimeout(() => {
                typing.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 100);
        }

        function hideTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) {
                typing.remove();
            }
        }

        // ============================================
        // INTEGRA√á√ÉO COM API DEEPSEEK
        // ============================================
        async function callDeepSeekAPI(message, conversationContext) {
            if (!state.apiKeyConfigured) {
                throw new Error('API Key do DeepSeek n√£o configurada. Configure DEEPSEEK_CONFIG.API_KEY.');
            }

            try {
                state.apiRequestsCount++;
                state.lastApiRequest = new Date();
                
                // Prepara mensagens para a API
                const apiMessages = [
                    {
                        role: "system",
                        content: DEEPSEEK_CONFIG.SYSTEM_PROMPT
                    },
                    // Inclui apenas as √∫ltimas 6 mensagens para contexto
                    ...conversationContext.slice(-6).map(msg => ({
                        role: msg.role === 'user' ? 'user' : 'assistant',
                        content: msg.content.substring(0, 1000) // Limita tamanho
                    })),
                    {
                        role: "user",
                        content: message.substring(0, 2000) // Limita mensagem atual
                    }
                ];

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 segundos timeout

                const response = await fetch(`${DEEPSEEK_CONFIG.BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_CONFIG.API_KEY}`,
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: DEEPSEEK_CONFIG.MODEL,
                        messages: apiMessages,
                        max_tokens: DEEPSEEK_CONFIG.MAX_TOKENS,
                        temperature: DEEPSEEK_CONFIG.TEMPERATURE,
                        stream: false
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    let errorMessage = `Erro ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error?.message || errorMessage;
                    } catch (e) {
                        // Ignora erro de parsing
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    return {
                        success: true,
                        response: data.choices[0].message.content,
                        usage: data.usage || {},
                        model: data.model
                    };
                } else {
                    throw new Error('Resposta inv√°lida da API');
                }
                
            } catch (error) {
                console.error('Erro na API DeepSeek:', error);
                
                // Fallback para respostas locais
                return {
                    success: false,
                    error: error.message,
                    fallbackResponse: generateLocalResponse(message)
                };
            }
        }

        // ============================================
        // SISTEMA H√çBRIDO DE RESPOSTAS
        // ============================================
        function shouldUseDeepSeek(message) {
            // Se DeepSeek n√£o estiver habilitado ou API key n√£o configurada
            if (!state.deepseekEnabled || !state.apiKeyConfigured) {
                return false;
            }

            const analysis = analyzeMessage(message);
            
            // Usa DeepSeek para:
            // 1. Perguntas complexas ou longas
            if (message.length > 100) return true;
            
            // 2. Perguntas t√©cnicas detalhadas
            const techKeywords = [
                'como funciona', 'tutorial', 'explica√ß√£o', 'detalhes', 
                't√©cnico', 'c√≥digo', 'implementar', 'desenvolver',
                'arquitetura', 'algoritmo', 'banco de dados', 'api',
                'integra√ß√£o', 'deploy', 'devops', 'machine learning',
                'ia avan√ßada', 'deep learning', 'neural network'
            ];
            
            if (techKeywords.some(keyword => 
                message.toLowerCase().includes(keyword.toLowerCase()))) {
                return true;
            }
            
            // 3. Quando explicitamente solicitado
            if (message.toLowerCase().includes('deepseek') || 
                message.toLowerCase().includes('ia avan√ßada') ||
                message.toLowerCase().includes('gpt') ||
                message.toLowerCase().includes('intelig√™ncia artificial')) {
                return true;
            }
            
            // 4. Para perguntas que n√£o s√£o sobre a MakerAI
            if (!isAboutMakerAI(message)) {
                return true;
            }
            
            return false;
        }

        function isAboutMakerAI(message) {
            const lowerMsg = message.toLowerCase();
            const makeraiKeywords = [
                'makerai', 'maker ai', 'studio makerai',
                'servi√ßos', 'pre√ßo', 'or√ßamento', 'portfolio',
                'contato', 'empresa', 'quem s√£o', 'equipe',
                'site', 'app', 'sistema', 'projeto',
                'prazo', 'tempo', 'entrega',
                'suporte', 'garantia', 'manuten√ß√£o'
            ];
            
            return makeraiKeywords.some(keyword => lowerMsg.includes(keyword));
        }

        function analyzeMessage(message) {
            const lowerMsg = message.toLowerCase().trim();
            
            return {
                intents: {
                    greeting: /^(oi|ol√°|ola|e a√≠|bom dia|boa tarde|boa noite|hello|hi|hey|sauda√ß√µes)/i.test(lowerMsg),
                    services: /servi[√ßc]os|desenvolvimento|site|app|sistema|programa[√ßc]|software|plataforma/i.test(lowerMsg),
                    pricing: /pre[√ßc]o|valor|custo|or[√ßc]amento|quanto custa|investimento|financeiro|pagamento/i.test(lowerMsg),
                    portfolio: /portf[√≥o]lio|cases|projetos|trabalhos|exemplos|j[a√°] fez|realizou|cliente/i.test(lowerMsg),
                    contact: /contato|whatsapp|email|telefone|falar|conversar|agendar|reuni[a√£]o|liga[√ßc][a√£]o/i.test(lowerMsg),
                    technical: /t[√©e]cnico|c[√≥o]digo|tecnologia|programa[√ßc][a√£]o|desenvolver|implementar|arquitetura/i.test(lowerMsg),
                    help: /ajuda|socorro|problema|erro|bug|n√£o funciona|dificuldade|complicado/i.test(lowerMsg)
                },
                length: message.length,
                words: message.split(/\s+/).length,
                hasQuestionMark: message.includes('?'),
                urgency: /urgente|r[a√°]pido|imediat[ao]|hoje|agora|j[a√°]|asap/i.test(lowerMsg)
            };
        }

        function generateLocalResponse(message) {
            const analysis = analyzeMessage(message);
            
            // Respostas para sauda√ß√µes
            if (analysis.intents.greeting) {
                const hour = new Date().getHours();
                let timeGreeting;
                
                if (hour < 12) timeGreeting = "Bom dia";
                else if (hour < 18) timeGreeting = "Boa tarde";
                else timeGreeting = "Boa noite";
                
                const deepseekHint = state.apiKeyConfigured ? 
                    '\n\nüí° *Dica:* Ative o bot√£o DeepSeek ü§ñ para respostas mais avan√ßadas sobre tecnologia e desenvolvimento!' : 
                    '\n\n‚ö†Ô∏è *Configure sua API Key do DeepSeek para usar IA avan√ßada.*';
                
                return `${timeGreeting! üòä

Sou o assistente da MakerAI Studio.${deepseekHint}

Posso te ajudar com:
‚Ä¢ Informa√ß√µes sobre nossos servi√ßos
‚Ä¢ Or√ßamentos personalizados
‚Ä¢ Cases e portf√≥lio
‚Ä¢ Processo de desenvolvimento
‚Ä¢ D√∫vidas t√©cnicas

O que voc√™ gostaria de saber?`;
            }
            
            // Mapeamento de inten√ß√µes para respostas
            if (analysis.intents.services) {
                return `üöÄ **Nossos Servi√ßos de Desenvolvimento**

**üíª Desenvolvimento Web & Mobile**
‚Ä¢ Sites institucionais e corporativos responsivos
‚Ä¢ PWAs (Progressive Web Apps) com funcionalidades nativas
‚Ä¢ E-commerce e marketplaces escal√°veis
‚Ä¢ Aplicativos nativos (React Native/Flutter)
‚Ä¢ Sistemas web complexos e dashboards

**ü§ñ Intelig√™ncia Artificial & Automa√ß√£o**
‚Ä¢ Assistentes virtuais e chatbots inteligentes
‚Ä¢ An√°lise preditiva de dados e BI
‚Ä¢ Processamento de linguagem natural (NLP)
‚Ä¢ Automa√ß√£o de processos com RPA
‚Ä¢ Machine Learning personalizado

**üé® Design & Experi√™ncia do Usu√°rio**
‚Ä¢ UI/UX Design premium e intuitivo
‚Ä¢ Identidade visual completa
‚Ä¢ Prototipagem interativa e testes de usabilidade
‚Ä¢ Design System e componentes reutiliz√°veis

**‚ö° Infraestrutura & Performance**
‚Ä¢ DevOps & CI/CD pipelines
‚Ä¢ Cloud Architecture (AWS, Azure, GCP)
‚Ä¢ Performance optimization e SEO t√©cnico
‚Ä¢ Seguran√ßa digital e compliance

*Qual √°rea te interessa mais? Posso detalhar cada servi√ßo!* üòä`;
            }
            
            if (analysis.intents.pricing) {
                return `üí∞ **Transpar√™ncia Total nos Valores**

**üìä Modelos de Pre√ßo Flex√≠veis**

1. **Projeto Fixo** - Escopo definido
   ‚Ä¢ Sites: R$ 8.000 - R$ 35.000+
   ‚Ä¢ Apps: R$ 30.000 - R$ 120.000+
   ‚Ä¢ Sistemas: R$ 50.000 - R$ 250.000+

2. **Horas Avulsas** - Flexibilidade total
   ‚Ä¢ R$ 150/hora (desenvolvimento s√™nior)
   ‚Ä¢ R$ 120/hora (desenvolvimento pleno)
   ‚Ä¢ Ideal para ajustes, manuten√ß√£o e evolu√ß√µes

3. **Assinatura Mensal** - Suporte cont√≠nuo
   ‚Ä¢ B√°sico: R$ 1.500/m√™s (at√© 10h/m√™s)
   ‚Ä¢ Profissional: R$ 3.500/m√™s (at√© 30h/m√™s)
   ‚Ä¢ Enterprise: R$ 7.000+/m√™s (suporte 24/7)

**üéØ O que influencia o valor:**
‚Ä¢ Complexidade e escopo do projeto
‚Ä¢ Prazo de entrega desejado
‚Ä¢ Tecnologias e integra√ß√µes necess√°rias
‚Ä¢ N√≠vel de design e experi√™ncia do usu√°rio
‚Ä¢ Recursos de IA e automa√ß√£o inclu√≠dos

*Para uma estimativa precisa, me conte mais sobre seu projeto!* ‚ú®`;
            }
            
            if (analysis.intents.portfolio) {
                return `üé® **Cases de Sucesso Reais**

**üè• Sa√∫de & Bem-estar**
‚Ä¢ **App de Telemedicina:** Plataforma completa com agendamento, videochamadas e receitas digitais
‚Ä¢ **Sistema de Gest√£o Cl√≠nica:** ERP m√©dico com prontu√°rio eletr√¥nico e faturamento
‚Ä¢ **Plataforma Wellness:** App corporativo com desafios de sa√∫de e m√©tricas

**üè¢ Solu√ß√µes Empresariais**
‚Ä¢ **Dashboard de BI:** An√°lise em tempo real de KPIs com machine learning
‚Ä¢ **Sistema de Automa√ß√£o:** RPA para processos repetitivos, redu√ß√£o de 70% em tempo
‚Ä¢ **CRM Personalizado:** Gest√£o de relacionamento com IA para vendas

**üõí E-commerce & Varejo**
‚Ä¢ **Marketplace B2B:** Plataforma com recomenda√ß√£o por IA e log√≠stica integrada
‚Ä¢ **E-commerce Luxury:** Loja virtual com realidade aumentada para provadores
‚Ä¢ **Sistema de Fidelidade:** Programa com gamifica√ß√£o e analytics

**üéì Educa√ß√£o & EdTech**
‚Ä¢ **Plataforma E-learning:** Cursos interativos com tutoria por IA
‚Ä¢ **App Educacional:** Aprendizado adaptativo para crian√ßas
‚Ä¢ **Sistema de Gest√£o Escolar:** Admin completo para institui√ß√µes

**üîó Tecnologia & Inova√ß√£o**
‚Ä¢ **API Gateway:** Microservi√ßos para fintech com alta disponibilidade
‚Ä¢ **Sistema IoT:** Monitoramento em tempo real com alertas inteligentes
‚Ä¢ **Plataforma de Dados:** Data Lake com processamento de big data

*Tem algum setor espec√≠fico que te interessa? Posso detalhar cases similares!* üìä`;
            }
            
            if (analysis.intents.contact) {
                return `üìû **Vamos Conversar!**

**üì± Canais Diretos de Contato**
‚Ä¢ **WhatsApp:** (11) 98765-4321 (respondemos em at√© 15 minutos √∫teis)
‚Ä¢ **Email:** contato@makerai.com.br
‚Ä¢ **LinkedIn:** /makerai-studio
‚Ä¢ **Instagram:** @makerai.studio

**üìç Endere√ßo & Presen√ßa**
‚Ä¢ **Escrit√≥rio Principal:** S√£o Paulo - SP
‚Ä¢ **Atendimento Remoto:** Todo Brasil e Am√©rica Latina
‚Ä¢ **Hor√°rio Comercial:** Segunda a Sexta, 9h √†s 18h
‚Ä¢ **Plant√£o T√©cnico:** 24/7 para clientes Enterprise

**üéØ Nosso Processo:**

1. **Call Explorat√≥ria** (30 min gratuita)
   ‚Ä¢ Entendemos suas necessidades
   ‚Ä¢ Analisamos viabilidade t√©cnica
   ‚Ä¢ Alinhamos expectativas

2. **Proposta Personalizada**
   ‚Ä¢ Escopo detalhado
   ‚Ä¢ Cronograma realista
   ‚Ä¢ Investimento transparente

3. **Kick-off & Desenvolvimento**
   ‚Ä¢ Planejamento sprint a sprint
   ‚Ä¢ Entregas parciais semanais
   ‚Ä¢ Feedback cont√≠nuo

4. **Entrega & Suporte**
   ‚Ä¢ Lan√ßamento monitorado
   ‚Ä¢ Treinamento da equipe
   ‚Ä¢ Suporte p√≥s-implanta√ß√£o

*Prefere que eu te direcione para um formul√°rio ou j√° quer agendar uma call explorat√≥ria?* üöÄ`;
            }
            
            if (analysis.intents.help || analysis.intents.technical) {
                return `ü§ù **Como Posso Ajudar Melhor?**

Para quest√µes **t√©cnicas espec√≠ficas**, recomendo ativar o **modo DeepSeek** (bot√£o ü§ñ) para:
‚Ä¢ Explica√ß√µes detalhadas de conceitos
‚Ä¢ Tutoriais passo a passo
‚Ä¢ An√°lise de arquitetura e tecnologias
‚Ä¢ Solu√ß√£o de problemas complexos
‚Ä¢ Melhores pr√°ticas de desenvolvimento

Para **servi√ßos da MakerAI**, posso te ajudar com:
‚Ä¢ Escopo e planejamento de projetos
‚Ä¢ Tecnologias recomendadas para seu caso
‚Ä¢ Processo de desenvolvimento
‚Ä¢ Or√ßamentos e prazos
‚Ä¢ Cases relevantes

**Me conte:** Voc√™ precisa de ajuda com algo espec√≠fico da MakerAI ou √© uma d√∫vida t√©cnica geral?`;
            }
            
            if (analysis.urgency) {
                return `‚ö° **Entendi que √© urgente!**

Vou te ajudar da forma mais r√°pida poss√≠vel:

1. **Me conte brevemente:** Qual √© a situa√ß√£o?
2. **Prazo ideal:** Quando precisa da solu√ß√£o?
3. **Or√ßamento aproximado:** Qual o investimento dispon√≠vel?

Com essas informa√ß√µes, posso:
‚Ä¢ Conectar voc√™ diretamente com nossa equipe t√©cnica
‚Ä¢ Priorizar atendimento imediato
‚Ä¢ Dar um parecer r√°pido sobre viabilidade

*Qual √© o desafio que voc√™ est√° enfrentando?* üö®`;
            }
            
            // Resposta padr√£o para outras mensagens
            const genericResponses = [
                `Interessante! üßê\n\nPara te ajudar melhor, voc√™ poderia me contar:\n\n1. **Contexto:** √â um projeto novo ou uma melhoria?\n2. **Objetivo:** O que voc√™ quer alcan√ßar?\n3. **Timeline:** Tem algum prazo em mente?\n\nAssim posso te orientar da melhor forma! üìã`,
                `Show! ‚ú®\n\nVamos explorar isso juntos! Me conta um pouco mais sobre:\n\n‚Ä¢ **Escopo:** Que tipo de solu√ß√£o voc√™ imagina?\n‚Ä¢ **P√∫blico:** Quem vai usar o sistema/app?\n‚Ä¢ **Funcionalidades:** Quais as principais necessidades?\n\nCom essas informa√ß√µes, posso sugerir a melhor abordagem!`,
                `Perfeito! üéØ\n\nPara te dar direcionamentos precisos, seria √≥timo saber:\n\n‚Ä¢ **Setor:** Em que √°rea/segmento atua?\n‚Ä¢ **Desafio:** Que problema quer resolver?\n‚Ä¢ **Recursos:** J√° tem alguma infraestrutura?\n\n*Dica:* Para quest√µes t√©cnicas complexas, ative o modo DeepSeek! ü§ñ`
            ];
            
            return genericResponses[Math.floor(Math.random() * genericResponses.length)];
        }

        // ============================================
        // GERENCIAMENTO DE HIST√ìRICO E ESTADO
        // ============================================
        function saveHistory() {
            try {
                const history = {
                    sessionId: state.sessionId,
                    messages: state.conversationHistory,
                    lastUpdated: new Date().toISOString(),
                    messageCount: state.messageCount,
                    deepseekEnabled: state.deepseekEnabled,
                    timestamp: Date.now()
                };
                
                // Limita o hist√≥rico salvo (√∫ltimas 50 mensagens)
                if (history.messages.length > 50) {
                    history.messages = history.messages.slice(-50);
                }
                
                localStorage.setItem('makerai_chat_history', JSON.stringify(history));
                updateHistoryBadge();
                
            } catch (error) {
                console.error('Erro ao salvar hist√≥rico:', error);
            }
        }

        function loadHistory() {
            try {
                const saved = localStorage.getItem('makerai_chat_history');
                if (saved) {
                    const history = JSON.parse(saved);
                    
                    // Verifica se o hist√≥rico n√£o √© muito antigo (7 dias)
                    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    
                    if (history.timestamp && history.timestamp > sevenDaysAgo) {
                        state.conversationHistory = history.messages || [];
                        state.messageCount = history.messageCount || 0;
                        state.deepseekEnabled = history.deepseekEnabled || false;
                        
                        // Restaura mensagens na tela
                        state.conversationHistory.forEach(msg => {
                            const timestamp = msg.timestamp ? new Date(msg.timestamp) : new Date();
                            addMessage(msg.content, msg.role, msg.source || 'makerai', timestamp);
                        });
                        
                        updateHistoryBadge();
                        
                        // Atualiza UI baseada no estado salvo
                        if (state.deepseekEnabled) {
                            elements.deepseekToggle.classList.add('active');
                            elements.deepseekStatus.textContent = 'DeepSeek ON';
                            elements.sendAssistantBtn.classList.add('deepseek-mode');
                            elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Dispon√≠vel';
                        }
                        
                        return true;
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar hist√≥rico:', error);
                // Limpa hist√≥rico corrompido
                localStorage.removeItem('makerai_chat_history');
            }
            return false;
        }

        function clearHistory() {
            if (state.conversationHistory.length === 0) {
                return;
            }
            
            showConfirmation(
                'Limpar Conversa',
                'Tem certeza que deseja limpar toda a conversa? Esta a√ß√£o n√£o pode ser desfeita.',
                () => {
                    state.conversationHistory = [];
                    state.messageCount = 0;
                    elements.messagesContainer.innerHTML = '';
                    localStorage.removeItem('makerai_chat_history');
                    updateHistoryBadge();
                    showNotification('Hist√≥rico limpo com sucesso!', 'success');
                    
                    // Adiciona mensagem inicial
                    setTimeout(() => {
                        addMessage(getInitialGreeting(), 'ai', 'makerai');
                    }, 300);
                }
            );
        }

        function updateHistoryBadge() {
            const badge = elements.historyBtn;
            const count = state.conversationHistory.length;
            
            if (count > 0) {
                badge.dataset.badge = count > 99 ? '99+' : count.toString();
                badge.setAttribute('aria-label', `Hist√≥rico (${count} mensagens)`);
            } else {
                badge.dataset.badge = '';
                badge.setAttribute('aria-label', 'Hist√≥rico da conversa');
            }
        }

        function getInitialGreeting() {
            const hour = new Date().getHours();
            let greeting;
            
            if (hour < 12) greeting = "Bom dia";
            else if (hour < 18) greeting = "Boa tarde";
            else greeting = "Boa noite";
            
            const name = getRandomName();
            const deepseekStatus = state.apiKeyConfigured ? 
                '\n\nüí° **Dica profissional:** Ative o bot√£o DeepSeek ü§ñ para:\n‚Ä¢ Respostas t√©cnicas detalhadas\n‚Ä¢ An√°lise de arquitetura\n‚Ä¢ Solu√ß√£o de problemas complexos\n‚Ä¢ Tutoriais e boas pr√°ticas' : 
                '\n\n‚ö†Ô∏è **Para IA avan√ßada:** Configure sua API Key do DeepSeek no c√≥digo.';
            
            return `${greeting}${name ? ' ' + name : ''}! üëã

Sou o **Assistente da MakerAI Studio**, especializado em desenvolvimento de software e solu√ß√µes digitais.${deepseekStatus}

**Posso te ajudar com:**
‚Ä¢ Informa√ß√µes sobre nossos servi√ßos e tecnologias
‚Ä¢ Or√ßamentos personalizados e prazos
‚Ä¢ Cases de sucesso e portf√≥lio
‚Ä¢ Processo de desenvolvimento
‚Ä¢ D√∫vidas t√©cnicas e melhores pr√°ticas

**No que posso te ajudar hoje?** üöÄ`;
        }

        function getRandomName() {
            const names = ['', 'amigo', 'colega', 'parceiro', 'cliente'];
            return names[Math.floor(Math.random() * names.length)];
        }

        // ============================================
        // CONTROLE DO DEEPSEEK
        // ============================================
        function toggleDeepSeek() {
            if (!state.apiKeyConfigured) {
                showNotification(
                    '‚ö†Ô∏è Configure sua API Key do DeepSeek\nEdite DEEPSEEK_CONFIG.API_KEY no c√≥digo.',
                    'warning',
                    5000
                );
                return;
            }
            
            state.deepseekEnabled = !state.deepseekEnabled;
            
            if (state.deepseekEnabled) {
                // Ativa modo DeepSeek
                elements.deepseekToggle.classList.add('active');
                elements.deepseekStatus.textContent = state.isMobile ? 'ON' : 'DeepSeek ON';
                elements.sendAssistantBtn.classList.add('deepseek-mode');
                elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Ativo';
                elements.aiAvatar.classList.add('deepseek');
                
                showNotification(
                    'ü§ñ Modo DeepSeek ATIVADO!\nPerguntas complexas ser√£o respondidas pela IA avan√ßada.',
                    'success'
                );
                
                // Feedback visual
                elements.deepseekToggle.style.animation = 'pulse 0.5s ease';
                setTimeout(() => {
                    elements.deepseekToggle.style.animation = '';
                }, 500);
                
            } else {
                // Desativa modo DeepSeek
                elements.deepseekToggle.classList.remove('active');
                elements.deepseekStatus.textContent = state.isMobile ? 'OFF' : 'DeepSeek OFF';
                elements.sendAssistantBtn.classList.remove('deepseek-mode');
                elements.statusText.textContent = 'Online ‚Ä¢ MakerAI';
                elements.aiAvatar.classList.remove('deepseek');
                
                showNotification(
                    'Modo DeepSeek desativado.\nUsando respostas otimizadas da MakerAI.',
                    'info'
                );
            }
            
            // Salva prefer√™ncia
            localStorage.setItem('makerai_deepseek_enabled', state.deepseekEnabled);
            
            // Atualiza acessibilidade
            elements.deepseekToggle.setAttribute(
                'aria-label', 
                state.deepseekEnabled ? 'Desativar DeepSeek' : 'Ativar DeepSeek'
            );
        }

        function loadPreferences() {
            try {
                const deepseekEnabled = localStorage.getItem('makerai_deepseek_enabled');
                if (deepseekEnabled === 'true' && state.apiKeyConfigured) {
                    state.deepseekEnabled = true;
                    elements.deepseekToggle.classList.add('active');
                    elements.deepseekStatus.textContent = state.isMobile ? 'ON' : 'DeepSeek ON';
                    elements.sendAssistantBtn.classList.add('deepseek-mode');
                    elements.statusText.textContent = 'Online ‚Ä¢ DeepSeek Ativo';
                    elements.aiAvatar.classList.add('deepseek');
                }
            } catch (error) {
                console.error('Erro ao carregar prefer√™ncias:', error);
            }
        }

        // ============================================
        // PROCESSAMENTO DE MENSAGENS H√çBRIDO
        // ============================================
        async function sendMessage() {
            const message = elements.assistantInput.value.trim();
            
            // Valida√ß√µes
            if (!message) {
                showNotification('Digite uma mensagem antes de enviar.', 'warning');
                elements.assistantInput.focus();
                return;
            }
            
            if (state.isProcessing) {
                showNotification('Aguarde a resposta atual...', 'info');
                return;
            }
            
            if (message.length > 2000) {
                showNotification('Mensagem muito longa. Limite: 2000 caracteres.', 'warning');
                return;
            }
            
            // Estado de processamento
            state.isProcessing = true;
            const originalMessage = message;
            elements.assistantInput.value = '';
            elements.assistantInput.disabled = true;
            elements.sendAssistantBtn.disabled = true;
            
            // Esconde sugest√µes
            elements.suggestionsContainer.style.display = 'none';
            
            // Adiciona mensagem do usu√°rio
            const timestamp = new Date();
            addMessage(originalMessage, 'user', 'user', timestamp);
            
            // Salva no hist√≥rico
            state.conversationHistory.push({
                role: 'user',
                content: originalMessage,
                timestamp: timestamp.toISOString(),
                source: 'user'
            });
            saveHistory();
            
            // Mostra indicador de digita√ß√£o
            showTyping();
            
            // Decide qual fonte usar
            const useDeepSeek = shouldUseDeepSeek(originalMessage);
            let response;
            let source = 'makerai';
            
            try {
                if (useDeepSeek && state.deepseekEnabled && state.apiKeyConfigured) {
                    // Usa DeepSeek API
                    elements.statusText.textContent = 'Pensando... ü§ñ';
                    
                    const apiResponse = await callDeepSeekAPI(originalMessage, state.conversationHistory);
                    
                    if (apiResponse.success) {
                        response = apiResponse.response;
                        source = 'deepseek';
                        
                        // Adiciona indicador de uso da API (apenas em desktop)
                        if (state.isDesktop) {
                            const tokenCount = apiResponse.usage?.total_tokens || 'N/A';
                            response += `\n\n---\n*ü§ñ Resposta gerada por DeepSeek AI ‚Ä¢ Tokens: ${tokenCount}*`;
                        }
                        
                        showNotification('Resposta da DeepSeek AI gerada!', 'success');
                    } else {
                        // Fallback para resposta local
                        response = apiResponse.fallbackResponse;
                        showNotification(`Usando resposta local: ${apiResponse.error}`, 'warning');
                    }
                    
                } else {
                    // Usa resposta local
                    const thinkingTime = Math.min(originalMessage.length * 10, 1200);
                    await new Promise(resolve => setTimeout(resolve, thinkingTime));
                    response = generateLocalResponse(originalMessage);
                    
                    // Adiciona dica sobre DeepSeek se apropriado
                    if (useDeepSeek && !state.deepseekEnabled && state.apiKeyConfigured) {
                        response += `\n\nüí° **Dica profissional:** Para uma an√°lise mais t√©cnica e detalhada, ative o modo DeepSeek! ü§ñ`;
                    }
                }
                
                // Esconde indicador de digita√ß√£o
                hideTyping();
                
                // Simula tempo de digita√ß√£o realista
                const typingTime = Math.min(response.length * 3, 1500);
                await new Promise(resolve => setTimeout(resolve, typingTime));
                
                // Adiciona resposta
                const responseTimestamp = new Date();
                addMessage(response, 'ai', source, responseTimestamp);
                
                // Atualiza hist√≥rico
                state.conversationHistory.push({
                    role: 'assistant',
                    content: response,
                    timestamp: responseTimestamp.toISOString(),
                    source: source
                });
                saveHistory();
                
                // Atualiza status
                elements.statusText.textContent = source === 'deepseek' ? 
                    'Online ‚Ä¢ DeepSeek AI' : 
                    'Online ‚Ä¢ MakerAI';
                
            } catch (error) {
                console.error('Erro ao processar mensagem:', error);
                hideTyping();
                
                // Resposta de erro amig√°vel
                const errorResponse = `Desculpe, encontrei um problema ao processar sua mensagem. üòî\n\n**Detalhes:** ${error.message}\n\nPor favor, tente novamente ou reformule sua pergunta. Se o problema persistir, voc√™ pode desativar o modo DeepSeek.`;
                addMessage(errorResponse, 'ai', 'makerai', new Date());
                
                showNotification('Erro ao processar resposta', 'error');
                
            } finally {
                // Restaura estado
                state.isProcessing = false;
                elements.assistantInput.disabled = false;
                elements.sendAssistantBtn.disabled = false;
                elements.assistantInput.focus();
                
                // Atualiza status final
                elements.statusText.textContent = state.deepseekEnabled ? 
                    'Online ‚Ä¢ DeepSeek Dispon√≠vel' : 
                    'Online ‚Ä¢ MakerAI';
            }
        }

        // ============================================
        // SUGEST√ïES EM TEMPO REAL
        // ============================================
        const updateSuggestions = debounce(function() {
            const query = elements.assistantInput.value.trim().toLowerCase();
            
            // Limpa sugest√µes anteriores
            elements.suggestionsContainer.innerHTML = '';
            elements.suggestionsContainer.style.display = 'none';
            
            // S√≥ mostra sugest√µes ap√≥s 2 caracteres
            if (!query || query.length < 2) {
                return;
            }
            
            // Sugest√µes baseadas no conhecimento
            const suggestions = [];
            
            // Categorias principais
            const categories = [
                { text: "Servi√ßos MakerAI", search: "servi√ßos" },
                { text: "Or√ßamento e Pre√ßos", search: "or√ßamento" },
                { text: "Portf√≥lio e Cases", search: "portfolio" },
                { text: "Contato e Agendamento", search: "contato" },
                { text: "Tecnologias usadas", search: "tecnologias" },
                { text: "Prazos de entrega", search: "prazos" },
                { text: "Suporte t√©cnico", search: "suporte" }
            ];
            
            // Filtra categorias que correspondem √† busca
            const matchedCategories = categories.filter(cat => 
                cat.text.toLowerCase().includes(query) || 
                cat.search.includes(query)
            ).slice(0, 5);
            
            // Adiciona sugest√µes
            matchedCategories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = cat.text;
                item.onclick = () => {
                    elements.assistantInput.value = cat.text;
                    elements.suggestionsContainer.style.display = 'none';
                    elements.assistantInput.focus();
                };
                elements.suggestionsContainer.appendChild(item);
            });
            
            // Mostra sugest√µes se houver alguma
            if (elements.suggestionsContainer.children.length > 0) {
                elements.suggestionsContainer.style.display = 'block';
                
                // Ajusta posi√ß√£o para n√£o sair da tela
                const inputRect = elements.assistantInput.getBoundingClientRect();
                const containerRect = elements.suggestionsContainer.getBoundingClientRect();
                
                if (inputRect.top - containerRect.height < 10) {
                    elements.suggestionsContainer.style.bottom = '100%';
                    elements.suggestionsContainer.style.top = 'auto';
                }
            }
        }, 300);

        // ============================================
        // CARROSSEL DE OP√á√ïES R√ÅPIDAS
        // ============================================
        function initQuickOptions() {
            const options = [
                { text: "Servi√ßos", icon: "fas fa-cogs", category: "services" },
                { text: "Or√ßamento", icon: "fas fa-money-bill-wave", category: "pricing" },
                { text: "Portf√≥lio", icon: "fas fa-images", category: "portfolio" },
                { text: "Contato", icon: "fas fa-envelope", category: "contact" },
                { text: "Tecnologias", icon: "fas fa-code", category: "technical" },
                { text: "Prazos", icon: "fas fa-clock", category: "timeline" },
                { text: "Suporte", icon: "fas fa-headset", category: "support" },
                { text: "IA & Automa√ß√£o", icon: "fas fa-robot", category: "ai" }
            ];
            
            elements.quickOptionsCarousel.innerHTML = '';
            
            options.forEach((opt, index) => {
                const button = document.createElement('button');
                button.className = 'quick-option';
                button.innerHTML = `<i class="${opt.icon}"></i> ${opt.text}`;
                button.type = 'button';
                button.setAttribute('aria-label', `Perguntar sobre ${opt.text}`);
                
                button.onclick = () => {
                    elements.assistantInput.value = opt.text;
                    sendMessage();
                    
                    // Feedback visual
                    button.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        button.style.transform = '';
                    }, 150);
                };
                
                elements.quickOptionsCarousel.appendChild(button);
            });
            
            updateCarouselIndicators();
            startCarousel();
        }

        function updateCarouselIndicators() {
            const itemsPerView = getItemsPerView();
            const totalItems = elements.quickOptionsCarousel.children.length;
            const totalSlides = Math.ceil(totalItems / itemsPerView);
            
            elements.carouselIndicators.innerHTML = '';
            
            for (let i = 0; i < totalSlides; i++) {
                const indicator = document.createElement('button');
                indicator.className = `carousel-indicator ${i === state.currentSlide ? 'active' : ''}`;
                indicator.type = 'button';
                indicator.setAttribute('aria-label', `Slide ${i + 1} de ${totalSlides}`);
                indicator.onclick = () => goToSlide(i);
                
                elements.carouselIndicators.appendChild(indicator);
            }
        }

        function getItemsPerView() {
            if (state.windowWidth < 480) return 2;
            if (state.windowWidth < 768) return 3;
            if (state.windowWidth < 1024) return 4;
            return 5;
        }

        function goToSlide(index) {
            const itemsPerView = getItemsPerView();
            const totalItems = elements.quickOptionsCarousel.children.length;
            const totalSlides = Math.ceil(totalItems / itemsPerView);
            
            // Ajusta √≠ndice para circular
            if (index < 0) index = totalSlides - 1;
            if (index >= totalSlides) index = 0;
            
            state.currentSlide = index;
            
            // Calcula scroll
            const itemWidth = elements.quickOptionsCarousel.children[0]?.offsetWidth || 140;
            const gap = 10;
            const scrollPosition = index * itemsPerView * (itemWidth + gap);
            
            elements.quickOptionsCarousel.scrollTo({
                left: scrollPosition,
                behavior: 'smooth'
            });
            
            updateCarouselIndicators();
            
            // Reinicia carrossel autom√°tico
            clearInterval(state.carouselInterval);
            startCarousel();
        }

        function startCarousel() {
            state.carouselInterval = setInterval(() => {
                goToSlide(state.currentSlide + 1);
            }, 6000); // 6 segundos por slide
        }

        function stopCarousel() {
            clearInterval(state.carouselInterval);
        }

        // ============================================
        // MODAL DE CONFIRMA√á√ÉO
        // ============================================
        function showConfirmation(title, message, onConfirm) {
            elements.modalTitle.textContent = title;
            elements.modalMessage.textContent = message;
            elements.confirmationModal.style.display = 'flex';
            
            // Remove listeners anteriores
            elements.modalConfirm.onclick = null;
            elements.modalCancel.onclick = null;
            
            // Configura novos listeners
            elements.modalConfirm.onclick = () => {
                elements.confirmationModal.style.display = 'none';
                if (onConfirm) onConfirm();
            };
            
            elements.modalCancel.onclick = () => {
                elements.confirmationModal.style.display = 'none';
            };
            
            // Fecha modal com ESC
            const closeOnEsc = (e) => {
                if (e.key === 'Escape') {
                    elements.confirmationModal.style.display = 'none';
                    document.removeEventListener('keydown', closeOnEsc);
                }
            };
            
            document.addEventListener('keydown', closeOnEsc);
            
            // Foca no bot√£o de cancelar
            setTimeout(() => {
                elements.modalCancel.focus();
            }, 100);
        }

        // ============================================
        // MANIPULA√á√ÉO DE EVENTOS
        // ============================================
        function setupEventListeners() {
            // Input principal
            elements.assistantInput.addEventListener('input', updateSuggestions);
            
            elements.assistantInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                
                // Fecha sugest√µes com ESC
                if (e.key === 'Escape') {
                    elements.suggestionsContainer.style.display = 'none';
                    elements.assistantInput.focus();
                }
            });
            
            elements.assistantInput.addEventListener('focus', () => {
                elements.assistantInput.style.background = 'rgba(255, 255, 255, 0.12)';
            });
            
            elements.assistantInput.addEventListener('blur', () => {
                elements.assistantInput.style.background = '';
                // Esconde sugest√µes com delay para permitir clique
                setTimeout(() => {
                    elements.suggestionsContainer.style.display = 'none';
                }, 200);
            });
            
            // Bot√£o enviar
            elements.sendAssistantBtn.addEventListener('click', sendMessage);
            
            // Bot√£o DeepSeek Toggle
            elements.deepseekToggle.addEventListener('click', toggleDeepSeek);
            
            // Bot√£o hist√≥rico
            elements.historyBtn.addEventListener('click', () => {
                const count = state.conversationHistory.length;
                if (count > 0) {
                    showNotification(`Voc√™ tem ${count} mensagens nesta conversa.`, 'info');
                } else {
                    showNotification('Nenhuma mensagem no hist√≥rico.', 'info');
                }
            });
            
            // Bot√£o limpar
            elements.clearBtn.addEventListener('click', clearHistory);
            
            // Bot√£o fechar
            elements.closeAssistant.addEventListener('click', () => {
                if (state.conversationHistory.length > 3) {
                    showConfirmation(
                        'Fechar Assistente',
                        'Tem certeza que deseja fechar? Sua conversa ser√° salva automaticamente.',
                        () => {
                            window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                        }
                    );
                } else {
                    window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
                }
            });
            
            // Bot√£o voltar (mobile)
            elements.backBtn.addEventListener('click', () => {
                window.parent.postMessage({ type: 'CLOSE_ASSISTANT' }, '*');
            });
            
            // Fecha modal ao clicar fora
            elements.confirmationModal.addEventListener('click', (e) => {
                if (e.target === elements.confirmationModal) {
                    elements.confirmationModal.style.display = 'none';
                }
            });
            
            // Carrossel intera√ß√£o
            elements.quickOptionsCarousel.addEventListener('mouseenter', stopCarousel);
            elements.quickOptionsCarousel.addEventListener('mouseleave', startCarousel);
            elements.quickOptionsCarousel.addEventListener('touchstart', stopCarousel);
            elements.quickOptionsCarousel.addEventListener('touchend', () => {
                setTimeout(startCarousel, 5000);
            });
            
            // Comunica√ß√£o com iframe pai
            window.addEventListener('message', (e) => {
                if (e.data?.type === 'OPEN_ASSISTANT') {
                    elements.panel.style.display = 'flex';
                    setTimeout(() => elements.assistantInput.focus(), 300);
                }
                
                if (e.data?.type === 'SET_INITIAL_MESSAGE') {
                    const msg = e.data.message || getInitialGreeting();
                    addMessage(msg, 'ai', 'makerai');
                    state.conversationHistory.push({
                        role: 'assistant',
                        content: msg,
                        timestamp: new Date().toISOString(),
                        source: 'makerai'
                    });
                    saveHistory();
                }
            });
            
            // Detecta mudan√ßas de tamanho da tela
            window.addEventListener('resize', throttle(() => {
                state.windowWidth = window.innerWidth;
                state.windowHeight = window.innerHeight;
                state.isMobile = window.innerWidth <= 768;
                state.isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
                state.isDesktop = window.innerWidth > 1024;
                state.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
                
                // Atualiza texto do bot√£o DeepSeek para mobile
                if (state.isMobile) {
                    elements.deepseekStatus.textContent = state.deepseekEnabled ? 'ON' : 'OFF';
                } else {
                    elements.deepseekStatus.textContent = state.deepseekEnabled ? 'DeepSeek ON' : 'DeepSeek OFF';
                }
                
                // Atualiza carrossel
                updateCarouselIndicators();
                goToSlide(state.currentSlide);
                
                // Ajusta altura m√°xima em mobile landscape
                if (state.orientation === 'landscape' && state.isMobile) {
                    elements.messagesContainer.style.maxHeight = 'calc(100vh - 180px)';
                } else {
                    elements.messagesContainer.style.maxHeight = '';
                }
            }, 250));
            
            // Detecta online/offline
            window.addEventListener('online', () => {
                state.isOnline = true;
                elements.statusText.textContent = state.deepseekEnabled ? 
                    'Online ‚Ä¢ DeepSeek Dispon√≠vel' : 
                    'Online ‚Ä¢ MakerAI';
                showNotification('Conex√£o restabelecida!', 'success');
            });
            
            window.addEventListener('offline', () => {
                state.isOnline = false;
                elements.statusText.textContent = 'Offline ‚Ä¢ Modo Local';
                showNotification('Sem conex√£o - usando respostas locais', 'warning');
            });
            
            // Previne refresh acidental em mobile
            window.addEventListener('beforeunload', (e) => {
                if (state.conversationHistory.length > 5) {
                    e.preventDefault();
                    e.returnValue = 'Tem certeza que deseja sair? Sua conversa ser√° salva.';
                }
            });
            
            // Foca no input quando o painel √© clicado
            elements.panel.addEventListener('click', (e) => {
                if (e.target === elements.panel || e.target.closest('.messages-container')) {
                    elements.assistantInput.focus();
                }
            });
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        function initializeAssistant() {
            // Inicializa componentes
            initQuickOptions();
            setupEventListeners();
            
            // Carrega prefer√™ncias
            loadPreferences();
            
            // Carrega hist√≥rico ou inicia nova conversa
            const hasHistory = loadHistory();
            if (!hasHistory) {
                // Aguarda anima√ß√£o de entrada
                setTimeout(() => {
                    const greeting = getInitialGreeting();
                    addMessage(greeting, 'ai', 'makerai');
                    
                    state.conversationHistory.push({
                        role: 'assistant',
                        content: greeting,
                        timestamp: new Date().toISOString(),
                        source: 'makerai'
                    });
                    saveHistory();
                }, 800);
            }
            
            // Foco autom√°tico com delay
            setTimeout(() => {
                if (document.hasFocus()) {
                    elements.assistantInput.focus();
                }
            }, 1200);
            
            // Verifica estado inicial da conex√£o
            if (!navigator.onLine) {
                state.isOnline = false;
                elements.statusText.textContent = 'Offline ‚Ä¢ Modo Local';
                showNotification('Sem conex√£o - usando respostas locais', 'warning', 4000);
            } else {
                elements.statusText.textContent = state.deepseekEnabled ? 
                    'Online ‚Ä¢ DeepSeek Dispon√≠vel' : 
                    'Online ‚Ä¢ MakerAI';
            }
            
            // Notifica que o assistente est√° pronto
            setTimeout(() => {
                window.parent.postMessage({ 
                    type: 'ASSISTANT_READY',
                    config: {
                        deepseekAvailable: state.apiKeyConfigured,
                        deepseekEnabled: state.deepseekEnabled,
                        responsive: true,
                        sessionId: state.sessionId
                    }
                }, '*');
            }, 500);
            
            // Inicializa com estado responsivo
            state.windowWidth = window.innerWidth;
            state.windowHeight = window.innerHeight;
            state.isMobile = window.innerWidth <= 768;
            state.isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            state.isDesktop = window.innerWidth > 1024;
            
            // Ajusta texto do bot√£o DeepSeek baseado no tamanho
            if (state.isMobile) {
                elements.deepseekStatus.textContent = state.deepseekEnabled ? 'ON' : 'OFF';
            }
        }

        // Inicializa quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAssistant);
        } else {
            initializeAssistant();
        }

        // Limpeza ao descarregar
        window.addEventListener('beforeunload', () => {
            stopCarousel();
            saveHistory();
        });
    </script>
</body>
</html>